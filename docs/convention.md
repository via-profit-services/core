# Конвенция

> Via Profit services / **Core**

## Содержание

- [Сервер](#convention-server)
- [Базы данных](#convention-databases)
- [Dataloader](#convention-dataloader)

### <a name="convention-server"></a> Сервер

1.  Временная зона сервера должна совпадать с временной зоной сервера базы данных, для этого рекомендуется все операции над датами производить в [UTC](https://ru.wikipedia.org/wiki/%D0%92%D1%81%D0%B5%D0%BC%D0%B8%D1%80%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BE%D1%80%D0%B4%D0%B8%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B5_%D0%B2%D1%80%D0%B5%D0%BC%D1%8F)
2.  Сервер должен быть запущен только с [SSL](https://ru.wikipedia.org/wiki/SSL). Чтобы поднять SSL на `localhost` можно использовать [mkcert](https://github.com/FiloSottile/mkcert)

### <a name="convention-databases"></a> Базы данных

1. Все даты, которые содержат время (например, 2020-01-01 12:05:00), должны храниться с типом `timestamptz`
2. Все сущности времени, (например, 12:05:00), должны храниться с типом `timetz`
3. Все даты должны храниться в часовом поясе [UTC](https://ru.wikipedia.org/wiki/%D0%92%D1%81%D0%B5%D0%BC%D0%B8%D1%80%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BE%D1%80%D0%B4%D0%B8%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B5_%D0%B2%D1%80%D0%B5%D0%BC%D1%8F)
4. Всё время, которое отдельно хранится от даты, должно храниться в часовом поясе **UTC**, за исключением случаев, когда время не зависит от часового пояса
5. Каждая сущность, являющаяся элементом выборки, должна иметь колонки:
   - `createdAt` тип `timestamptz` - Для хранения даты создания записи
   - `updatedAt` тип `timestamptz` - Для хранения даты обновления записи
6. Формат представления валюты должен быть `bigint` или `numeric`. Денежные значения необходимо хранить в наименьшей денежной единице (в копейках, в центах и т.п.). Не использовать тип `money`, т.к. он чувствителен к локали и требует преобразования, которое может быть выполнено через `float`, что может привести к неверному округлению.

### <a name="convention-dataloader"></a> Dataloader

Для кэширования и предотвращения многократной загрузки одних и тех же данных используется механизм даталоадеров. Подробнее про использование даталоадеров см. в разделе [Dataloader](./dataloader.md)
