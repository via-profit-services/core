#!/usr/bin/env node
module.exports=(()=>{"use strict";var e={294:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function s(e){try{d(o.next(e))}catch(e){a(e)}}function l(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}d((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(4819),a={command:"download-schema <endpoint> <token> [filename] [method]",describe:"Download GraphQL schema by introspection",handler:e=>o(void 0,void 0,void 0,(function*(){const{method:t,token:n,endpoint:o,filename:a}=e;yield i.downloadSchema({token:n,endpoint:o,filename:a,method:"POST"===t?"POST":"GET"})})),builder:e=>e.example("$0 download-schema https://example.com/gql MyToken ./schema.graphql","Download GraphQL schema into the ./schema.graphql file").example("$0 download-schema https://example.com/gql MyToken","Download GraphQL schema and return this as string")};t.default=a},3573:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function s(e){try{d(o.next(e))}catch(e){a(e)}}function l(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}d((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(8111),a={command:"get-migrations",describe:"Copy migration and/or seed files from @via-profit-services modules into your project",handler:e=>o(void 0,void 0,void 0,(function*(){return i.getMigrations(e)})),builder:e=>e.options({migrations:{alias:"m",type:"string"},seeds:{alias:"s",type:"string"}}).example("$0 get-migrations -m ./database/migrations","Copy all migration files into your project").example("$0 get-migrations -s ./database/seeds","Copy all seed files into your project")};t.default=a},413:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function s(e){try{d(o.next(e))}catch(e){a(e)}}function l(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}d((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(5747)),s=i(n(5622)),l=i(n(2242)),d=n(8111),r={command:"knex <command>",describe:"knex-cli provider",handler:()=>{},builder:e=>e.example("$0 knex migrate latest ./knexfile.ts","Apply all of the next migrations").command("migrate <command>","Apply/Undo/Make migrations",(e=>e.command("latest","Apply all of the next migrations",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("migrate:latest",e.knexfile)})))).command("up","Apply next migration",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("migrate:up",e.knexfile)})))).command("down","Undo last single of migration",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("migrate:down",e.knexfile)})))).command("rollback","Undo last migrations",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("migrate:rollback",e.knexfile)})))).command("rollback-all","Undo all migrations",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("migrate:rollback --all",e.knexfile)})))).command("list","To list both completed and pending migrations",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("migrate:list",e.knexfile)})))).command("make","Creating new migration file",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"},name:{alias:"n",type:"string",demandOption:!0,decribe:"Migration filename"},stub:{alias:"s",type:"string",decribe:"Template file"}})),(e=>o(void 0,void 0,void 0,(function*(){const t=s.default.dirname(d.resolveKnexfile(e.knexfile)),n=e.stub?s.default.resolve(t,e.stub):s.default.resolve(process.cwd()+"/node_modules/@via-profit-services/core/dist/bin/stub/stub-migration.ts.stub");a.default.existsSync(n)||(console.log(l.default.red(`Stubfile not found in «${n}»`)),process.exit(1)),yield d.execKnex(`migrate:make ${e.name}  --stub ${n}`,e.knexfile)})))))).command("seed <command>","Apply/Make seeds",(e=>e.command("make","Creating new seed file",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"},name:{alias:"n",type:"string",demandOption:!0,decribe:"Seed filename"},stub:{alias:"s",type:"string",decribe:"Template file"}})),(e=>o(void 0,void 0,void 0,(function*(){const t=s.default.dirname(d.resolveKnexfile(e.knexfile)),n=e.stub?s.default.resolve(t,e.stub):s.default.resolve(process.cwd()+"/node_modules/@via-profit-services/core/dist/bin/stub/stub-seed.ts.stub");a.default.existsSync(n)||(console.log(l.default.red(`Stubfile not found in «${n}»`)),process.exit(1)),yield d.execKnex(`seed:make ${e.name} --stub ${n}`,e.knexfile)})))).command("run-all","Run all seed files",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("seed:run",e.knexfile)})))).command("run <name>","Run seed file",(e=>e.options({knexfile:{alias:"k",type:"string",demandOption:!0,decribe:"Location of the knexfile"},name:{alias:"n",type:"string",demandOption:!0,decribe:"Seed filename"}})),(e=>o(void 0,void 0,void 0,(function*(){yield d.execKnex("seed:run "+e.name,e.knexfile)}))))))};t.default=r},8958:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(1585)),a=o(n(294)),s=o(n(3573)),l=o(n(413)),d=i.default.command(a.default).command(s.default).command(l.default).help().argv;t.default=d},8111:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function s(e){try{d(o.next(e))}catch(e){a(e)}}function l(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}d((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.execKnex=t.resolveKnexfile=t.getMigrations=t.listMigrationsPerPackage=void 0;const a=n(3129),s=i(n(5747)),l=i(n(5622)),d=i(n(2242)),r=i(n(6878));t.listMigrationsPerPackage=()=>{const e=[];return r.default.sync(process.cwd()+"/node_modules/@via-profit-services/*/").forEach((t=>{const n=l.default.basename(t),o={migrations:[],seeds:[]},i=t+"dist/database/@(migrations|seeds)/*.ts";r.default.sync(i).forEach((e=>{if(!e.match(/\.d\.ts$/)){const t=l.default.basename(l.default.dirname(e));o[t].push(e)}})),e.push({project:n,files:o})})),e},t.getMigrations=e=>{console.log("migrations",e.migrations),console.log("seeds",e.seeds),t.listMigrationsPerPackage().forEach((t=>{const{files:n,project:o}=t;if(e.migrations){let t=0;console.log(""),console.log("Migrations from project "+d.default.magenta(o));const i=l.default.resolve(process.cwd(),e.migrations);s.default.existsSync(i)||s.default.mkdirSync(i,{recursive:!0}),n.migrations.forEach((e=>{const n=l.default.join(i,l.default.basename(e));s.default.existsSync(n)||(t+=1,s.default.copyFileSync(e,n),console.log(`${d.default.yellow("Was created migration file")} ${d.default.cyan(l.default.basename(e))}`))})),t?console.log(`${d.default.bold.green(t.toString())} ${d.default.yellow("file[s] was copied")}`):console.log(d.default.grey("No files was copied"))}if(e.seeds){let t=0;console.log(""),console.log("Seeds for "+d.default.magenta(o));const i=l.default.resolve(process.cwd(),e.seeds);s.default.existsSync(i)||s.default.mkdirSync(i,{recursive:!0}),n.seeds.forEach((e=>{const n=l.default.join(i,l.default.basename(e));s.default.existsSync(n)||(t+=1,s.default.copyFileSync(e,n),console.log(`${d.default.yellow("Was created seed file")} ${d.default.cyan(l.default.basename(e))}`))})),t?console.log(`${d.default.bold.green(t.toString())} ${d.default.yellow("file[s] was copied")}`):console.log(d.default.grey("No files was copied"))}}))},t.resolveKnexfile=e=>l.default.resolve(process.cwd(),e),t.execKnex=(e,n)=>o(void 0,void 0,void 0,(function*(){const o=t.resolveKnexfile(n);return new Promise((t=>{const n=`knex ${e} --knexfile ${o}`;s.default.existsSync(o)||(console.log(d.default.red(`Knexfile not found in «${o}»`)),process.exit(1)),a.spawn("yarn",n.split(" "),{stdio:"inherit"}).on("exit",(e=>{e&&(console.log(d.default.red("Failed to execute knex command "+n)),console.log(d.default.red(e)),process.exit(1)),t()}))}))}))},4819:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function s(e){try{d(o.next(e))}catch(e){a(e)}}function l(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}d((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.downloadSchema=void 0;const a=i(n(5747)),s=i(n(5622)),l=n(8068);t.downloadSchema=e=>o(void 0,void 0,void 0,(function*(){const{endpoint:t,method:n,token:o,filename:i,headers:d}=e,r=yield fetch(t,{method:n||"POST",headers:Object.assign({"Content-Type":"application/json",Authorization:"Bearer "+o},d),body:JSON.stringify({query:l.getIntrospectionQuery()})});if(200!==r.status)throw new Error("Failed to send introspection request with status code "+r.status);const c=yield r.json(),f=l.printSchema(l.buildClientSchema(c.data));return a.default.writeFileSync(s.default.resolve(i),f)}))},2242:e=>{e.exports=require("chalk")},3129:e=>{e.exports=require("child_process")},5747:e=>{e.exports=require("fs")},6878:e=>{e.exports=require("glob")},8068:e=>{e.exports=require("graphql/utilities")},5622:e=>{e.exports=require("path")},1585:e=>{e.exports=require("yargs")}},t={};return function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(8958)})();