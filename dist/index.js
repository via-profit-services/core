/*! For license information please see index.js.LICENSE.txt */
module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=30)}([function(e,t){e.exports=require("graphql")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TOKEN_BEARER_KEY="Authorization",t.TOKEN_BEARER="Bearer",t.REDIS_TOKENS_BLACKLIST="tokensBlackList",t.REDIS_IP_BLACKLIST="ipBlackList",t.DATABASE_CHARSET="UTF8",t.DATABASE_CLIENT="pg",t.DEFAULT_SERVER_PORT=4e3,t.DEFAULT_GRAPHQL_ENDPOINT="/graphql",t.DEFAULT_GRAPHQL_SUBSCRIPTION_ENDPOINT="/subscriptions",t.DEFAULT_SERVER_TIMEZONE="UTC",t.DEFAULT_ROUTE_GRAPHIQL="/graphiql",t.DEFAULT_ROUTE_VOYAGER="/voyager",t.DEFAULT_SESSION_SECRET="DCBUN0HUKGY4WGHAK5446GAJDFHSKA",t.DEFAULT_SESSION_TTL=3600,t.DEFAULT_SESSION_PATH="./sessions",t.MAXIMUM_REQUEST_BODY_SIZE="50mb",t.DEV_INFO_DEVELOPER_NAME="Via Profit",t.DEV_INFO_DEVELOPER_URL="https://via-profit.ru/",t.DEV_INFO_DEVELOPER_EMAIL="promo@via-profit.ru",t.LOG_FILENAME_AUTH="auth-%DATE%.log",t.LOG_FILENAME_HTTP="http-%DATE%.log",t.LOG_FILENAME_DEBUG="debug-%DATE%.log",t.LOG_FILENAME_ERRORS="errors-%DATE%.log",t.LOG_FILENAME_WARNINGS="warnings-%DATE%.log",t.LOG_FILENAME_SQL="sql-%DATE%.log",t.LOG_FILENAME_ACCESS="access-%DATE%.log",t.LOG_FILENAME_SESSIONS="sessions-%DATE%.log",t.LOG_DATE_PATTERNT="YYYY-MM-DD",t.LOG_MAX_SIZE="20m",t.LOG_MAX_FILES="14d",t.LOG_MAZ_FILES="14d",t.LOG_MAZ_SIZE="20m"},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(16));t.BadRequestError=r.default;const o=i(n(17));t.customFormatErrorFn=o.default;const a=i(n(18));t.ForbiddenError=a.default;const s=i(n(19));t.NotFoundError=s.default;const d=i(n(20));t.ServerError=d.default;const u=i(n(21));t.UnauthorizedError=u.default},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t){e.exports=require("winston")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5);t.default=i.format.combine(i.format.metadata(),i.format.json(),i.format.timestamp({format:"YYYY-MM-DDTHH:mm:ssZZ"}),i.format.splat(),i.format.printf(e=>{const{timestamp:t,level:n,message:i,metadata:r}=e,o="{}"!==JSON.stringify(r)?r:null;return`${t} ${n}: ${i} ${o?JSON.stringify(o):""}`}))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(3)),a=r(n(35)),s=r(n(36)),d=r(n(22)),u=n(23),l=n(2),c=n(9),p=n(11);t.default=class{constructor(e){this.props=e}static cryptUserPassword(e){const t=a.default.genSaltSync(10);return a.default.hashSync(e,t)}getAccountByCredentials(e,t){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:i}=n,r=yield i.select(["id","password","status","roles"]).from("accounts").where({login:e}).first();if(!r||!a.default.compareSync(t,String(r.password)))throw new l.BadRequestError("Invalid login or password");if(r.status===p.AccountStatus.forbidden)throw new l.BadRequestError("Account locked");return r}))}registerTokens(e){return i(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:n,logger:i}=t,r=yield n.select(["id","roles"]).from("accounts").where({id:e.uuid}).first();if("string"!=typeof r.id)throw new l.BadRequestError(`Account with id[${r.id}] not found`);const o=this.generateTokens({uuid:r.id,roles:r.roles});try{yield n("tokens").insert({id:o.accessToken.payload.id,account:o.accessToken.payload.uuid,type:p.TokenType.access,deviceInfo:e.deviceInfo,expiredAt:d.default(1e3*o.accessToken.payload.exp).format()})}catch(e){throw new l.ServerError("Failed to register access token",e)}try{yield n("tokens").insert({id:o.refreshToken.payload.id,account:o.refreshToken.payload.uuid,type:p.TokenType.refresh,associated:o.accessToken.payload.id,deviceInfo:e.deviceInfo,expiredAt:d.default(1e3*o.refreshToken.payload.exp).format()})}catch(e){throw new l.ServerError("Failed to register refresh token",e)}return i.auth.info("New Access token was registered",o.accessToken.payload),o}))}generateTokens(e,t){var n,i;const{context:r}=this.props,a=(null===(n=t)||void 0===n?void 0:n.access)?t.access:r.jwt.accessTokenExpiresIn,d=(null===(i=t)||void 0===i?void 0:i.refresh)?t.refresh:r.jwt.refreshTokenExpiresIn;try{o.default.accessSync(r.jwt.privateKey)}catch(e){throw new l.ServerError("Failed to open JWT privateKey file",{err:e})}const c=o.default.readFileSync(r.jwt.privateKey),f=Object.assign(Object.assign({},e),{type:p.TokenType.access,id:u.v4(),exp:Math.floor(Date.now()/1e3)+Number(a),iss:r.jwt.issuer}),m=Object.assign(Object.assign({},e),{type:p.TokenType.refresh,id:u.v4(),associated:f.id,exp:Math.floor(Date.now()/1e3)+Number(d),iss:r.jwt.issuer}),y=s.default.sign(f,c,{algorithm:r.jwt.algorithm}),v=s.default.sign(m,c,{algorithm:r.jwt.algorithm});return{accessToken:{token:y,payload:Object.assign(Object.assign({},f),{type:p.TokenType.access})},refreshToken:{token:v,payload:Object.assign(Object.assign({},m),{type:p.TokenType.refresh})}}}revokeToken(e){return i(this,void 0,void 0,(function*(){const{context:t}=this.props,{logger:n,knex:i,redis:r}=t,o=Array.isArray(e)?e:[e];try{r.sadd(c.REDIS_TOKENS_BLACKLIST,o),n.auth.info("New tokens has been added in BlackList",{tokenIds:o})}catch(e){throw new l.ServerError("Failed to update Redis BlackList",{err:e})}(yield i("tokens").select(["tokens.account","tokens.id as access","refreshTokens.id as refresh"]).leftJoin("accounts","accounts.id","tokens.account").leftJoin("tokens as refreshTokens","refreshTokens.associated","tokens.id").whereIn("tokens.id",o)).forEach(e=>{n.auth.info(`Revoke Access Token ${e.access} for account ${e.account}`,{data:e}),n.auth.info(`Revoke Refresh Token ${e.refresh} for account ${e.account}`,{data:e})})}))}isTokenRevoked(e){return i(this,void 0,void 0,(function*(){const{redis:t}=this.props.context,n=yield t.sismember(c.REDIS_TOKENS_BLACKLIST,e);return Boolean(n)}))}revokeAccountTokens(e){return i(this,void 0,void 0,(function*(){const{knex:t}=this.props.context,n=(yield t("tokens").select(["id"]).where({account:e})).map(e=>e.id);return n.length&&(yield this.revokeToken(n)),n}))}getTokensByIds(e){return i(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:n}=t;return yield n("tokens").select("*").whereIn("id",e)}))}clearExpiredTokens(){return i(this,void 0,void 0,(function*(){const{context:e}=this.props,{knex:t,redis:n}=e,i=(yield t("tokens").select("id").where("expiredAt","<",t.raw("now()"))).map(e=>e.id);if(i.length)try{yield n.srem(c.REDIS_TOKENS_BLACKLIST,i)}catch(e){throw new l.ServerError("Failed to remove data from Redis BlackList",{err:e})}yield t("tokens").del().where("expiredAt","<",t.raw("now()"))}))}verifyToken(e){return i(this,void 0,void 0,(function*(){const{context:t}=this.props,{redis:n,logger:i}=t;let r;try{r=o.default.readFileSync(t.jwt.publicKey)}catch(e){throw i.server.error("Failed to read JWT key",{err:e}),new l.ServerError("Failed to read JWT key",e)}try{const t=s.default.verify(String(e),r);return(yield n.sismember(c.REDIS_TOKENS_BLACKLIST,t.id))?(i.auth.info("Token was revoked",{payload:t}),!1):t}catch(e){return i.server.error("Failed to validate the token",{err:e}),!1}}))}checkTokenExist(e){return i(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:n}=t;return null!==(yield n.select(["id"]).from("tokens").where({id:e}).first())}))}static extractTokenFromSubscription(e){if("object"==typeof e&&c.TOKEN_BEARER_KEY in e){const[t,n]=String(e[c.TOKEN_BEARER_KEY]).split(" ");if(t===c.TOKEN_BEARER&&""!==n)return String(n)}return""}static extractToken(e,t){const{headers:n}=t;if(e===p.TokenType.access&&c.TOKEN_BEARER_KEY.toLocaleLowerCase()in n){const[e,t]=String(n[c.TOKEN_BEARER_KEY.toLocaleLowerCase()]).split(" ");if(e===c.TOKEN_BEARER&&""!==t)return String(t)}return""}}},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(37));t.DataLoader=o.default,i(n(12)),i(n(38)),i(n(24)),i(n(1)),i(n(40))},function(e,t){e.exports=require("chalk")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.allowed="allowed",e.forbidden="forbidden"}(t.AccountStatus||(t.AccountStatus={})),function(e){e.access="access",e.refresh="refresh"}(t.TokenType||(t.TokenType={}))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(3)),a=r(n(8)),s=n(13);t.downloadSchema=e=>i(void 0,void 0,void 0,(function*(){const{endpoint:t,method:n,token:i,filename:r,headers:d}=e,u=yield fetch(t,{method:n||"POST",headers:Object.assign({"Content-Type":"application/json",Authorization:`Bearer ${i}`},d),body:JSON.stringify({query:s.getIntrospectionQuery()})});if(200!==u.status)throw new Error(`Failed to send introspection request with status code ${u.status}`);const l=yield u.json(),c=s.printSchema(s.buildClientSchema(l.data));return o.default.writeFileSync(a.default.resolve(r),c)}))},function(e,t){e.exports=require("graphql/utilities")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(31));t.auth=o;const a=r(n(79)),s=i(n(80));t.info=s;const d=i(n(88));t.scalar=d;const u={typeDefs:a.default};t.common=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(e),this.name="BadRequestError",this.message=e,this.metaData=t,this.status=400,Object.setPrototypeOf(this,i.prototype)}}t.default=i},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(10)),o=i(n(16)),a=i(n(18)),s=i(n(19)),d=i(n(20)),u=i(n(21));t.customFormatErrorFn=e=>{const{error:t,context:n,debug:i}=e,{logger:l,token:c}=n,{originalError:p}=t,f=t.stack.split("\n")||[];switch(!0){case p instanceof u.default:l.auth.error(p.message,Object.assign(Object.assign({},t),{meta:p.metaData,token:c,stack:f}));break;case p instanceof a.default:l.auth.error(p.message,Object.assign(Object.assign({},t),{meta:p.metaData,token:c,stack:f})),l.server.error(p.message,Object.assign(Object.assign({},t),{meta:p.metaData,token:c,stack:f}));break;case p instanceof o.default:case p instanceof s.default:case p instanceof d.default:l.server.error(p.message,Object.assign(Object.assign({},t),{meta:p.metaData,token:c,stack:f}));break;default:l.server.error("Error",Object.assign(Object.assign({},t),{token:c,stack:f}))}return i?(console.log(""),console.log(r.default.red("============== Caught the Error ==============")),console.log(""),p&&(p.message&&console.log(r.default.red(p.message)),p.metaData&&console.log(r.default.yellow("Error metadata"),p.metaData)),console.log(r.default.magenta("Access token payload"),c),console.log(""),console.log(r.default.red(t.stack)),console.log(""),console.log(r.default.red("============== End of Error report ==============")),console.log(""),{message:t.message,locations:t.locations,stack:t.stack?t.stack.split("\n"):[],path:t.path}):{message:t.message,locations:t.locations,path:t.path}},t.default=t.customFormatErrorFn},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(e),this.name="ForbiddenError",this.message=e,this.metaData=t,this.status=403,Object.setPrototypeOf(this,i.prototype)}}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(e),this.name="NotFoundError",this.message=e,this.metaData=t,this.status=404,Object.setPrototypeOf(this,i.prototype)}}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(e),this.name="ServerError",this.message=e,this.metaData=t,this.status=500,Object.setPrototypeOf(this,i.prototype)}}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(e),this.name="UnauthorizedError",this.message=e,this.metaData=t,this.status=401,Object.setPrototypeOf(this,i.prototype)}}t.default=i},function(e,t){e.exports=require("moment-timezone")},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(39),r=n(2),o={pool:new Map,logger:void 0};class a{static addJob(e,t){if(o.pool.get(e))throw new r.BadRequestError(`Cron job with name «${e}» already exists`,{jobName:e});const n=i.job(t);return o.logger&&(o.logger.server.debug(`New Cron job was added with name «${e}» at time ${t.cronTime}`,{jobConfig:t}),n.addCallback(()=>{o.logger.server.debug(`Called Cron job with name «${e}» at time ${t.cronTime}`,{jobConfig:t})})),o.pool.set(e,n),n}static getJob(e){return o.pool.get(e)}static getPool(){return o.pool}}t.CronJobManager=a,a.configure=e=>{const{logger:t}=e;o.logger=t},t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(26);var r;!function(e){e.TOKEN_REVOKED="token-revoked"}(r=t.SubscriptioTriggers||(t.SubscriptioTriggers={}));const o={tokenWasRevoked:{subscribe:i.withFilter((e,t,n)=>n.pubsub.asyncIterator(r.TOKEN_REVOKED),(e,t)=>e.tokenWasRevoked.includes(t.id))}};t.default=o},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(3)),a=r(n(41)),s=r(n(42)),d=r(n(8)),u=n(27),l=r(n(10)),c=r(n(43)),p=r(n(44)),f=r(n(45)),m=r(n(14)),y=r(n(46)),v=r(n(47)),k=n(0),h=n(48),g=n(49),T=n(50);t.withFilter=T.withFilter;const N=n(51),_=n(52),E=r(n(53)),b=r(n(54)),S=n(55),w=n(23),O=n(28),D=n(2),A=r(n(59)),L=n(29),I=n(15),M=r(n(7)),x=n(11),R=n(9),P=n(70),j=n(72),F=n(24),C=n(74),$=n(75);class G{constructor(e){this.props=Object.assign({port:R.DEFAULT_SERVER_PORT,endpoint:R.DEFAULT_GRAPHQL_ENDPOINT,timezone:R.DEFAULT_SERVER_TIMEZONE,subscriptionEndpoint:R.DEFAULT_GRAPHQL_SUBSCRIPTION_ENDPOINT,usePlayground:!1,enableIntrospection:!1,useVoyager:!1,debug:!1},e),this.props.sessions=!1!==this.props.sessions&&Object.assign({path:R.DEFAULT_SESSION_PATH,ttl:R.DEFAULT_SESSION_TTL,secret:R.DEFAULT_SESSION_SECRET},this.props.sessions),this.props.routes=Object.assign({voyager:R.DEFAULT_ROUTE_VOYAGER},this.props.routes)}bootstrap(e){var t;const{port:n,usePlayground:i,useVoyager:r,endpoint:o,routes:d,serverOptions:u,subscriptionEndpoint:l}=this.props,{app:c,schema:p,context:f}=this.createApp(),{logger:m}=f,y=null===(t=u)||void 0===t?void 0:t.cert;let v;process.on("warning",e=>m.server.warn(e.name,e));try{v=y?s.default.createServer(u||{},c):a.default.createServer(u||{},c)}catch(e){throw m.server.error("Failed to start server",{err:e}),new D.ServerError("Failed to start server",e)}const k=`http${y?"s":""}://localhost`;v.listen(n,()=>{const t={graphql:`${k}:${n}${o}`,subscriptions:`ws${y?"s":""}://localhost:${n}${l}`};i&&(t.graphiql=`${k}:${n}${o}${R.DEFAULT_ROUTE_GRAPHIQL}`),r&&(t.voyager=`${k}:${n}${d.voyager}`),m.server.debug(`App server started at «${t.graphql}»`),this.createSubscriptionServer({schema:p,server:v,context:f}),void 0!==e&&e({port:n,context:f,resolveUrl:t})})}createSubscriptionServer(e){const{subscriptionEndpoint:t,websocketOptions:n}=this.props,{server:r,schema:o,context:a}=e,s=new M.default({context:a});return new S.SubscriptionServer({execute:k.execute,schema:o,subscribe:k.subscribe,onConnect:e=>i(this,void 0,void 0,(function*(){const t=M.default.extractTokenFromSubscription(e),n=yield s.verifyToken(t);if(!n)throw new D.UnauthorizedError("Invalid token");if(n.type!==x.TokenType.access)throw new D.UnauthorizedError("Is not an access token");return a.token=n,a})),onDisconnect:e=>{e.close(),e.terminate()}},Object.assign({server:r,path:t},n))}createApp(){const{typeDefs:e,resolvers:t,endpoint:n,timezone:r,port:a,jwt:s,middlewares:k,database:T,expressMiddlewares:S,redis:G,logger:V,routes:B,subscriptionEndpoint:q,usePlayground:U,enableIntrospection:Q,useVoyager:K,serverOptions:J,debug:z,staticOptions:Z,sessions:X}=this.props,{cookieSign:H}=J||{};V.server.debug("Create application proc was started");const Y=m.default(),W=N.makeExecutableSchema({typeDefs:[I.scalar.typeDefs,I.common.typeDefs,I.info.typeDefs,I.auth.typeDefs,...e||[]],resolvers:[I.scalar.resolvers,I.info.resolvers,I.auth.resolvers,...t||[]],resolverValidationOptions:{requireResolversForResolveType:!1}}),ee=O.knexProvider(Object.assign({localTimezone:r,logger:V},T));let te,ne,ie;F.CronJobManager.configure({logger:V});const re=Object.assign({retryStrategy:e=>Math.min(50*e,2e4)},G);try{te=new E.default(re),ne=new E.default(re),ie=new E.default(re)}catch(e){throw new D.ServerError("Failed to init Redis handle",{err:e})}te.on("error",e=>{V.server.error(`Redis Common error ${e.errno}`,{err:e})}),ne.on("error",e=>{V.server.error(`Redis Publisher error ${e.errno}`,{err:e})}),ie.on("error",e=>{V.server.error(`Redis Subscriber error ${e.errno}`,{err:e})}),te.on("connect",()=>{V.server.debug("Redis common connection is Done")}),ne.on("connect",()=>{V.server.debug("Redis Publisher connection is Done")}),ie.on("connect",()=>{V.server.debug("Redis Subscriber connection is Done")}),te.on("reconnecting",()=>{V.server.debug("Redis common reconnecting")}),ne.on("reconnecting",()=>{V.server.debug("Redis Publisher reconnecting")}),ie.on("reconnecting",()=>{V.server.debug("Redis Subscriber reconnecting")}),te.on("close",()=>{V.server.debug("Redis common close")}),ne.on("close",()=>{V.server.debug("Redis Publisher close")}),ie.on("close",()=>{V.server.debug("Redis Subscriber close")});const oe={endpoint:n,timezone:r,jwt:s,logger:V,redis:te,pubsub:new g.RedisPubSub({publisher:ne,subscriber:ie,connection:G}),knex:ee,deviceInfo:{client:{type:"",name:"",version:"",engine:"",engineVersion:""},os:{name:"",version:"",platform:""},device:{type:"",brand:"",model:""},bot:null},startTime:0,token:{type:x.TokenType.access,id:"",uuid:"",roles:[],exp:0,iss:""}};if(!1!==X){const e=b.default(v.default);X.logFn=e=>V.session.info(e),Y.use(v.default({store:new e(X),secret:X.secret,genid:()=>w.v4(),resave:!1,saveUninitialized:!0,cookie:{secure:!0}})),Y.set("trust proxy",1)}if(Y.use(p.default({credentials:!0,origin:(e,t)=>t(null,!0)})),Y.use(m.default.json({limit:R.MAXIMUM_REQUEST_BODY_SIZE})),Y.use(m.default.urlencoded({extended:!0,limit:R.MAXIMUM_REQUEST_BODY_SIZE})),Y.use(c.default(H)),Y.use($.headersMiddleware()),Y.use(P.accessMiddleware({context:oe})),Z){const e=d.default.resolve(Z.staticDir);o.default.existsSync(e)||o.default.mkdirSync(e,{recursive:!0}),Y.use(Z.prefix,m.default.static(e))}if(Y.use(L.requestHandlerMiddleware({context:oe})),S&&S.length&&S.forEach(e=>{Y.use(e({context:oe}))}),Y.use(A.default({context:oe})),K){const{accessToken:e}=j.configureTokens([""],oe);V.server.debug("New AccessToken was created special for GraphQL voyager",{accessToken:e}),console.log(""),console.log(`${l.default.yellow.bold("Note: ")}${l.default.yellow("An access token was created specifically for GraphQL voyager")}`),console.log(`${l.default.yellow("This token was expire at")} ${l.default.yellowBright.bold(new Date(Date.now()+18e5))}`),console.log(l.default.yellow("After the token expires, you must restart the application")),Y.use(B.voyager,_.express({endpointUrl:n,headersJS:JSON.stringify({Authorization:`Bearer ${e.token}`})}))}const ae=e=>({queryTimeMs:u.performance.now()-e.context.startTime}),se=new M.default({context:oe});return Y.use(n,y.default(e=>i(this,void 0,void 0,(function*(){var t;const n=null===(t=J)||void 0===t?void 0:t.cert,i=M.default.extractToken(x.TokenType.access,e);if(""!==i){const e=yield se.verifyToken(i);if(!e)throw new D.UnauthorizedError("Invalid token");if(e.type!==x.TokenType.access)throw new D.UnauthorizedError("Is not an access token");oe.token=e}const r=new f.default;oe.deviceInfo=r.parse(e.headers["user-agent"]),oe.startTime=u.performance.now();const o=[...k||[]];return{context:oe,graphiql:U,extensions:z?ae:void 0,schema:h.applyMiddleware(W,...o),subscriptionEndpoint:`ws${n?"s":""}://localhost:${a}${q}`,customFormatErrorFn:e=>D.customFormatErrorFn({error:e,context:oe,debug:z}),validationRules:Q?[]:[C.DisableIntrospectionQueries]}})))),V.server.debug("Application was created"),F.CronJobManager.addJob("__clearExpiredTokens",{cronTime:"* 0 5 * * *",onTick:()=>i(this,void 0,void 0,(function*(){yield se.clearExpiredTokens()})),start:!0}),{app:Y,context:oe,schema:W,routes:B}}}t.App=G,t.default=G},function(e,t){e.exports=require("perf_hooks")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(56))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(60)),i(n(6)),i(n(68))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(14));t.Express=a;const s=r(n(15));t.schemas=s;const d=o(n(7));t.AuthService=d.default,i(n(26)),i(n(9)),i(n(29)),i(n(28)),i(n(2))},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(32));t.resolvers=o.default;const a=r(n(78));t.typeDefs=a;const s=i(n(7));t.service=s.default,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(11))},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(33)),o=i(n(34)),a=i(n(76)),s=i(n(25)),d=i(n(77)),u={Mutation:{auth:()=>({})},Query:{auth:()=>({})},Subscription:s.default,AuthMutation:o.default,AuthQuery:a.default,AccessTokenPayload:r.default,RefreshTokenPayload:d.default};t.default=u},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=new Proxy({id:()=>({}),type:()=>({}),uuid:()=>({}),roles:()=>({}),exp:()=>({}),iss:()=>({})},{get:(e,t)=>(e,n,r)=>i(void 0,void 0,void 0,(function*(){return(e.id&&""!==e.id?e:r.token)[t]}))});t.default=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),a=r(n(7)),s=n(11),d=n(25),u={getAccessToken:(e,t,n)=>i(void 0,void 0,void 0,(function*(){const{login:e,password:i}=t,{deviceInfo:r}=n,o=new a.default({context:n}),s=yield o.getAccountByCredentials(e,i);return yield o.registerTokens({uuid:s.id,deviceInfo:r})})),refreshToken:(e,t,n)=>i(void 0,void 0,void 0,(function*(){const{token:e}=t,{logger:i,deviceInfo:r}=n,d=new a.default({context:n}),u=yield d.verifyToken(String(e));if(!u)throw i.auth.info("Invalid token",{payload:u}),new o.UnauthorizedError("Invalid token",{payload:u});if(u.type!==s.TokenType.refresh)throw i.auth.info("Tried to refresh token by access token. Rejected",{payload:u}),new o.BadRequestError("Is not a refresh token",{payload:u});if(!(yield d.checkTokenExist(u.id)))throw i.auth.info("Tried to refresh token by revoked refresh token. Rejected",{payload:u}),new o.BadRequestError("This token was revoked",{payload:u});return yield d.revokeToken([u.associated,u.id]),yield d.registerTokens({uuid:u.uuid,deviceInfo:r})})),revokeToken:(e,t,n)=>i(void 0,void 0,void 0,(function*(){const{pubsub:e}=n,{id:i}=t;try{const t=new a.default({context:n});return yield t.revokeToken(i),e.publish(d.SubscriptioTriggers.TOKEN_REVOKED,{tokenWasRevoked:[i]}),!0}catch(e){throw new o.ServerError(`Failed to revoke token ${i}`,{id:i})}})),revokeAllTokens:(e,t,n)=>i(void 0,void 0,void 0,(function*(){const{pubsub:e}=n,{account:i}=t;try{const t=new a.default({context:n}),r=yield t.revokeAccountTokens(i);return e.publish(d.SubscriptioTriggers.TOKEN_REVOKED,{tokenWasRevoked:r}),!0}catch(e){throw new o.ServerError(`Failed to revoke account tokens ${i}`,{account:i})}}))};t.default=u},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("dataloader")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2);var r;!function(e){e.ASC="ASC",e.DESC="DESC"}(t.IDirectionRange||(t.IDirectionRange={})),function(e){e.EQ="=",e.NEQ="<>",e.GT=">",e.LT="<",e.GTE=">=",e.LTE="<=",e.IN="in",e.NOTIN="notIn",e.LIKE="like",e.ILIKE="ilike",e.NULL="IS NULL",e.NOTNULL="IS NOT NULL"}(r=t.TWhereAction||(t.TWhereAction={})),t.stringToCursor=e=>Buffer.from(String(e),"utf8").toString("base64"),t.cursorToString=e=>Buffer.from(e,"base64").toString("utf8"),t.makeNodeCursor=(e,n)=>t.stringToCursor([JSON.stringify(n),e].join("---")),t.getCursorPayload=e=>{try{const n=t.cursorToString(e).split("---")[0]||"";return JSON.parse(n)}catch(e){throw new i.ServerError("Failed to decode cursor payload",{err:e})}},t.nodeToEdge=(e,n,i)=>({node:e,cursor:t.makeNodeCursor(n,i)}),t.convertOrderByToKnex=e=>[...e||[]].map(({field:e,direction:t})=>({column:e,order:t})),t.convertJsonToKnex=(e,t)=>e.raw(`'${JSON.stringify(t)}'::jsonb`),t.applyAliases=(e,t)=>{const n=new Map;return Object.entries(t).forEach(([e,t])=>{(Array.isArray(t)?t:[t]).forEach(t=>{n.set(t,e)})}),e.map(e=>{const[t,i,r]=e,o=n.get(t)||n.get("*");return[o?`${o}.${t}`:t,i,r]})},t.convertWhereToKnex=(e,n,i)=>{if(void 0===n)return e;const o=[];return Array.isArray(n)&&n.forEach(([e,t,n])=>{o.push([e,t,n])}),Array.isArray(n)||Object.entries(n).forEach(([e,t])=>{o.push([e,r.EQ,t])}),[...i?t.applyAliases(o,i):o].forEach(([t,n,i])=>{switch(!0){case n===r.IN:e.whereIn(t,Array.isArray(i)?i:[i]);break;case n===r.NOTIN:e.whereNotIn(t,Array.isArray(i)?i:[i]);break;case n===r.NULL:e.whereNull(t);break;case n===r.NOTNULL:e.whereNotNull(t);break;default:e.where(t,n,i)}}),e},t.buildCursorConnection=(e,n)=>{const{nodes:i,totalCount:r,offset:o,limit:a,where:s,orderBy:d}=e,u=i.map((e,i)=>t.nodeToEdge(e,n,{offset:(o||0)+i+1,limit:a,where:s||[],orderBy:d||[]}));return{totalCount:r,edges:u,pageInfo:{startCursor:u.length?u[0].cursor:void 0,endCursor:u.length?u[u.length-1].cursor:void 0,hasPreviousPage:(o||0)>0,hasNextPage:(o||0)+a<r}}},t.buildQueryFilter=e=>{const{first:n,last:i,after:o,before:a,offset:s,orderBy:d,filter:u,search:l}=e,c={limit:Math.max(Number(n||i)||30,0),orderBy:d||[],revert:!!i,where:[],search:!1,offset:Math.max(Number(s)||0,0)};if(o||a){const e=t.getCursorPayload(o||a);return Object.assign(Object.assign({},c),e)}return void 0!==u&&(Array.isArray(u)&&(c.where=u),Array.isArray(u)||Object.entries(u).forEach(([e,t])=>{Array.isArray(t)?c.where.push([e,r.IN,t]):c.where.push([e,r.EQ,t])})),l&&Array.isArray(l)&&(c.search=l),l&&"field"in l&&(c.search=[l]),l&&"fields"in l&&Array.isArray(l.fields)&&(c.search=l.fields.map(e=>({field:e,query:l.query}))),c},t.extractNodeField=(e,t)=>[...e].map(e=>e[t]),t.extractNodeIds=e=>t.extractNodeField(e,"id"),t.collateForDataloader=(e,t,n)=>e.map(e=>t.find(t=>t.id===e)||(n?void 0:null)),t.arrayOfIdsToArrayOfObjectIds=e=>e.length?e.map(e=>({id:e})):null},function(e,t){e.exports=require("cron")},function(e,t,n){"use strict";(function(e){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(3)),o=i(n(8));t.replaceEnv=e=>e.replace(/\$\{([A-Z0-9_]+)\}/gi,(e,t)=>process.env[t]?String(process.env[t]):t),t.loadGraphQLConfig=n=>{if(!r.default.existsSync(n))throw new Error(`GraphQL config file ${n} not found`);const i=r.default.readFileSync(o.default.resolve(e,"../../.graphqlconfig"),"utf8");try{return JSON.parse(t.replaceEnv(i))}catch(e){throw console.error(e),new Error(`Failed to parse GraphQL config file ${n}`)}}}).call(this,"src/utils")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("device-detector-js")},function(e,t){e.exports=require("express-graphql")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("graphql-middleware")},function(e,t){e.exports=require("graphql-redis-subscriptions")},function(e,t){e.exports=require("graphql-subscriptions")},function(e,t){e.exports=require("graphql-tools")},function(e,t){e.exports=require("graphql-voyager/middleware")},function(e,t){e.exports=require("ioredis")},function(e,t){e.exports=require("session-file-store")},function(e,t){e.exports=require("subscriptions-transport-ws")},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(27),o=i(n(57)),a=i(n(22)),s=n(58),d=n(2),u=n(9);t.knexProvider=e=>{const{connection:t,logger:n,timezone:i,localTimezone:l}=e,c={};s.types.setTypeParser(s.types.builtins.TIMESTAMP,"text",e=>a.default.tz(e,l).toDate()),s.types.setTypeParser(s.types.builtins.TIMESTAMPTZ,"text",e=>a.default.tz(e,l).toDate()),s.types.setTypeParser(s.types.builtins.NUMERIC,parseFloat),n.server.debug("pg-types configured");const p=o.default({client:u.DATABASE_CLIENT,connection:t,pool:{afterCreate:(e,t)=>{e.query(`\n            SET TIMEZONE = '${i||"UTC"}';\n            SET CLIENT_ENCODING = ${u.DATABASE_CHARSET};\n          `,r=>{r?n.sql.debug("Connection error",{err:r}):(n.sql.debug(`The TIMEZONE was set to "${i||"UTC"}"`),n.sql.debug(`The charset was set to "${u.DATABASE_CHARSET}"`)),t(r,e)})}}});return p.on("query",e=>{const t=e.__knexQueryUid;c[t]={startTime:r.performance.now()}}).on("query-response",(e,t,i)=>{const o=t.__knexQueryUid,a=r.performance.now()-c[o].startTime;n.sql.debug(i.toString(),{queryTime:a})}).on("query-error",(e,t)=>{n.sql.error(t.sql,{err:e,bindings:t.bindings})}),n.server.debug("Knex provider configured"),p.raw("SELECT 1+1 AS result").then(()=>(n.server.debug("Test the Database connection by trying to authenticate is OK"),!0)).catch(e=>{throw n.server.error(e.name,e),new d.ServerError(e)}),p},t.default=t.knexProvider},function(e,t){e.exports=require("knex")},function(e,t){e.exports=require("pg")},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(17));t.default=e=>(t,n,i,o)=>{const{context:a}=e;r.default({context:a,error:t,debug:!1})}},function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),n(4);const r=n(61);let o;t.logger=o;const a=e=>{const{loggers:n}=e,a=i(e,["loggers"]);return t.logger=o=Object.assign({access:r.accessLogger(a),auth:r.authLogger(a),http:r.httpLogger(a),server:r.serverLogger(a),sql:r.sqlLogger(a),session:r.sessionLogger(a)},n),o};t.configureLogger=a,t.default=a},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(62));t.accessLogger=r.default;const o=i(n(63));t.authLogger=o.default;const a=i(n(64));t.httpLogger=a.default;const s=i(n(65));t.serverLogger=s.default;const d=i(n(66));t.sessionLogger=d.default;const u=i(n(67));t.sqlLogger=u.default},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);n(4);const o=n(1),a=i(n(6));t.default=e=>{const{logDir:t}=e;return r.createLogger({level:"info",format:a.default,transports:[new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_ACCESS}`,level:"warn",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES}),new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_ACCESS}`,level:"info",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES})]})}},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);n(4);const o=n(1),a=i(n(6));t.default=e=>{const{logDir:t}=e;return r.createLogger({level:"info",format:a.default,transports:[new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_AUTH}`,level:"info",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES}),new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_DEBUG}`,level:"debug",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES})]})}},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);n(4);const o=n(1),a=i(n(6));t.default=e=>{const{logDir:t}=e;return r.createLogger({level:"info",format:a.default,transports:[new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_HTTP}`,level:"info",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES})]})}},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);n(4);const o=n(1),a=i(n(6));t.default=e=>{const{logDir:t}=e;return r.createLogger({level:"debug",format:a.default,transports:[new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_WARNINGS}`,level:"warn",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES}),new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_ERRORS}`,level:"error",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES}),new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_DEBUG}`,level:"debug",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES})]})}},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);n(4);const o=n(1),a=i(n(6));t.default=e=>{const{logDir:t}=e;return r.createLogger({level:"info",format:a.default,transports:[new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_SESSIONS}`,level:"info",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES})]})}},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);n(4);const o=n(1),a=i(n(6));t.default=e=>{const{logDir:t}=e;return r.createLogger({level:"debug",format:a.default,transports:[new r.transports.DailyRotateFile({filename:`${t}/${o.LOG_FILENAME_SQL}`,level:"debug",datePattern:o.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:o.LOG_MAX_SIZE,maxFiles:o.LOG_MAX_FILES}),new r.transports.Console({level:"error",format:r.format.combine(r.format.colorize({all:!0}),r.format.simple())})]})}},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(69));t.requestHandlerMiddleware=r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const{context:t}=e,{logger:n}=t;return(e,t,i)=>{const{method:r,originalUrl:o,headers:a}=e,s=String(e.headers["x-forwarded-for"]||"").replace(/:\d+$/,"")||e.connection.remoteAddress,d="127.0.0.1"===s||"::1"===s?"localhost":s;return n.http.info(`${d} ${r} "${o}"`,{headers:a}),i()}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(71));t.accessMiddleware=e=>(t,n,r)=>i(void 0,void 0,void 0,(function*(){const{context:i}=e,{logger:a}=i,s=new o.default({context:i}),d=String(t.headers["x-forwarded-for"]||"").replace(/:\d+$/,"")||t.connection.remoteAddress||"unknown ip";return(yield s.isInBlackList(d))?(a.access.warn(`The ip address [${d}] is blacklisted. The request was blocked`,{ipAddress:d}),n.json({response:{status:69}}).end()):(a.access.info(`Request from [${d}]`,{ipAddress:d}),r())})),t.default=t.accessMiddleware},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(9);t.default=class{constructor(e){this.props=e}getBlackList(){return i(this,void 0,void 0,(function*(){const{redis:e}=this.props.context;return yield e.smembers(r.REDIS_IP_BLACKLIST)}))}addToBlackList(e){return i(this,void 0,void 0,(function*(){const{redis:t}=this.props.context;yield t.sadd(r.REDIS_IP_BLACKLIST,e)}))}removeFromBlackList(e){return i(this,void 0,void 0,(function*(){const{redis:t}=this.props.context;yield t.srem(r.REDIS_IP_BLACKLIST,e)}))}clearBlackList(){return i(this,void 0,void 0,(function*(){const{redis:e}=this.props.context;yield e.del(r.REDIS_IP_BLACKLIST)}))}isInBlackList(e){return i(this,void 0,void 0,(function*(){const{redis:t}=this.props.context,n=yield t.sismember(r.REDIS_IP_BLACKLIST,e);return Boolean(n)}))}}},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(73)),o=i(n(7)),a=(e,t)=>new o.default({context:t}).generateTokens({uuid:r.default(),roles:e},{access:2592e3,refresh:2592e3});t.configureTokens=a,t.default=a},function(e,t){e.exports=require("uuid/v4")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=["__Schema!","__Type!"];t.noIntrospectionAllowedMessage=(e,t)=>"Introspection has been disabled for this schema. The field "+`"${e}" of type "${String(t)}" is not allowed.`,t.DisableIntrospectionQueries=e=>({Field(n){const o=e.getType();o&&r.indexOf(String(o))>=0&&e.reportError(new i.GraphQLError(t.noIntrospectionAllowedMessage(n.name.value,o)))}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.headersMiddleware=()=>(e,t,n)=>{t.removeHeader("X-Powered-By"),t.setHeader("X-Developer","Via Profit"),n()},t.default=t.headersMiddleware},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(7)),a={validateToken:(e,t,n)=>i(void 0,void 0,void 0,(function*(){const{token:e}=t,i=new o.default({context:n});try{return(yield i.verifyToken(e))||null}catch(e){return null}}))};t.default=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=new Proxy({id:()=>({}),type:()=>({}),uuid:()=>({}),roles:()=>({}),exp:()=>({}),iss:()=>({})},{get:(e,t)=>e=>i(void 0,void 0,void 0,(function*(){return e[t]}))});t.default=r},function(e,t){var n={kind:"Document",definitions:[{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"auth"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthQuery"}}},directives:[]}]},{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"auth"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthMutation"}}},directives:[]}]},{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Subscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Called when the token with following id was revoked",block:!0},name:{kind:"Name",value:"tokenWasRevoked"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AuthQuery"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"validateToken"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"token"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"AccessTokenPayload"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AuthMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Access and refresh tokens",block:!0},name:{kind:"Name",value:"getAccessToken"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"login"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"password"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokensBag"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Refresh and return new Access and refresh tokens",block:!0},name:{kind:"Name",value:"refreshToken"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"token"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokensBag"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Revoke some token",block:!0},name:{kind:"Name",value:"revokeToken"},arguments:[{kind:"InputValueDefinition",description:{kind:"StringValue",value:"Token ID",block:!0},name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Revoke All tokens",block:!0},name:{kind:"Name",value:"revokeAllTokens"},arguments:[{kind:"InputValueDefinition",description:{kind:"StringValue",value:'"\nAccount ID',block:!0},name:{kind:"Name",value:"account"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Response data when authentification is success",block:!0},name:{kind:"Name",value:"TokensBag"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"accessToken"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccessTokenBag"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"refreshToken"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RefreshTokenBag"}}},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"TokenType"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"access"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"refresh"},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AccessTokenBag"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"token"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"payload"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccessTokenPayload"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"RefreshTokenBag"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"token"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"payload"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RefreshTokenPayload"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AccessTokenPayload"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"type"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokenType"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"uuid"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"roles"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"exp"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"iss"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"RefreshTokenPayload"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"type"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokenType"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"associated"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"uuid"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"roles"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"exp"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"iss"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]}],loc:{start:0,end:1359}};n.loc.source={body:'extend type Query {\n  auth: AuthQuery!\n}\n\nextend type Mutation {\n  auth: AuthMutation!\n}\n\nextend type Subscription {\n  """\n  Called when the token with following id was revoked\n  """\n  tokenWasRevoked (id: ID!): [ID!]!\n}\n\ntype AuthQuery {\n  validateToken (token: String): AccessTokenPayload\n}\n\ntype AuthMutation {\n  """\n  Returns Access and refresh tokens\n  """\n  getAccessToken(\n    login: String!,\n    password: String!\n    ): TokensBag!\n\n  """\n  Refresh and return new Access and refresh tokens\n  """\n  refreshToken(token: String!): TokensBag!\n\n    """\n  Revoke some token\n  """\n  revokeToken(\n    """\n    Token ID\n    """\n    id: ID!\n  ): Boolean\n\n  """\n  Revoke All tokens\n  """\n  revokeAllTokens(\n    """"\n    Account ID\n    """\n    account: ID!\n  ): Boolean\n}\n\n"""\nResponse data when authentification is success\n"""\ntype TokensBag {\n  accessToken: AccessTokenBag!\n  refreshToken: RefreshTokenBag!\n}\n\nenum TokenType {\n  access\n  refresh\n}\n\ntype AccessTokenBag {\n  token: String!\n  payload: AccessTokenPayload!\n}\n\ntype RefreshTokenBag {\n  token: String!\n  payload: RefreshTokenPayload!\n}\n\ntype AccessTokenPayload {\n  type: TokenType!\n  id: ID!\n  uuid: String!\n  roles: [String!]!\n  exp: Int!\n  iss: String!\n}\n\ntype RefreshTokenPayload {\n  type: TokenType!\n  id: ID!\n  associated: String!\n  uuid: String!\n  roles: [String!]!\n  exp: Int!\n  iss: String!\n}\n\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=n},function(e,t){var n={kind:"Document",definitions:[{kind:"EnumTypeDefinition",description:{kind:"StringValue",value:"Standart ordering options",block:!0},name:{kind:"Name",value:"OrderDirection"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"ASC"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"DESC"},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"Error handle interface",block:!0},name:{kind:"Name",value:"Error"},directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Error name. Can be short error message",block:!0},name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Error detail message string",block:!0},name:{kind:"Name",value:"msg"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Information about pagination in a connection.",block:!0},name:{kind:"Name",value:"PageInfo"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"hasPreviousPage"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"hasNextPage"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"startCursor"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"endCursor"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Node spec. interface",block:!0},name:{kind:"Name",value:"Node"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Edge spec. interface",block:!0},name:{kind:"Name",value:"Edge"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"node"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Node"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"cursor"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Connection spec. interface",block:!0},name:{kind:"Name",value:"Connection"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"totalCount"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"pageInfo"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"edges"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Edge"}}}},directives:[]}]}],loc:{start:0,end:746}};n.loc.source={body:'"""\nStandart ordering options\n"""\nenum OrderDirection {\n  ASC\n  DESC\n}\n\n"""\nError handle interface\n"""\ninterface Error {\n  """\n  Error name. Can be short error message\n  """\n  name: String!\n\n  """\n  Error detail message string\n  """\n  msg: String\n}\n\n\n"""\nInformation about pagination in a connection.\n"""\ntype PageInfo {\n  hasPreviousPage: Boolean!\n  hasNextPage: Boolean!\n  startCursor: String\n  endCursor: String\n}\n\n"""\nGraphQL Node spec. interface\n"""\ninterface Node {\n  id: ID!\n  createdAt: DateTime!\n  updatedAt: DateTime!\n}\n\n"""\nGraphQL Edge spec. interface\n"""\ninterface Edge {\n  node: Node!\n  cursor: String!\n}\n\n"""\nGraphQL Connection spec. interface\n"""\ninterface Connection {\n  totalCount: Int!\n  pageInfo: PageInfo!\n  edges: [Edge]!\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=n},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(81));t.resolvers=o.default;const a=r(n(87));t.typeDefs=a},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(82)),o=i(n(84)),a=i(n(85)),s={Query:{info:()=>({})},Mutation:{info:()=>({})},Subscription:i(n(86)).default,InfoQuery:a.default,InfoMutation:o.default,Developer:r.default};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(83),r={name:()=>i.Developer.name,url:()=>i.Developer.url,email:()=>i.Developer.email};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1);t.Developer={name:i.DEV_INFO_DEVELOPER_NAME,url:i.DEV_INFO_DEVELOPER_URL,email:i.DEV_INFO_DEVELOPER_EMAIL}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={echo:(e,t,n)=>{const{str:i}=t,{pubsub:r}=n;return r.publish("info",{info:i}),i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={developer:()=>({})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={info:{subscribe:(e,t,n)=>n.pubsub.asyncIterator("info")}}},function(e,t){var n={kind:"Document",definitions:[{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InfoQuery"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InfoMutation"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Subscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Info module queries",block:!0},name:{kind:"Name",value:"InfoQuery"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer info",block:!0},name:{kind:"Name",value:"developer"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Developer"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"InfoMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"echo"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"str"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Developer info",block:!0},name:{kind:"Name",value:"Developer"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer company name",block:!0},name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer url",block:!0},name:{kind:"Name",value:"url"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"URL"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer email address",block:!0},name:{kind:"Name",value:"email"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EmailAddress"}}},directives:[]}]}],loc:{start:0,end:506}};n.loc.source={body:'type Query {\n  info: InfoQuery!\n}\n\ntype Mutation {\n  info: InfoMutation!\n}\n\ntype Subscription {\n  info: String!\n}\n\n\n"""\nInfo module queries\n"""\ntype InfoQuery {\n\n  """\n  Returns developer info\n  """\n  developer: Developer!\n \n}\n\ntype InfoMutation {\n  echo(str: String!): String!\n}\n\n"""\nDeveloper info\n"""\ntype Developer {\n\n  """\n  Returns developer company name\n  """\n  name: String!\n\n  """\n  Returns developer url\n  """\n  url: URL!\n\n  """\n  Returns developer email address\n  """\n  email: EmailAddress!\n}\n\n\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=n},function(e,t,n){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(89));t.resolvers=r;const o=i(n(97));t.typeDefs=o},function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(90));t.Date=r.default;const o=i(n(91));t.DateTime=o.default;const a=i(n(92));t.EmailAddress=a.default;const s=n(93);t.JSON=s.JSON,t.JSONObject=s.JSONObject;const d=i(n(94));t.Money=d.default;const u=i(n(95));t.Time=u.default;const l=i(n(96));t.URL=l.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=new RegExp(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/);t.default=new i.GraphQLScalarType({name:"Date",description:"Analogue of Date object",serialize(e){let t=e;if(!(t instanceof Date)&&"string"!=typeof t)throw new TypeError(`Value is not an instance of Date, Date string: ${JSON.stringify(t)}`);if("string"==typeof t&&(t=new Date,t.setTime(Date.parse(e))),Number.isNaN(t.getTime()))throw new TypeError(`Value is not a valid Date: ${JSON.stringify(t)}`);return[t.getFullYear(),`0${t.getMonth()+1}`.slice(-2),`0${t.getDate()}`.slice(-2)].join("-")},parseValue(e){const t=new Date(e);if(!r.test(e))throw new TypeError(`Value is not a valid date only: ${e}`);if(Number.isNaN(t.getTime()))throw new TypeError(`Value is not a valid Date: ${e}`);return t},parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only parse strings to dates but got a: ${e.kind}`);if(!r.test(e.value))throw new TypeError(`Value is not a valid date only: ${e.value}`);const t=new Date(e.value);if(Number.isNaN(t.getTime()))throw new i.GraphQLError(`Value is not a valid Date: ${e.value}`);return t}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.default=new i.GraphQLScalarType({name:"DateTime",description:"Analogue of Date object",serialize(e){let t=e;if(!(t instanceof Date)&&"string"!=typeof t&&"number"!=typeof t)throw new TypeError(`Value is not an instance of Date, Date string or number: ${JSON.stringify(t)}`);if("string"==typeof t?(t=new Date,t.setTime(Date.parse(e))):"number"==typeof t&&(t=new Date(t)),Number.isNaN(t.getTime()))throw new TypeError(`Value is not a valid Date: ${JSON.stringify(t)}`);return t.toJSON()},parseValue(e){const t=new Date(e);if(Number.isNaN(t.getTime()))throw new TypeError(`Value is not a valid Date: ${e}`);return t},parseLiteral(e){if(e.kind!==i.Kind.STRING&&e.kind!==i.Kind.INT)throw new i.GraphQLError(`Can only parse strings & integers to dates but got a: ${e.kind}`);const t=new Date(e.kind===i.Kind.INT?Number(e.value):e.value);if(Number.isNaN(t.getTime()))throw new i.GraphQLError(`Value is not a valid Date: ${e.value}`);return t}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=new RegExp(/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/);t.default=new i.GraphQLScalarType({name:"EmailAddress",description:"A field whose value conforms to the standard internet email address format as specified in RFC822: https://www.w3.org/Protocols/rfc822/.",serialize(e){if("string"!=typeof e)throw new TypeError(`Value is not string: ${e}`);if(!r.test(e))throw new TypeError(`Value is not a valid email address: ${e}`);return e},parseValue(e){if("string"!=typeof e)throw new TypeError("Value is not string");if(!r.test(e))throw new TypeError(`Value is not a valid email address: ${e}`);return e},parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only validate strings as email addresses but got a: ${e.kind}`);if(!r.test(e.value))throw new TypeError(`Value is not a valid email address: ${e.value}`);return e.value}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);function r(e){return e}function o(e){if("object"!=typeof e||null===e||Array.isArray(e))throw new TypeError(`JSONObject cannot represent non-object value: ${e}`);return e}function a(e,t){const n=Object.create(null);return e.fields.forEach(e=>{n[e.name.value]=s(e.value,t)}),n}function s(e,t){switch(e.kind){case i.Kind.STRING:case i.Kind.BOOLEAN:return e.value;case i.Kind.INT:case i.Kind.FLOAT:return parseFloat(e.value);case i.Kind.OBJECT:return a(e,t);case i.Kind.LIST:return e.values.map(e=>s(e,t));case i.Kind.NULL:return null;case i.Kind.VARIABLE:{const n=e.name.value;return t?t[n]:void 0}default:return e.value}}t.JSON=new i.GraphQLScalarType({name:"JSON",description:"The `JSON` scalar type represents JSON values as specified by [ECMA-404](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).",serialize:r,parseValue:r,parseLiteral:s}),t.JSONObject=new i.GraphQLScalarType({name:"JSONObject",description:"The `JSONObject` scalar type represents JSON objects as specified by [ECMA-404](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).",serialize:o,parseValue:o,parseLiteral:a})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.default=new i.GraphQLScalarType({name:"Money",description:"The value is stored in the smallest monetary unit.",serialize(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError(`Value is not an instance of string or number: ${JSON.stringify(e)}`);return Number(e)},parseValue(e){if("string"==typeof e)throw new TypeError(`Value is not a valid Integer: ${e}`);return BigInt(e)},parseLiteral(e){if(e.kind!==i.Kind.STRING&&e.kind!==i.Kind.INT)throw new i.GraphQLError(`Can only parse strings & integers to money but got a: ${e.kind}`);try{return BigInt(e.value)}catch(t){throw new i.GraphQLError(`Value is not a valid Money: ${e.value}`)}}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=new RegExp(/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/);t.default=new i.GraphQLScalarType({name:"Time",description:"Time string",serialize(e){if("string"!=typeof e)throw new TypeError(`Value is not string: ${e}`);if(!r.test(e))throw new TypeError(`Value is not a valid time: ${e}`);return 5===e.length?`${e}:00`:e},parseValue(e){if("string"!=typeof e)throw new TypeError("Value is not string");if(!r.test(e))throw new TypeError(`Value is not a valid time: ${e}`);return 5===e.length?`${e}:00`:e},parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only validate strings as time but got a: ${e.kind}`);if(!r.test(e.value))throw new TypeError(`Value is not a valid time: ${e.value}`);return 5===e.value.length?`${e.value}:00`:e.value}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.default=new i.GraphQLScalarType({name:"URL",description:"A field whose value conforms to the standard URL format as specified in RFC3986: https://www.ietf.org/rfc/rfc3986.txt.",serialize:e=>new URL(e.toString()).toString(),parseValue:e=>new URL(e.toString()),parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only validate strings as URLs but got a: ${e.kind}`);return new URL(e.value.toString())}})},function(e,t){var n={kind:"Document",definitions:[{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"Money type.\nThe value is stored in the smallest monetary unit (kopecks, cents, etc.)\nReal type - Int\ne.g. For 250 USD this record returns value as 250000 (250$ * 100¢) ",block:!0},name:{kind:"Name",value:"Money"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"DateTime type.\nUse JavaScript Date object for date/time fields\nReal type - String",block:!0},name:{kind:"Name",value:"DateTime"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"DateTime type.\nUse JavaScript Date object for date fields\nReal type - String",block:!0},name:{kind:"Name",value:"Date"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"Time type.\nReal type - String",block:!0},name:{kind:"Name",value:"Time"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"URL type.\nA field whose value conforms to the standard URL format as specified in RFC3986: https://www.ietf.org/rfc/rfc3986.txt.\nReal type - String",block:!0},name:{kind:"Name",value:"URL"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"Email address type.\nA field whose value conforms to the standard internet email address format as specified in RFC822: https://www.w3.org/Protocols/rfc822/.\nReal type - String",block:!0},name:{kind:"Name",value:"EmailAddress"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"The JSON scalar type represents JSON values as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.",block:!0},name:{kind:"Name",value:"JSON"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"The JSONObject scalar type represents JSON objects as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.",block:!0},name:{kind:"Name",value:"JSONObject"},directives:[]}],loc:{start:0,end:1165}};n.loc.source={body:'"""\nMoney type.\nThe value is stored in the smallest monetary unit (kopecks, cents, etc.)\nReal type - Int\ne.g. For 250 USD this record returns value as 250000 (250$ * 100¢) \n"""\nscalar Money\n\n"""\nDateTime type.\nUse JavaScript Date object for date/time fields\nReal type - String\n"""\nscalar DateTime\n\n"""\nDateTime type.\nUse JavaScript Date object for date fields\nReal type - String\n"""\nscalar Date\n\n"""\nTime type.\nReal type - String\n"""\nscalar Time\n\n"""\nURL type.\nA field whose value conforms to the standard URL format as specified in RFC3986: https://www.ietf.org/rfc/rfc3986.txt.\nReal type - String\n"""\nscalar URL\n\n"""\nEmail address type.\nA field whose value conforms to the standard internet email address format as specified in RFC822: https://www.w3.org/Protocols/rfc822/.\nReal type - String\n"""\nscalar EmailAddress\n\n"""\nThe JSON scalar type represents JSON values as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.\n"""\nscalar JSON\n\n"""\nThe JSONObject scalar type represents JSON objects as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.\n"""\nscalar JSONObject\n\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=n}]);