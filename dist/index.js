module.exports=function(e){var n={};function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(n){return e[n]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=33)}([function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(18));n.BadRequestError=o.default;const r=i(t(49));n.customFormatErrorFn=r.default;const a=i(t(19));n.ForbiddenError=a.default;const s=i(t(20));n.NotFoundError=s.default;const d=i(t(21));n.ServerError=d.default;const u=i(t(22));n.UnauthorizedError=u.default},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=o(t(50));n.DataLoader=r.default,i(t(51)),i(t(11)),i(t(13)),i(t(24)),i(t(4)),i(t(25)),i(t(26))},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("fs")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TOKEN_BEARER_KEY="Authorization",n.TOKEN_ACCESS_TOKEN_COOKIE_KEY="AccessToken",n.TOKEN_REFRESH_TOKEN_COOKIE_KEY="RefreshToken",n.TOKEN_BEARER="Bearer",n.DATABASE_CHARSET="UTF8",n.DATABASE_CLIENT="pg",n.DEFAULT_SERVER_PORT=4e3,n.DEFAULT_GRAPHQL_ENDPOINT="/graphql",n.DEFAULT_GRAPHQL_SUBSCRIPTION_ENDPOINT="/subscriptions",n.DEFAULT_SERVER_TIMEZONE="UTC",n.DEFAULT_ROUTE_AUTH="/auth",n.DEFAULT_ROUTE_PLAYGROUND="/playground",n.DEFAULT_ROUTE_VOYAGER="/voyager",n.MAXIMUM_REQUEST_BODY_SIZE="50mb",n.DEV_INFO_DEVELOPER_NAME="Via Profit",n.DEV_INFO_DEVELOPER_URL="https://via-profit.ru",n.LOG_FILENAME_AUTH="auth-%DATE%.log",n.LOG_FILENAME_HTTP="http-%DATE%.log",n.LOG_FILENAME_DEBUG="debug-%DATE%.log",n.LOG_FILENAME_ERRORS="errors-%DATE%.log",n.LOG_FILENAME_SQL="sql-%DATE%.log",n.LOG_DATE_PATTERNT="YYYY-MM-DD",n.LOG_MAZ_SIZE="20m",n.LOG_MAZ_FILES="14d"},function(e,n){e.exports=require("winston-daily-rotate-file")},function(e,n){e.exports=require("winston")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(6);n.default=i.format.combine(i.format.metadata(),i.format.json(),i.format.timestamp({format:"YYYY-MM-DDTHH:mm:ssZZ"}),i.format.splat(),i.format.printf(e=>{const{timestamp:n,level:t,message:i,metadata:o}=e,r="{}"!==JSON.stringify(o)?o:null;return`${n} ${t}: ${i} ${r?JSON.stringify(r):""}`}))},function(e,n){e.exports=require("chalk")},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=o(t(3)),a=o(t(46)),s=o(t(47)),d=o(t(17)),u=t(48),c=t(0),l=t(1),p=t(13);var f,m,v;!function(e){e.access="access",e.refresh="refresh"}(f=n.TokenType||(n.TokenType={})),function(e){e.allowed="allowed",e.forbidden="forbidden"}(m=n.AccountStatus||(n.AccountStatus={})),function(e){e.authentificationRequired="authentificationRequired",e.accountNotFound="accountNotFound",e.accountForbidden="accountForbidden",e.invalidLoginOrPassword="invalidLoginOrPassword",e.tokenExpired="tokenExpired",e.isNotAnAccessToken="isNotAnAccessToken",e.isNotARefreshToken="isNotARefreshToken",e.tokenWasRevoked="tokenWasRevoked"}(v=n.ResponseErrorType||(n.ResponseErrorType={}));class k{constructor(e){this.props=e}static cryptUserPassword(e){const n=a.default.genSaltSync(10);return a.default.hashSync(e,n)}static verifyToken(e,n){if(null===e||""===e)throw new c.UnauthorizedError("The token must be provided");try{const t=r.default.readFileSync(n);return s.default.verify(String(e),t)}catch(e){throw new c.UnauthorizedError("Token verification failed",e)}}registerTokens(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t,logger:i}=n,o=yield t.select(["id","roles"]).from("accounts").where({id:e.uuid}).first();if("string"!=typeof o.id)throw new c.ServerError(`Account with id[${o.id}] not found`);const r=this.generateTokens({uuid:o.id,roles:o.roles});try{yield t("tokens").insert({id:r.accessToken.payload.id,account:r.accessToken.payload.uuid,type:f.access,deviceInfo:e.deviceInfo,expiredAt:d.default(r.accessToken.payload.exp).format()})}catch(e){throw new c.ServerError("Failed to register access token",e)}try{yield t("tokens").insert({id:r.refreshToken.payload.id,account:r.refreshToken.payload.uuid,type:f.refresh,associated:r.accessToken.payload.id,deviceInfo:e.deviceInfo,expiredAt:d.default(r.refreshToken.payload.exp).format()})}catch(e){throw new c.ServerError("Failed to register refresh token",e)}return i.auth.info("New Access token was registered",r.accessToken.payload),r}))}generateTokens(e,n){var t,i;const{context:o}=this.props,a=(null===(t=n)||void 0===t?void 0:t.access)?n.access:o.jwt.accessTokenExpiresIn,d=(null===(i=n)||void 0===i?void 0:i.refresh)?n.refresh:o.jwt.refreshTokenExpiresIn;try{r.default.accessSync(o.jwt.privateKey)}catch(e){throw new c.ServerError("Failed to open JWT privateKey file",{err:e})}const l=r.default.readFileSync(o.jwt.privateKey),p=Object.assign(Object.assign({},e),{type:f.access,id:u.v4(),exp:Math.floor(Date.now()/1e3)+Number(a),iss:o.jwt.issuer}),m=Object.assign(Object.assign({},e),{type:f.refresh,id:u.v4(),associated:p.id,exp:Math.floor(Date.now()/1e3)+Number(d),iss:o.jwt.issuer}),v=s.default.sign(p,l,{algorithm:o.jwt.algorithm}),k=s.default.sign(m,l,{algorithm:o.jwt.algorithm});return{accessToken:{token:v,payload:Object.assign(Object.assign({},p),{type:f.access})},refreshToken:{token:k,payload:Object.assign(Object.assign({},m),{type:f.refresh})}}}revokeToken(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t}=n,i=yield t.del().from("tokens").where({id:e}).returning("*");return Number(i[0])}))}revokeAccountTokens(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t}=n,i=yield t.del().from("tokens").where({account:e}).returning("*");return Number(i[0])}))}static extractTokenFromSubscription(e){if("object"==typeof e&&l.TOKEN_BEARER_KEY in e){const[n,t]=String(e[l.TOKEN_BEARER_KEY]).split(" ");if(n===l.TOKEN_BEARER&&""!==t)return String(t)}return""}static extractToken(e,n){const{headers:t,body:i}=n;if(e===f.access){if(l.TOKEN_BEARER_KEY.toLocaleLowerCase()in t){const[e,n]=String(t[l.TOKEN_BEARER_KEY.toLocaleLowerCase()]).split(" ");if(e===l.TOKEN_BEARER&&""!==n)return String(n)}if(l.TOKEN_ACCESS_TOKEN_COOKIE_KEY in n.signedCookies)return String(n.signedCookies[l.TOKEN_ACCESS_TOKEN_COOKIE_KEY]);if(l.TOKEN_ACCESS_TOKEN_COOKIE_KEY in i)return String(i[l.TOKEN_ACCESS_TOKEN_COOKIE_KEY])}if(e===f.refresh){if(l.TOKEN_REFRESH_TOKEN_COOKIE_KEY in n.signedCookies)return String(n.signedCookies[l.TOKEN_REFRESH_TOKEN_COOKIE_KEY]);if(l.TOKEN_REFRESH_TOKEN_COOKIE_KEY in i)return String(i[l.TOKEN_REFRESH_TOKEN_COOKIE_KEY])}return""}checkTokenExist(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t}=n;return null!==(yield t.select(["id"]).from("tokens").where({id:e}).first())}))}checkAccountExists(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t}=n;return void 0!==(yield t.select(["id","login"]).from("accounts").where({login:e}).first())}))}getAccountByLogin(e,n){return i(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:i}=t,o=yield i.select(["id","password","status","roles"]).from("accounts").where({login:e}).first();return void 0===o?{error:v.accountNotFound,account:!1}:"string"!=typeof n||a.default.compareSync(n,o.password)?o.status===m.forbidden?{error:v.accountForbidden,account:!1}:{account:{id:o.id,password:o.password,status:o.status,roles:o.roles}}:{error:v.invalidLoginOrPassword,account:!1}}))}static sendResponseError(e,n){const t=[];switch(e){case"accountForbidden":t.push({message:"Account locked",name:"Authorization error"});break;case"authentificationRequired":t.push({message:"Authentication Required",name:"Authorization error"});break;case"isNotARefreshToken":t.push({message:"Token error",name:"Is not a refresh token"});break;case"isNotAnAccessToken":t.push({message:"Token error",name:"Is not an access token"});break;case"tokenExpired":t.push({message:"Token error",name:"This token expired"});break;case"tokenWasRevoked":t.push({message:"Token error",name:"Token was revoked"});break;case"accountNotFound":case"invalidLoginOrPassword":default:t.push({message:"Invalid login or password",name:"Authorization error"})}return n.status(401).json({errors:t})}getAccounts(e){const{context:n}=this.props,{knex:t}=n,{limit:i,offset:o,orderBy:r,where:a}=e;return t.select(["j.totalCount","accounts.*"]).join(t("accounts").select(["id",t.raw('count(*) over() as "totalCount"')]).orderBy(p.convertOrderByToKnex(r)).limit(i).offset(o).where(e=>p.convertWhereToKnex(e,a)).andWhere("deleted",!1).as("j"),"j.id","accounts.id").orderBy(p.convertOrderByToKnex(r)).from("accounts").then(e=>({totalCount:(e.length?e[0]:{totalCount:0}).totalCount,limit:i,offset:o,nodes:e}))}getAccountsByIds(e){return i(this,void 0,void 0,(function*(){const{nodes:n}=yield this.getAccounts({limit:e.length,offset:0,where:[["id",p.TWhereAction.IN,e]]});return n}))}updateAccount(e,n){return i(this,void 0,void 0,(function*(){const{knex:t,timezone:i}=this.props.context,o=n;return o.password&&(o.password=k.cryptUserPassword(o.password)),o.roles&&(o.roles=p.convertJsonToKnex(t,o.roles)),(yield t("accounts").update(Object.assign(Object.assign({},o),{updatedAt:d.default.tz(i).format()})).where("id",e).returning("id"))[0]}))}createAccount(e){return i(this,void 0,void 0,(function*(){const{knex:n,timezone:t}=this.props.context,i=d.default.tz(t).format();return(yield n("accounts").insert(Object.assign(Object.assign({},e),{id:e.id?e.id:u.v4(),roles:p.convertJsonToKnex(n,e.roles),password:k.cryptUserPassword(e.password),createdAt:i,updatedAt:i})).returning("id"))[0]}))}deleteAccount(e){return i(this,void 0,void 0,(function*(){return this.updateAccount(e,{login:u.v4(),password:u.v4(),deleted:!0,status:m.forbidden})}))}}n.Authentificator=k},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),i(t(9)),i(t(28))},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=o(t(3)),a=o(t(2)),s=t(12);n.downloadSchema=e=>i(void 0,void 0,void 0,(function*(){const{endpoint:n,method:t,token:i,filename:o,headers:d}=e,u=yield fetch(n,{method:t||"POST",headers:Object.assign({"Content-Type":"application/json",Authorization:`Bearer ${i}`},d),body:JSON.stringify({query:s.getIntrospectionQuery()})});if(200!==u.status)throw new Error(`Failed to send introspection request with status code ${u.status}`);const c=yield u.json(),l=s.printSchema(s.buildClientSchema(c.data));return r.default.writeFileSync(a.default.resolve(o),l)}))},function(e,n){e.exports=require("graphql/utilities")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(0);var o,r;!function(e){e.ASC="ASC",e.DESC="DESC"}(o=n.IDirectionRange||(n.IDirectionRange={})),function(e){e.EQ="=",e.NEQ="<>",e.GT=">",e.LT="<",e.GTE=">=",e.LTE="<=",e.IN="in",e.NOTIN="notIn"}(r=n.TWhereAction||(n.TWhereAction={})),n.stringToCursor=e=>Buffer.from(String(e),"utf8").toString("base64"),n.cursorToString=e=>Buffer.from(e,"base64").toString("utf8"),n.makeNodeCursor=e=>{const{limit:t,offset:i,revert:o,id:r}=e;return n.stringToCursor(JSON.stringify([t,i,o,r]))},n.getNodeCursor=e=>{const t=n.cursorToString(e);try{const[e,n,i,o]=JSON.parse(t);return{limit:e,offset:n,revert:i,id:o}}catch(n){throw new i.ServerError(`The cursor «${e}» is invalid because it contains the wrong JSON data`)}},n.nodeToEdge=(e,t)=>({node:e,cursor:n.makeNodeCursor(Object.assign(Object.assign({},t),{id:e.id}))}),n.nodesToEdges=(e,t)=>[...e||[]].map(e=>n.nodeToEdge(e,t)),n.convertOrderByToKnex=e=>[...e||[]].map(({field:e,direction:n})=>({column:e,order:n})),n.convertJsonToKnex=(e,n)=>e.raw(`'${JSON.stringify(n)}'::jsonb`),n.convertWhereToKnex=(e,n)=>{if(void 0===n)return e;const t=[];return Array.isArray(n)&&n.forEach(([e,n,i])=>{t.push([e,n,i])}),Array.isArray(n)||Object.entries(n).forEach(([e,n])=>{t.push([e,r.EQ,n])}),t.forEach(([n,t,i])=>{switch(!0){case t===r.IN:e.whereIn(n,Array.isArray(i)?i:[i]);break;case t===r.NOTIN:e.whereNotIn(n,Array.isArray(i)?i:[i]);break;default:e.where(n,t,i)}}),e},n.buildCursorConnection=e=>{const{nodes:t,totalCount:i,offset:o,limit:r,revert:a}=e,s=n.nodesToEdges(t,{limit:r,offset:o,revert:Boolean(a)});return{totalCount:i,edges:s,pageInfo:{startCursor:s.length?s[0].cursor:void 0,endCursor:s.length?s[s.length-1].cursor:void 0,hasPreviousPage:o>0,hasNextPage:o+r<i}}},n.buildQueryFilter=e=>{const{first:t,last:i,after:a,before:s,offset:d,orderBy:u,filter:c}=e,l={limit:Math.max(Number(t||i)||30,0),orderBy:u||[],revert:!!i,where:[],offset:Math.max(Number(d)||0,0)};if(a||s){const e=n.getNodeCursor(a||s);l.limit=e.limit,l.offset=e.offset,l.revert=e.revert,l.cursor=e}return l.orderBy.length||l.orderBy.push({field:"createdAt",direction:o.DESC}),l.orderBy.push({field:"id",direction:o.DESC}),void 0!==c&&(Array.isArray(c)&&(l.where=c),Array.isArray(c)||Object.entries(c).forEach(([e,n])=>{l.where.push([e,r.EQ,n])})),l},n.extractNodeField=(e,n)=>[...e].map(e=>e[n]),n.extractNodeIds=e=>n.extractNodeField(e,"id")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(10),o=t(1),r={accounts:null};n.default=function(e){if(null!==r.accounts)return r;const n=new i.Authentificator({context:e});return r.accounts=new o.DataLoader(e=>n.getAccountsByIds(e)),r}},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("graphql")},function(e,n){e.exports=require("moment-timezone")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="BadRequestError",this.message=e,this.metaData=n,this.status=400,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="ForbiddenError",this.message=e,this.metaData=n,this.status=403,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="NotFoundError",this.message=e,this.metaData=n,this.status=404,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="ServerError",this.message=e,this.metaData=n,this.status=500,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="UnauthorizedError",this.message=e,this.metaData=n,this.status=401,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n){e.exports=require("graphql-subscriptions")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(52),o=t(0),r={pool:new Map,logger:void 0};class a{static addJob(e,n){if(r.pool.get(e))throw new o.ServerError(`Cron job with name «${e}» already exists`,{jobName:e});const t=i.job(n);return r.logger&&(r.logger.server.debug(`New Cron job was added with name «${e}» at time ${n.cronTime}`,{jobConfig:n}),t.addCallback(()=>{r.logger.server.debug(`Called Cron job with name «${e}» at time ${n.cronTime}`,{jobConfig:n})})),r.pool.set(e,t),t}static getJob(e){return r.pool.get(e)}static getPool(){return r.pool}}n.CronJobManager=a,a.configure=e=>{const{logger:n}=e;r.logger=n},n.default=a},function(e,n,t){"use strict";(function(e){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(3)),r=i(t(2));n.replaceEnv=e=>e.replace(/\$\{([A-Z0-9_]+)\}/gi,(e,n)=>process.env[n]?String(process.env[n]):n),n.loadGraphQLConfig=t=>{if(!o.default.existsSync(t))throw new Error(`GraphQL config file ${t} not found`);const i=o.default.readFileSync(r.default.resolve(e,"../../.graphqlconfig"),"utf8");try{return JSON.parse(n.replaceEnv(i))}catch(e){throw console.error(e),new Error(`Failed to parse GraphQL config file ${t}`)}}}).call(this,"src/utils")},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const o=t(27);var r;!function(e){e.ADMIN="admin",e.DEVELOPER="developer"}(r=n.Role||(n.Role={})),n.isAuthenticated=o.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){var e,n;return""!==String(null===(n=null===(e=t)||void 0===e?void 0:e.token)||void 0===n?void 0:n.uuid)}))),n.isAdmin=o.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){var e,n;return null===(n=null===(e=t)||void 0===e?void 0:e.token)||void 0===n?void 0:n.roles.includes(r.ADMIN)}))),n.isOwner=o.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){var n,i,o;return(null===(i=null===(n=t)||void 0===n?void 0:n.token)||void 0===i?void 0:i.uuid)===(null===(o=e)||void 0===o?void 0:o.uuid)}))),n.isDeveloper=o.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){return t.token.roles.includes(r.DEVELOPER)})))},function(e,n){e.exports=require("graphql-shield")},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=o(t(53)),a=t(15),s=o(t(54)),d=t(0),u=t(1),c=t(9),l=e=>{const{context:n,authUrl:t}=e,{publicKey:o}=e.context.jwt,{logger:l}=n,p=new c.Authentificator({context:n}),f=a.Router();return f.post(`${t}/access-token`,s.default((n,t)=>i(void 0,void 0,void 0,(function*(){const{body:i,headers:o}=n,a=(new r.default).parse(o["user-agent"]),{login:s,password:f}=i;if("string"!=typeof s||"string"!=typeof f)throw new d.BadRequestError("login and password must be provied");l.auth.info("Access token request",{login:s});const{error:m,account:v}=yield p.getAccountByLogin(s,f);if(void 0!==m||!1===v)return l.auth.error(m,{login:s}),c.Authentificator.sendResponseError(m,t);const k=yield p.registerTokens({uuid:v.id,deviceInfo:a});t.cookie(u.TOKEN_ACCESS_TOKEN_COOKIE_KEY,k.accessToken.token,{expires:new Date((new Date).getTime()+1e3*e.context.jwt.accessTokenExpiresIn),signed:!0,httpOnly:!0,secure:!0}),t.cookie(u.TOKEN_REFRESH_TOKEN_COOKIE_KEY,k.refreshToken.token,{expires:new Date((new Date).getTime()+1e3*e.context.jwt.refreshTokenExpiresIn),signed:!0,httpOnly:!0,secure:!0});const y={accessToken:k.accessToken.token,tokenType:u.TOKEN_BEARER,expiresIn:e.context.jwt.accessTokenExpiresIn,refreshToken:k.refreshToken.token};return t.status(200).json(y)})))),f.post(`${t}/refresh-token`,s.default((t,o)=>i(void 0,void 0,void 0,(function*(){const{headers:i}=t,a=c.Authentificator.extractToken(c.TokenType.refresh,t);if(""===a)throw new d.BadRequestError("token must be provied");const s=c.Authentificator.verifyToken(a,n.jwt.publicKey);if(s.type!==c.TokenType.refresh)return l.auth.info("Tried to refresh token by access token. Rejected",{payload:s}),c.Authentificator.sendResponseError(c.ResponseErrorType.isNotARefreshToken,o);if(!(yield p.checkTokenExist(s.id)))return l.auth.info("Tried to refresh token by revoked refresh token. Rejected",{payload:s}),c.Authentificator.sendResponseError(c.ResponseErrorType.tokenWasRevoked,o);const f=(new r.default).parse(i["user-agent"]);yield p.revokeToken(s.associated),yield p.revokeToken(s.id);const m=yield p.registerTokens({uuid:s.uuid,deviceInfo:f});o.cookie(u.TOKEN_ACCESS_TOKEN_COOKIE_KEY,m.accessToken.token,{expires:new Date((new Date).getTime()+1e3*e.context.jwt.accessTokenExpiresIn),signed:!0,httpOnly:!0,secure:!0}),o.cookie(u.TOKEN_REFRESH_TOKEN_COOKIE_KEY,m.refreshToken.token,{expires:new Date((new Date).getTime()+1e3*e.context.jwt.refreshTokenExpiresIn),signed:!0,httpOnly:!0,secure:!0});const v={accessToken:m.accessToken.token,tokenType:u.TOKEN_BEARER,expiresIn:e.context.jwt.accessTokenExpiresIn,refreshToken:m.refreshToken.token};return o.status(200).json(v)})))),f.post(`${t}/validate-token`,s.default((e,n)=>i(void 0,void 0,void 0,(function*(){const{body:t}=e,{token:i}=t;if("string"!=typeof i)throw new d.BadRequestError("token must be provied");const r=c.Authentificator.verifyToken(String(i),o);n.json(r)})))),f};n.authentificatorMiddleware=l,n.default=l},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(t(55))},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),i(t(59)),i(t(7)),i(t(65))},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1);var o;!function(e){e.ACCOUNT_UPDATED="account-updated",e.ACCOUNT_DELETED="account-deleted"}(o=n.SubscriptioTriggers||(n.SubscriptioTriggers={}));const r={accountWasUpdated:{subscribe:i.withFilter(()=>i.pubsub.asyncIterator(o.ACCOUNT_UPDATED),(e,n)=>e.accountWasUpdated.id===n.id)},accountWasDeleted:{subscribe:()=>i.pubsub.asyncIterator(o.ACCOUNT_DELETED)}};n.default=r},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(4);n.Developer={name:i.DEV_INFO_DEVELOPER_NAME,url:i.DEV_INFO_DEVELOPER_URL}},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),i(t(34)),i(t(1)),i(t(30)),i(t(29)),i(t(0)),i(t(10))},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=t(35),a=t(36),s=(o(t(2)),o(t(8))),d=o(t(37)),u=o(t(38)),c=o(t(15)),l=o(t(39)),p=t(16),f=t(40),m=o(t(41)),v=t(42),k=t(43),y=t(44),N=t(45),g=t(9),h=t(28),T=t(29),_=t(0),E=t(30),b=t(67),A=t(1),D=t(87),O=t(24),S=(t(25),t(89));class w{constructor(e){this.props=Object.assign({port:A.DEFAULT_SERVER_PORT,endpoint:A.DEFAULT_GRAPHQL_ENDPOINT,timezone:A.DEFAULT_SERVER_TIMEZONE,subscriptionEndpoint:A.DEFAULT_GRAPHQL_SUBSCRIPTION_ENDPOINT,usePlayground:!1,useVoyager:!1,debug:!1},e),this.props.routes=Object.assign({auth:A.DEFAULT_ROUTE_AUTH,playground:A.DEFAULT_ROUTE_PLAYGROUND,voyager:A.DEFAULT_ROUTE_VOYAGER},this.props.routes)}bootstrap(e){const{port:n,usePlayground:t,useVoyager:i,endpoint:o,routes:r,serverOptions:s,subscriptionEndpoint:d}=this.props,{app:u,schema:c,context:l}=this.createApp(),{logger:p}=l,f=a.createServer(s,u);f.listen(n,()=>{const a={graphql:`https://localhost:${n}${o}`,auth:`https://localhost:${n}${r.auth}`,subscriptions:`wss://localhost:${n}${d}`};t&&(a.playground=`https://localhost:${n}${r.playground}`),i&&(a.voyager=`https://localhost:${n}${r.voyager}`),p.server.debug(`App server started at «${a.graphql}»`),this.createSubscriptionServer({schema:c,server:f,context:l}),void 0!==e&&e({port:n,context:l,resolveUrl:a})})}createSubscriptionServer(e){const{subscriptionEndpoint:n}=this.props,{server:t,schema:i,context:o}=e;return new N.SubscriptionServer({execute:p.execute,schema:i,subscribe:p.subscribe,onConnect:e=>{const n=g.Authentificator.extractTokenFromSubscription(e),t=g.Authentificator.verifyToken(n,o.jwt.publicKey);if(t.type!==g.TokenType.access)throw new _.UnauthorizedError("Is not an access token");return o.token=t,o}},{server:t,path:n})}createApp(){const{typeDefs:e,resolvers:n,endpoint:t,timezone:o,port:a,jwt:p,permissions:N,middlewares:w,database:I,logger:x,routes:j,subscriptionEndpoint:M,usePlayground:P,playgroundConfig:F,useVoyager:R,serverOptions:L,debug:C}=this.props,{cookieSign:V}=L;x.server.debug("Create application proc was started");const K=c.default(),q=k.makeExecutableSchema({typeDefs:[...v.typeDefs,b.scalar.typeDefs,b.common.typeDefs,...e||[],b.info.typeDefs,b.accounts.typeDefs],resolvers:[v.resolvers,b.scalar.resolvers,...n||[],b.info.resolvers,b.accounts.resolvers],resolverValidationOptions:{requireResolversForResolveType:!1}}),U=T.knexProvider(Object.assign({localTimezone:o,logger:x},I)),B=new r.EventEmitter;O.CronJobManager.configure({logger:x});const $={endpoint:t,timezone:o,jwt:p,logger:x,knex:U,emitter:B,token:{type:g.TokenType.access,id:"",uuid:"",roles:[],exp:0,iss:""}};if(K.use(u.default({credentials:!0,origin:(e,n)=>n(null,!0)})),K.use(c.default.json({limit:A.MAXIMUM_REQUEST_BODY_SIZE})),K.use(c.default.urlencoded({extended:!0,limit:A.MAXIMUM_REQUEST_BODY_SIZE})),K.use(d.default(V)),K.use(S.headersMiddleware()),K.use(E.requestHandlerMiddleware({context:$})),K.use(h.authentificatorMiddleware({context:$,authUrl:j.auth,allowedUrl:[j.playground]})),P&&K.get(j.playground,m.default({endpoint:t,subscriptionEndpoint:M,config:F})),R){const{accessToken:e}=D.configureTokens([""],$);x.server.debug("New AccessToken was created special for GraphQL voyager",{accessToken:e}),console.log(""),console.log(`${s.default.yellow.bold("Note: ")}${s.default.yellow("An access token was created specifically for GraphQL voyager")}`),console.log(`${s.default.yellow("This token was expire at")} ${s.default.yellowBright.bold(new Date(Date.now()+18e5))}`),console.log(s.default.yellow("After the token expires, you must restart the application")),K.use(j.voyager,y.express({endpointUrl:t,headersJS:JSON.stringify({Authorization:`Bearer ${e.token}`})}))}return K.use(t,l.default(e=>i(this,void 0,void 0,(function*(){const n=g.Authentificator.extractToken(g.TokenType.access,e),t=g.Authentificator.verifyToken(n,$.jwt.publicKey);if(t.type!==g.TokenType.access)throw new _.UnauthorizedError("Is not an access token");$.token=t;const i=[...N||[],b.accounts.permissions,...w||[]];return{context:$,graphiql:!1,schema:f.applyMiddleware(q,...i),subscriptionEndpoint:`wss://localhost:${a}${M}`,customFormatErrorFn:e=>_.customFormatErrorFn({error:e,context:$,debug:C})}})))),x.server.debug("Application was created"),{app:K,context:$,schema:q,routes:j}}}n.App=w,n.default=w},function(e,n){e.exports=require("events")},function(e,n){e.exports=require("https")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("express-graphql")},function(e,n){e.exports=require("graphql-middleware")},function(e,n){e.exports=require("graphql-playground-middleware-express")},function(e,n){e.exports=require("graphql-scalars")},function(e,n){e.exports=require("graphql-tools")},function(e,n){e.exports=require("graphql-voyager/middleware")},function(e,n){e.exports=require("subscriptions-transport-ws")},function(e,n){e.exports=require("bcryptjs")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n){e.exports=require("uuid")},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(8)),r=i(t(18)),a=i(t(19)),s=i(t(20)),d=i(t(21)),u=i(t(22));n.customFormatErrorFn=e=>{const{error:n,context:t,debug:i}=e,{logger:c,token:l}=t,{originalError:p}=n,f=n.stack.split("\n")||[];switch(!0){case p instanceof u.default:c.auth.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:l,stack:f}));break;case p instanceof a.default:c.auth.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:l,stack:f})),c.server.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:l,stack:f}));break;case p instanceof r.default:case p instanceof s.default:case p instanceof d.default:c.server.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:l,stack:f}));break;default:c.server.error("Error",Object.assign(Object.assign({},n),{token:l,stack:f}))}return i?(console.log(""),console.log(o.default.red("============== Caught the Error ==============")),console.log(""),p&&(p.message&&console.log(o.default.red(p.message)),p.metaData&&console.log(o.default.yellow("Error metadata"),p.metaData)),console.log(o.default.magenta("Access token payload"),l),console.log(""),console.log(o.default.red(n.stack)),console.log(""),console.log(o.default.red("============== End of Error report ==============")),console.log(""),{message:n.message,locations:n.locations,stack:n.stack?n.stack.split("\n"):[],path:n.path}):{message:n.message,locations:n.locations,path:n.path}},n.default=n.customFormatErrorFn},function(e,n){e.exports=require("dataloader")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=new(t(23).PubSub);n.pubsub=i,function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(t(23))},function(e,n){e.exports=require("cron")},function(e,n){e.exports=require("device-detector-js")},function(e,n){e.exports=require("express-async-handler")},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=t(56),r=i(t(57)),a=i(t(17)),s=t(58),d=t(0),u=t(1);n.knexProvider=e=>{const{connection:n,logger:t,timezone:i,localTimezone:c}=e,l={};s.types.setTypeParser(s.types.builtins.TIMESTAMP,"text",e=>a.default.tz(e,c).toDate()),s.types.setTypeParser(s.types.builtins.TIMESTAMPTZ,"text",e=>a.default.tz(e,c).toDate()),s.types.setTypeParser(s.types.builtins.NUMERIC,parseFloat),t.server.debug("pg-types configured");let p=0;const f=r.default({client:u.DATABASE_CLIENT,connection:n,pool:{min:5,max:100,afterCreate:(e,n)=>{e.query(`\n            SET TIMEZONE = '${i}';\n            SET CLIENT_ENCODING = ${u.DATABASE_CHARSET};\n          `,o=>{o?t.sql.debug("Connection error",{err:o}):(t.sql.debug(`The TIMEZONE was set to "${i}"`),t.sql.debug(`The charset was set to "${u.DATABASE_CHARSET}"`)),n(o,e)})}}});return f.on("query",e=>{const n=e.__knexQueryUid;l[n]={position:p,startTime:o.performance.now(),finished:!1},p+=1}).on("query-response",(e,n)=>{const i=n.__knexQueryUid;l[i].endTime=o.performance.now(),l[i].finished=!0,t.sql.debug(n.sql,Object.assign({bindings:n.bindings},l[i]))}).on("query-error",(e,n)=>{console.log(n),t.sql.error(n.sql,{bindings:n.bindings,err:e})}),t.server.debug("Knex provider configured"),f.raw("SELECT 1+1 AS result").then(()=>(t.server.debug("Test the connection by trying to authenticate is OK"),!0)).catch(e=>{throw t.server.error(e.name,e),new d.ServerError(e)}),f},n.default=n.knexProvider},function(e,n){e.exports=require("perf_hooks")},function(e,n){e.exports=require("knex")},function(e,n){e.exports=require("pg")},function(e,n,t){"use strict";var i=this&&this.__rest||function(e,n){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)n.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(t[i[o]]=e[i[o]])}return t};Object.defineProperty(n,"__esModule",{value:!0}),t(5);const o=t(60);let r;n.logger=r;const a=e=>{const{loggers:t}=e,a=i(e,["loggers"]);return n.logger=r=Object.assign({auth:o.authLogger(a),http:o.httpLogger(a),server:o.serverLogger(a),sql:o.sqlLogger(a)},t),r};n.configureLogger=a,n.default=a},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(61));n.authLogger=o.default;const r=i(t(62));n.httpLogger=r.default;const a=i(t(63));n.serverLogger=a.default;const s=i(t(64));n.sqlLogger=s.default},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=t(6);t(5);const r=t(4),a=i(t(7));n.default=e=>{const{logDir:n}=e;return o.createLogger({level:"info",format:a.default,transports:[new o.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_AUTH}`,level:"info",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAZ_SIZE,maxFiles:r.LOG_MAZ_FILES}),new o.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_DEBUG}`,level:"debug",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAZ_SIZE,maxFiles:r.LOG_MAZ_FILES})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=t(6);t(5);const r=t(4),a=i(t(7));n.default=e=>{const{logDir:n}=e;return o.createLogger({level:"info",format:a.default,transports:[new o.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_HTTP}`,level:"info",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAZ_SIZE,maxFiles:r.LOG_MAZ_FILES})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=t(6);t(5);const r=t(4),a=i(t(7));n.default=e=>{const{logDir:n}=e;return o.createLogger({level:"debug",format:a.default,transports:[new o.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_ERRORS}`,level:"error",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAZ_SIZE,maxFiles:r.LOG_MAZ_FILES}),new o.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_DEBUG}`,level:"debug",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAZ_SIZE,maxFiles:r.LOG_MAZ_FILES})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=t(6);t(5);const r=t(4),a=i(t(7));n.default=e=>{const{logDir:n}=e;return o.createLogger({level:"debug",format:a.default,transports:[new o.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_SQL}`,level:"debug",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAZ_SIZE,maxFiles:r.LOG_MAZ_FILES}),new o.transports.Console({level:"error"})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(66));n.requestHandlerMiddleware=o.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=e=>{const{context:n}=e,{logger:t}=n;return(e,n,i)=>{const{method:o,originalUrl:r,headers:a}=e,s=String(e.headers["x-forwarded-for"]||"").replace(/:\d+$/,"")||e.connection.remoteAddress,d="127.0.0.1"===s||"::1"===s?"localhost":s;return t.http.info(`${d} ${o} "${r}"`,{headers:a}),i()}}},function(e,n,t){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=i(t(68));n.accounts=r;const a=o(t(75)),s=i(t(76));n.info=s;const d=i(t(83));n.scalar=d;const u={typeDefs:a.default};n.common=u},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const r=i(t(69));n.permissions=r.default;const a=i(t(70));n.resolvers=a.default;const s=o(t(74));n.typeDefs=s},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(27),o=t(0),r=t(26);n.permissions=i.shield({Subscription:r.isAuthenticated,Account:{login:i.or(r.isDeveloper,r.isOwner,r.isAdmin),password:i.or(r.isDeveloper,r.isOwner,r.isAdmin)},AccessTokenPayload:i.or(r.isDeveloper,r.isOwner),AccountsMutation:{deleteAccount:i.or(r.isDeveloper,r.isAdmin),createAccount:i.or(r.isDeveloper,r.isAdmin),updateAccount:i.or(r.isDeveloper,r.isAdmin)}},{fallbackRule:r.isAuthenticated,allowExternalErrors:!0,fallbackError:(e,n,t,i,r)=>new o.ForbiddenError("Permission denied. You don't have access to these field[s]",{fieldName:r.fieldName,fieldNodes:r.fieldNodes,returnType:r.returnType,parentType:r.parentType,path:r.path,fragments:r.fragments})}),n.default=n.permissions},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(71)),r=i(t(72)),a=i(t(73)),s={Query:{accounts:()=>({})},Mutation:{accounts:()=>({})},Subscription:i(t(31)).default,AccountsQuery:a.default,AccountsMutation:r.default,Account:o.default};n.default=s},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=o(t(14)),a={id:({id:e})=>i(void 0,void 0,void 0,(function*(){return e})),createdAt:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).createdAt})),updatedAt:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).updatedAt})),status:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).status})),name:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).name})),login:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).login})),password:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).password})),roles:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).roles}))};n.default=a},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))},o=this&&this.__rest||function(e,n){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)n.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(t[i[o]]=e[i[o]])}return t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(10),s=t(0),d=t(1),u=r(t(14)),c=t(31),l={updateAccount:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{id:e}=n,i=o(n,["id"]),r=u.default(t),l=new a.Authentificator({context:t});try{yield l.updateAccount(e,i.data)}catch(n){throw new s.ServerError("Failed to update account",{data:i,id:e})}r.accounts.clear(e);const p=yield r.accounts.load(e);return d.pubsub.publish(c.SubscriptioTriggers.ACCOUNT_UPDATED,{accountWasUpdated:p}),{id:e}})),createAccount:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{data:e}=n,i=new a.Authentificator({context:t});if(yield i.checkAccountExists(e.login))throw new s.ServerError(`Account with login ${e.login} already exists`,{data:e});try{return{id:yield i.createAccount(e)}}catch(n){throw new s.ServerError("Failed to create account",{data:e})}})),deleteAccount:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{id:e}=n,i=new a.Authentificator({context:t}),o=u.default(t);try{const n=yield i.deleteAccount(e);return o.accounts.clear(e),d.pubsub.publish(c.SubscriptioTriggers.ACCOUNT_DELETED,{accountWasDeleted:[e]}),Boolean(n)}catch(n){throw new s.ServerError(`Failed to delete account with id ${e}`,{id:e})}})),revokeToken:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{id:e}=n;try{const n=new a.Authentificator({context:t}),i=yield n.revokeToken(e);return Boolean(i)}catch(n){throw new s.ServerError(`Failed to revoke token ${e}`,{id:e})}})),revokeAllAccountTokens:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{id:e}=n;try{const n=new a.Authentificator({context:t}),i=yield n.revokeAccountTokens(e);return Boolean(i)}catch(n){throw new s.ServerError("Failed to revoke account tokens",{id:e})}}))};n.default=l},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=t(10),a=t(0),s=t(13),d=o(t(14));n.accountsQueryResolver={list:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const e=d.default(t),i=s.buildQueryFilter(n),o=new r.Authentificator({context:t});try{const n=yield o.getAccounts(i),t=s.buildCursorConnection(n);return n.nodes.forEach(n=>{e.accounts.clear(n.id).prime(n.id,n)}),t}catch(e){throw new a.ServerError("Failed to get Accounts list",{err:e})}})),statusesList:()=>Object.values(r.AccountStatus),me:(e,n,t)=>({id:t.token.uuid}),token:(e,n,t)=>{const{token:i}=t;return i},account:(e,n)=>({id:n.id})},n.default=n.accountsQueryResolver},function(e,n){var t={kind:"Document",definitions:[{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"accounts"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountsQuery"}}},directives:[]}]},{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"accounts"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountsMutation"}}},directives:[]}]},{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Subscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"accountWasUpdated"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"accountWasDeleted"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}},directives:[]}]},{kind:"EnumTypeDefinition",description:{kind:"StringValue",value:"Account status",block:!0},name:{kind:"Name",value:"AccountStatus"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"allowed"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"forbidden"},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"AccountOrderField"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"name"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"login"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"createdAt"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"updatedAt"},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"TokenType"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"access"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"refresh"},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Account edge bundle",block:!0},name:{kind:"Name",value:"AccountsEdge"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Edge"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"node"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"cursor"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Accounts module queries",block:!0},name:{kind:"Name",value:"AccountsQuery"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Accounts list bundle",block:!0},name:{kind:"Name",value:"list"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"first"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"last"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"after"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"before"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"status"},type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"orderBy"},type:{kind:"NamedType",name:{kind:"Name",value:"AccountOrderBy"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountListConnection"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Account statuses list",block:!0},name:{kind:"Name",value:"statusesList"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}}}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Your account data",block:!0},name:{kind:"Name",value:"me"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Your Access Token payload",block:!0},name:{kind:"Name",value:"token"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccessTokenPayload"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns account by ID",block:!0},name:{kind:"Name",value:"account"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AccountsMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Update existings account",block:!0},name:{kind:"Name",value:"updateAccount"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"data"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InputAccountUpdateData"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Create new Account",block:!0},name:{kind:"Name",value:"createAccount"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"data"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InputAccountCreateData"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Delete account",block:!0},name:{kind:"Name",value:"deleteAccount"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Revoke some token",block:!0},name:{kind:"Name",value:"revokeToken"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Revoke All account tokens",block:!0},name:{kind:"Name",value:"revokeAllAccountTokens"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AccessTokenPayload"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"type"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokenType"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"uuid"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"roles"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"exp"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"iss"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Ordering options for accounts returned from the connection",block:!0},name:{kind:"Name",value:"AccountOrderBy"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"field"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountOrderField"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"direction"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"OrderDirection"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Account data",block:!0},name:{kind:"Name",value:"Account"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Node"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"login"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"password"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"status"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"roles"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Possible data to driver update",block:!0},name:{kind:"Name",value:"InputAccountUpdateData"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"login"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"password"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"status"},type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"roles"},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Possible data to create new account",block:!0},name:{kind:"Name",value:"InputAccountCreateData"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"login"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"password"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"status"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"roles"},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Accounts list bundle",block:!0},name:{kind:"Name",value:"AccountListConnection"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Connection"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"totalCount"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"pageInfo"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"edges"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountsEdge"}}}},directives:[]}]}],loc:{start:0,end:2508}};t.loc.source={body:'extend type Query {\n  accounts: AccountsQuery!\n}\n\nextend type Mutation {\n  accounts: AccountsMutation!\n}\n\nextend type Subscription {\n  accountWasUpdated (id: ID!): Account!\n  accountWasDeleted: [ID!]!\n}\n\n"""\nAccount status\n"""\nenum AccountStatus {\n  allowed\n  forbidden\n}\n\nenum AccountOrderField {\n  name\n  login\n  createdAt\n  updatedAt\n}\n\nenum TokenType {\n  access\n  refresh\n}\n\n\n"""\nAccount edge bundle\n"""\ntype AccountsEdge implements Edge {\n  node: Account!\n  cursor: String!\n}\n\n"""\nAccounts module queries\n"""\ntype AccountsQuery {\n\n  """\n  Returns Accounts list bundle\n  """\n  list(\n    first: Int\n    last: Int\n    after: String\n    before: String\n    status: AccountStatus\n    orderBy: AccountOrderBy\n  ): AccountListConnection!\n\n  """\n  Returns Account statuses list\n  """\n  statusesList: [AccountStatus!]!\n\n  """\n  Returns Your account data\n  """\n  me: Account!\n\n  """\n  Returns Your Access Token payload\n  """\n  token: AccessTokenPayload!\n\n  """\n  Returns account by ID\n  """\n  account(id: ID!): Account!\n}\n\n\n\ntype AccountsMutation {\n  \n  """\n  Update existings account\n  """\n  updateAccount(\n    id: ID!\n    data: InputAccountUpdateData!\n  ): Account!\n\n  """\n  Create new Account\n  """\n  createAccount(\n    data: InputAccountCreateData!\n  ): Account!\n\n  """\n  Delete account\n  """\n  deleteAccount(\n    id: ID!\n  ): Boolean!\n\n  """\n  Revoke some token\n  """\n  revokeToken(\n    id: ID!\n  ): Boolean!\n\n  """\n  Revoke All account tokens\n  """\n  revokeAllAccountTokens(\n    id: ID!\n  ): Boolean!\n}\n\n\n\n\n\ntype AccessTokenPayload {\n  type: TokenType!\n  id: ID!\n  uuid: String!\n  roles: [String!]!\n  exp: Int!\n  iss: String!\n}\n\n"""\nOrdering options for accounts returned from the connection\n"""\ninput AccountOrderBy {\n  field: AccountOrderField!\n  direction: OrderDirection!\n}\n\n\n"""\nAccount data\n"""\ntype Account implements Node {\n  id: ID!\n  name: String!\n  login: String!\n  password: String!\n  status: AccountStatus!\n  createdAt: DateTime!\n  updatedAt: DateTime!\n  roles: [String!]!\n}\n\n\n"""\nPossible data to driver update\n"""\ninput InputAccountUpdateData {\n  id: String\n  name: String\n  login: String\n  password: String\n  status: AccountStatus\n  roles: [String!]\n}\n\n"""\nPossible data to create new account\n"""\ninput InputAccountCreateData {\n  id: String\n  name: String!\n  login: String!\n  password: String!\n  status: AccountStatus!\n  roles: [String!]!\n}\n\n\n\n"""\nAccounts list bundle\n"""\ntype AccountListConnection implements Connection {\n  totalCount: Int!\n  pageInfo: PageInfo!\n  edges: [AccountsEdge]!\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n){var t={kind:"Document",definitions:[{kind:"EnumTypeDefinition",description:{kind:"StringValue",value:"Standart ordering options",block:!0},name:{kind:"Name",value:"OrderDirection"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"ASC"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"DESC"},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"Error handle interface",block:!0},name:{kind:"Name",value:"Error"},directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Error name. Can be short error message",block:!0},name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Error detail message string",block:!0},name:{kind:"Name",value:"msg"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Information about pagination in a connection.",block:!0},name:{kind:"Name",value:"PageInfo"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"hasPreviousPage"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"hasNextPage"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"startCursor"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"endCursor"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Node spec. interface",block:!0},name:{kind:"Name",value:"Node"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Edge spec. interface",block:!0},name:{kind:"Name",value:"Edge"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"node"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Node"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"cursor"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Connection spec. interface",block:!0},name:{kind:"Name",value:"Connection"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"totalCount"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"pageInfo"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"edges"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Edge"}}}},directives:[]}]}],loc:{start:0,end:746}};t.loc.source={body:'"""\nStandart ordering options\n"""\nenum OrderDirection {\n  ASC\n  DESC\n}\n\n"""\nError handle interface\n"""\ninterface Error {\n  """\n  Error name. Can be short error message\n  """\n  name: String!\n\n  """\n  Error detail message string\n  """\n  msg: String\n}\n\n\n"""\nInformation about pagination in a connection.\n"""\ntype PageInfo {\n  hasPreviousPage: Boolean!\n  hasNextPage: Boolean!\n  startCursor: String\n  endCursor: String\n}\n\n"""\nGraphQL Node spec. interface\n"""\ninterface Node {\n  id: ID!\n  createdAt: DateTime!\n  updatedAt: DateTime!\n}\n\n"""\nGraphQL Edge spec. interface\n"""\ninterface Edge {\n  node: Node!\n  cursor: String!\n}\n\n"""\nGraphQL Connection spec. interface\n"""\ninterface Connection {\n  totalCount: Int!\n  pageInfo: PageInfo!\n  edges: [Edge]!\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const r=i(t(77));n.resolvers=r.default;const a=o(t(82));n.typeDefs=a},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(78)),r=i(t(79)),a=i(t(80)),s={Query:{info:()=>({})},Mutation:{info:()=>({})},Subscription:i(t(81)).default,InfoQuery:a.default,InfoMutation:r.default,Developer:o.default};n.default=s},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(32),o={name:e=>Object.assign(Object.assign({},i.Developer),e).name,url:e=>Object.assign(Object.assign({},i.Developer),e).url};n.default=o},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1),o=t(32),r={echo:(e,{str:n})=>n,updateDeveloper:(e,n)=>{const t=Object.assign(Object.assign({},o.Developer),n);return i.pubsub.publish("developerWasChanged",{developerWasChanged:t}),t}};n.default=r},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default={developer:()=>({})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1),o={developerWasChanged:{subscribe:()=>i.pubsub.asyncIterator("developerWasChanged")}};n.default=o},function(e,n){var t={kind:"Document",definitions:[{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InfoQuery"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InfoMutation"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Subscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"developerWasChanged"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Developer"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Info module queries",block:!0},name:{kind:"Name",value:"InfoQuery"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer info",block:!0},name:{kind:"Name",value:"developer"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Developer"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"InfoMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"echo"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"str"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updateDeveloper"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"url"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Developer"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"InfoSubscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"developerWasChanged"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Developer"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Developer info",block:!0},name:{kind:"Name",value:"Developer"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer company name",block:!0},name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer url",block:!0},name:{kind:"Name",value:"url"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]}],loc:{start:0,end:574}};t.loc.source={body:'type Query {\n  info: InfoQuery!\n}\n\ntype Mutation {\n  info: InfoMutation!\n}\n\ntype Subscription {\n  developerWasChanged: Developer!\n}\n\n\n"""\nInfo module queries\n"""\ntype InfoQuery {\n\n  """\n  Returns developer info\n  """\n  developer: Developer!\n \n}\n\ntype InfoMutation {\n  echo(str: String!): String!\n  updateDeveloper(name: String url: String): Developer!\n}\n\ntype InfoSubscription {\n  developerWasChanged: Developer!\n}\n\n"""\nDeveloper info\n"""\ntype Developer {\n\n  """\n  Returns developer company name\n  """\n  name: String!\n\n  """\n  Returns developer url\n  """\n  url: String!\n}\n\n\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n,t){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(84));n.resolvers=o;const r=i(t(86));n.typeDefs=r},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(85));n.Money=o.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(16);n.default=new i.GraphQLScalarType({name:"Money",description:"The value is stored in the smallest monetary unit.",serialize(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError(`Value is not an instance of string or number: ${JSON.stringify(e)}`);return Number(e)},parseValue(e){if("string"==typeof e)throw new TypeError(`Value is not a valid Integer: ${e}`);return BigInt(e)},parseLiteral(e){if(e.kind!==i.Kind.STRING&&e.kind!==i.Kind.INT)throw new i.GraphQLError(`Can only parse strings & integers to money but got a: ${e.kind}`);try{return BigInt(e.value)}catch(n){throw new i.GraphQLError(`Value is not a valid Money: ${e.value}`)}}})},function(e,n){var t={kind:"Document",definitions:[{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"Money type.\nThe value is stored in the smallest monetary unit (kopecks, cents, etc.)\nReal type - Int\ne.g. For 250 USD this record returns value as 250000 (250$ * 100¢) ",block:!0},name:{kind:"Name",value:"Money"},directives:[]}],loc:{start:0,end:189}};t.loc.source={body:'"""\nMoney type.\nThe value is stored in the smallest monetary unit (kopecks, cents, etc.)\nReal type - Int\ne.g. For 250 USD this record returns value as 250000 (250$ * 100¢) \n"""\nscalar Money',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=i(t(88)),r=t(9),a=(e,n)=>new r.Authentificator({context:n}).generateTokens({uuid:o.default(),roles:e},{access:86400,refresh:86400});n.configureTokens=a,n.default=a},function(e,n){e.exports=require("uuid/v4")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.headersMiddleware=()=>(e,n,t)=>{n.removeHeader("X-Powered-By"),n.setHeader("X-Developer","Via Profit"),t()},n.default=n.headersMiddleware}]);