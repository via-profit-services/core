module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=59)}([function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t){e.exports=require("winston")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);t.default=r.format.combine(r.format.metadata(),r.format.json(),r.format.timestamp({format:"YYYY-MM-DDTHH:mm:ssZZ"}),r.format.splat(),r.format.printf(e=>{const{timestamp:t,level:n,message:r,metadata:i}=e,o="{}"!==JSON.stringify(i)?i:null;return`${t} ${n}: ${r} ${o?JSON.stringify(o):""}`}))},function(e,t){e.exports=require("graphql")},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(38)),r(n(44)),r(n(11))},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("graphql-tools")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(9)),a=i(n(27)),s=i(n(28)),u=i(n(10)),d=n(11);var c;!function(e){e.access="access",e.refresh="refresh"}(c=t.TokenType||(t.TokenType={}));t.Authentificator=class{constructor(e){this.props=e}static extractToken(e){const{headers:t}=e,{authorization:n}=t,r=String(n).split(" ")[0],i=String(n).split(" ")[1];return"bearer"===r.toLocaleLowerCase()?i:""}static verifyToken(e,t){if(null===e||""===e)throw new d.UnauthorizedError("The token must be provided");try{const n=o.default.readFileSync(t);return a.default.verify(String(e),n)}catch(e){throw new d.UnauthorizedError("Token verification failed",e)}}registerTokens(e){return r(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:n,logger:r}=t,i=yield n.select(["id","roles"]).from("accounts").where({id:e.uuid}).first(),o=this.generateTokens({uuid:i.id,roles:i.roles});try{yield n("tokens").insert({id:o.accessToken.payload.id,account:o.accessToken.payload.uuid,type:c.access,deviceInfo:e.deviceInfo,expiredAt:s.default(o.accessToken.payload.exp).format()})}catch(e){throw new d.ServerError("Failed to register access token",e)}try{yield n("tokens").insert({id:o.refreshToken.payload.id,account:o.refreshToken.payload.uuid,type:c.refresh,associated:o.accessToken.payload.id,deviceInfo:e.deviceInfo,expiredAt:s.default(o.refreshToken.payload.exp).format()})}catch(e){throw new d.ServerError("Failed to register refresh token",e)}return r.auth.info("New Access token was registered",o.accessToken.payload),o}))}generateTokens(e){const{context:t}=this.props;try{o.default.accessSync(t.jwt.privateKey)}catch(e){throw new d.ServerError("Failed to open JWT privateKey file",{err:e})}const n=o.default.readFileSync(t.jwt.privateKey),r=Object.assign(Object.assign({},e),{type:c.access,id:u.default(),exp:Math.floor(Date.now()/1e3)+Number(t.jwt.accessTokenExpiresIn),iss:t.jwt.issuer}),i=Object.assign(Object.assign({},e),{type:c.refresh,id:u.default(),associated:r.id,exp:Math.floor(Date.now()/1e3)+Number(t.jwt.refreshTokenExpiresIn),iss:t.jwt.issuer}),s=a.default.sign(r,n,{algorithm:t.jwt.algorithm}),l=a.default.sign(i,n,{algorithm:t.jwt.algorithm});return{accessToken:{token:s,payload:Object.assign(Object.assign({},r),{type:c.access})},refreshToken:{token:l,payload:Object.assign(Object.assign({},i),{type:c.refresh})}}}revokeToken(e){return r(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:n}=t;yield n.del("tokens").where({id:e})}))}checkTokenExist(e){return r(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:n}=t;return null!==(yield n.select(["id"]).from("tokens").where({id:e}).first())}))}getAccountByLogin(e){return r(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:n}=t,r=yield n.select(["id","password","status"]).from("accounts").where({login:e}).first();return{id:r.id,password:r.password,status:r.status}}))}static sendResponseError(e,t){const n=[];switch(e){case"accountForbidden":n.push({message:"Account locked",name:"Authorization error"});break;case"authentificationRequired":n.push({message:"Authentication Required",name:"Authorization error"});break;case"isNotARefreshToken":n.push({message:"Token error",name:"Is not a refresh token"});break;case"isNotAnAccessToken":n.push({message:"Token error",name:"Is not a access token"});break;case"tokenExpired":n.push({message:"Token error",name:"This token expired"});break;case"tokenWasRevoked":n.push({message:"Token error",name:"Token was revoked"});break;case"accountNotFound":case"invalidLoginOrPassword":default:n.push({message:"Invalid login or password",name:"Authorization error"})}return t.status(401).json({errors:n})}},function(e){e.authentificationRequired="authentificationRequired",e.accountNotFound="accountNotFound",e.accountForbidden="accountForbidden",e.invalidLoginOrPassword="invalidLoginOrPassword",e.tokenExpired="tokenExpired",e.isNotAnAccessToken="isNotAnAccessToken",e.isNotARefreshToken="isNotARefreshToken",e.tokenWasRevoked="tokenWasRevoked"}(t.ResponseErrorType||(t.ResponseErrorType={})),function(e){e.allowed="allowed",e.forbidden="forbidden"}(t.AccountStatus||(t.AccountStatus={}))},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("uuid/v4")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(29));t.BadRequestError=i.default;const o=r(n(30));t.ForbiddenError=o.default;const a=r(n(31));t.NotFoundError=a.default;const s=r(n(32));t.ServerError=s.default;const u=r(n(33));t.UnauthorizedError=u.default},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(10)),o=n(8),a=(e,t)=>new o.Authentificator({context:t}).generateTokens({uuid:i.default(),roles:e});t.configureTokens=a,t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.categories=[{id:"100",name:"Category 1"},{id:"200",name:"Category 2"},{id:"300",name:"Category 3"},{id:"400",name:"Category 4"}],this.items=[{id:"178900",name:"Item 1",category:"100",price:1600},{id:"278900",name:"Item 2",category:"100",price:7600},{id:"378900",name:"Item 3",category:"100",price:5250},{id:"478900",name:"Item 4",category:"200",price:300},{id:"578900",name:"Item 5",category:"200",price:652},{id:"678900",name:"Item 6",category:"200",price:730}]}getItemsList(){return this.items}getCategoriesList(){return this.categories}getItem(e){return this.getItemsList().find(t=>t.id===e)}getCategory(e){return this.getCategoriesList().find(t=>t.id===e)}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(16),a=n(17),s=i(n(5)),u=i(n(18)),d=i(n(6)),c=i(n(19)),l=n(3),p=i(n(20)),f=n(7),m=n(21),y=n(22),g=n(23),h=n(34),v=n(4),k=n(48),N=n(13);class _{constructor(e){this.props=Object.assign({port:4e3,endpoint:"/graphql",subscriptionsEndpoint:"/subscriptions",usePlayground:!1,useVoyager:!1},e),this.props.routes=Object.assign({auth:"/auth",playground:"/playground",voyager:"/voyager"},this.props.routes)}bootstrap(){const{port:e,usePlayground:t,useVoyager:n,endpoint:r,routes:i}=this.props,{app:o,schema:s,context:u}=this.createApp(),{emitter:d}=u,c=a.createServer(o);c.listen(e,()=>{this.createSubscriptionServer({schema:s,server:c}),d.emit("VIAPROFIT_SERVER_STARTED",{port:e})})}createSubscriptionServer(e){const{subscriptionsEndpoint:t}=this.props,{server:n,schema:r}=e;return new y.SubscriptionServer({execute:l.execute,schema:r,subscribe:l.subscribe},{server:n,path:t})}createApp(){const e=d.default(),{schemas:t,endpoint:n,port:i,jwt:a,database:l,logger:y,routes:_,subscriptionsEndpoint:T,usePlayground:b,useVoyager:w}=this.props,D=f.mergeSchemas({schemas:[...t,k.infoSchema]}),x={endpoint:n,jwt:a,logger:y,knex:h.knexProvider({logger:y,database:l}),emitter:new o.EventEmitter};if(e.use(u.default()),e.use(d.default.json({limit:"50mb"})),e.use(d.default.urlencoded({extended:!0,limit:"50mb"})),e.use(v.requestHandlerMiddleware({context:x})),e.use(g.authentificatorMiddleware({context:x,authUrl:_.auth,allowedUrl:[_.playground]})),b&&e.get(_.playground,p.default({endpoint:n})),w){const{accessToken:t}=N.configureTokens([""],x);console.log(""),console.log(`${s.default.yellow.bold("Note: ")}${s.default.yellow("An access token was created specifically for GraphQL voyager")}`),console.log(`${s.default.yellow("This token was expire at")} ${s.default.yellowBright.bold(new Date(Date.now()+18e5))}`),console.log(s.default.yellow("After the token expires, you must restart the application")),e.use(_.voyager,m.express({endpointUrl:n,headersJS:JSON.stringify({Authorization:`Bearer ${t.token}`})}))}return e.use(n,c.default(()=>r(this,void 0,void 0,(function*(){return{context:x,graphiql:!1,schema:D,subscriptionsEndpoint:`ws://localhost:${i}${T}`}})))),e.use(v.errorHandlerMiddleware({context:x})),{app:e,context:x,schema:D,routes:_}}}t.App=_,t.default=_},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express-graphql")},function(e,t){e.exports=require("graphql-playground-middleware-express")},function(e,t){e.exports=require("graphql-voyager/middleware")},function(e,t){e.exports=require("subscriptions-transport-ws")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(24)),a=i(n(25)),s=n(6),u=i(n(26)),d=n(8),c=e=>{const{context:t,authUrl:n,allowedUrl:i}=e,{endpoint:c}=e.context,{publicKey:l}=e.context.jwt,{logger:p}=t,f=new d.Authentificator({context:t}),m=s.Router();return m.post(`${n}/access-token`,u.default((t,n)=>r(void 0,void 0,void 0,(function*(){const{body:r,headers:i}=t,{login:s,password:u}=r,c=(new a.default).parse(i["user-agent"]);p.auth.info("Access token request",{login:s});const l=yield f.getAccountByLogin(s);if(!l||!o.default.compareSync(u,l.password))return p.auth.error("Account not found",{login:s}),d.Authentificator.sendResponseError(d.ResponseErrorType.accountNotFound,n);if(l.status===d.AccountStatus.forbidden&&o.default.compareSync(u,l.password))return p.auth.info("Authentification forbidden",{login:s}),d.Authentificator.sendResponseError(d.ResponseErrorType.accountForbidden,n);if(l.status===d.AccountStatus.allowed&&o.default.compareSync(u,l.password)){const t=yield f.registerTokens({uuid:l.id,deviceInfo:c});return n.status(200).json({accessToken:t.accessToken.token,tokenType:"bearer",expiresIn:e.context.jwt.accessTokenExpiresIn,refreshToken:t.refreshToken.token})}return d.Authentificator.sendResponseError(d.ResponseErrorType.accountNotFound,n)})))),m.post(`${n}/refresh-token`,u.default((n,i)=>r(void 0,void 0,void 0,(function*(){const{body:r,headers:o}=n,{token:s}=r,u=d.Authentificator.verifyToken(s,t.jwt.publicKey);if(u.type!==d.TokenType.refresh)return p.auth.info("Tried to refresh token by access token. Rejected",{payload:u}),d.Authentificator.sendResponseError(d.ResponseErrorType.isNotARefreshToken,i);if(!(yield f.checkTokenExist(u.id)))return p.auth.info("Tried to refresh token by revoked refresh token. Rejected",{payload:u}),d.Authentificator.sendResponseError(d.ResponseErrorType.tokenWasRevoked,i);const c=(new a.default).parse(o["user-agent"]);yield f.revokeToken(u.associated),yield f.revokeToken(u.id);const l=yield f.registerTokens({uuid:u.uuid,deviceInfo:c});return i.status(200).json({accessToken:l.accessToken.token,tokenType:"bearer",expiresIn:e.context.jwt.accessTokenExpiresIn,refreshToken:l.refreshToken.token})})))),m.post(`${n}/validate-token`,u.default((e,t)=>r(void 0,void 0,void 0,(function*(){const{body:n}=e,{token:r}=n,i=d.Authentificator.verifyToken(r,l);t.json(i)})))),m.use(c,u.default((e,t,n)=>r(void 0,void 0,void 0,(function*(){if(i.includes(e.originalUrl))return n();const r=d.Authentificator.extractToken(e);return d.Authentificator.verifyToken(r,l).type!==d.TokenType.access?d.Authentificator.sendResponseError(d.ResponseErrorType.isNotAnAccessToken,t):n()})))),m};t.authentificatorMiddleware=c,t.default=c},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("device-detector-js")},function(e,t){e.exports=require("express-async-handler")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("moment-timezone")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t){super(e),this.name="BadRequestError",this.message=e,this.metaData=t,this.status=400,Object.setPrototypeOf(this,r.prototype)}}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t){super(e),this.name="ForbiddenError",this.message=e,this.metaData=t,this.status=503,Object.setPrototypeOf(this,r.prototype)}}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t){super(e),this.name="NotFoundError",this.message=e,this.metaData=t,this.status=404,Object.setPrototypeOf(this,r.prototype)}}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t){super(e),this.name="ServerError",this.message=e,this.metaData=t,this.status=500,Object.setPrototypeOf(this,r.prototype)}}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t){super(e),this.name="UnauthorizedError",this.message=e,this.metaData=t,this.status=401,Object.setPrototypeOf(this,r.prototype)}}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(35))},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(36),o=r(n(37)),a=n(4),s=e=>{const{database:t,logger:n}=e,r={};let s=0;const u=o.default(t);return u.on("query",e=>{const t=e.__knexQueryUid;r[t]={position:s,query:e,startTime:i.performance.now(),finished:!1},s+=1}).on("query-response",(e,t)=>{const o=t.__knexQueryUid;r[o].endTime=i.performance.now(),r[o].finished=!0,n.sql.debug(t.sql,r[o])}).on("query-error",(e,t)=>{n.sql.error(t.sql,{err:e})}),u.raw("SELECT 1+1 AS result").then(()=>(n.server.debug("Test the connection by trying to authenticate is OK"),!0)).catch(e=>{throw n.server.error(e.name,e),new a.ServerError(e)}),u};t.knexProvider=s,t.default=s},function(e,t){e.exports=require("perf_hooks")},function(e,t){e.exports=require("knex")},function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),n(0);const i=n(39);let o;t.logger=o;const a=e=>{const{loggers:n}=e,a=r(e,["loggers"]);return t.logger=o=Object.assign({auth:i.authLogger(a),http:i.httpLogger(a),server:i.serverLogger(a),sql:i.sqlLogger(a)},n),o};t.configureLogger=a,t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(40));t.authLogger=i.default;const o=r(n(41));t.httpLogger=o.default;const a=r(n(42));t.serverLogger=a.default;const s=r(n(43));t.sqlLogger=s.default},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1);n(0);const o=r(n(2));t.default=e=>{const{logDir:t}=e;return i.createLogger({level:"info",format:o.default,transports:[new i.transports.DailyRotateFile({filename:`${t}/%DATE%-auth.log`,level:"info",datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"}),new i.transports.DailyRotateFile({filename:`${t}/%DATE%-debug.log`,level:"debug",datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"})]})}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1);n(0);const o=r(n(2));t.default=e=>{const{logDir:t}=e;return i.createLogger({level:"info",format:o.default,transports:[new i.transports.DailyRotateFile({filename:`${t}/%DATE%-http.log`,level:"info",datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"})]})}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1);n(0);const o=r(n(2));t.default=e=>{const{logDir:t}=e;return i.createLogger({level:"debug",format:o.default,transports:[new i.transports.DailyRotateFile({filename:`${t}/%DATE%-errors.log`,level:"error",datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"}),new i.transports.DailyRotateFile({filename:`${t}/%DATE%-debug.log`,level:"debug",datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"})]})}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1);n(0);const o=r(n(2));t.default=e=>{const{logDir:t}=e;return i.createLogger({level:"debug",format:o.default,transports:[new i.transports.DailyRotateFile({filename:`${t}/%DATE%-sql.log`,level:"debug",datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"}),new i.transports.Console({level:"error"})]})}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(45));t.errorHandlerMiddleware=i.default;const o=r(n(47));t.requestHandlerMiddleware=o.default},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});r(n(5));const i=r(n(46));t.default=e=>{const{context:t}=e,{logger:n}=t;return[(e,t,r,o)=>{const{status:a,stack:s,name:u,message:d,metaData:c}=e,{originalUrl:l}=t,p=d?`${a||""} ${d}`:"Unknown error";switch(a){case 401:n.auth.error(p,{originalUrl:l,stack:s,metaData:c});break;case 500:default:n.server.error(p,{originalUrl:l,stack:s,metaData:c})}r.status(a||500).json(i.default({message:d||"Please contact system administrator",name:u||"Internal server error"}))},(e,t)=>{t.status(404).end()},(e,t)=>{t.status(503).end()},(e,t)=>{t.status(400).end()}]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const{name:t,message:n}=e;return{errors:[{name:t||"Unknown Error",message:n||t||"Unknown Error"}]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const{context:t}=e,{logger:n}=t;return(e,t,r)=>{const{method:i,originalUrl:o,headers:a}=e,s=String(e.headers["x-forwarded-for"]||"").replace(/:\d+$/,"")||e.connection.remoteAddress,u="127.0.0.1"===s||"::1"===s?"localhost":s;return n.http.info(`${u} ${i} "${o}"`,{headers:a}),r()}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(49));t.infoSchema=i.default,t.default=i.default},function(e,t,n){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(9)),o=r(n(12)),a=n(3),s=i.default.readFileSync(o.default.resolve(e,"..","..","..","package.json"),"utf8"),u=JSON.parse(s),d=new a.GraphQLObjectType({name:"DevInfo",fields:()=>({name:{description:"Application name",resolve:()=>u.name,type:new a.GraphQLNonNull(a.GraphQLString)},description:{description:"Application description",resolve:()=>u.description,type:new a.GraphQLNonNull(a.GraphQLString)},version:{description:"Application version number",resolve:()=>u.version,type:new a.GraphQLNonNull(a.GraphQLString)},author:{description:"Application author",resolve:()=>u.author,type:new a.GraphQLNonNull(a.GraphQLString)},support:{description:"Application support",resolve:()=>u.support,type:new a.GraphQLNonNull(a.GraphQLString)},license:{description:"Application license",resolve:()=>u.license,type:new a.GraphQLNonNull(a.GraphQLString)},repository:{resolve:()=>u.repository,type:new a.GraphQLNonNull(new a.GraphQLObjectType({name:"Repository",description:"Application repository",fields:()=>({type:{description:"Repository type",type:new a.GraphQLNonNull(a.GraphQLString),resolve:()=>u.repository.type},url:{description:"Repository URL addess",type:new a.GraphQLNonNull(a.GraphQLString),resolve:()=>u.repository.url}})}))}})}),c=new a.GraphQLSchema({query:new a.GraphQLObjectType({name:"Query",fields:()=>({devInfo:{description:"Application development info",resolve:()=>({}),type:new a.GraphQLNonNull(d)}})})});t.default=c}).call(this,"src/schemas/info")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(7),a=r(n(51));t.configureCatalogLogger=a.default;const s=r(n(52)),u=i(n(55)),d=o.makeExecutableSchema({typeDefs:u,resolvers:s.default});t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);n(0),t.default=e=>{const{logDir:t}=e;return r.createLogger({level:"debug",format:r.format.combine(r.format.metadata(),r.format.json(),r.format.timestamp({format:"YYYY-MM-DDTHH:mm:ssZZ"}),r.format.splat(),r.format.printf(e=>{const{timestamp:t,level:n,message:r,metadata:i}=e,o="{}"!==JSON.stringify(i)?i:null;return`${t} ${n}: ${r} ${o?JSON.stringify(o):""}`})),transports:[new r.transports.DailyRotateFile({filename:`${t}/%DATE%-catalog.log`,level:"debug",datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d"})]})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(53),i={Query:{news:()=>({})},Mutation:{news:()=>({})},CatalogQueries:n(54).CatalogQueries,CatalogMutations:{category:()=>({}),item:()=>({})},CategoryMutations:r.CategoryMutations,ItemMutations:r.ItemMutations};t.default=i},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(14));t.CategoryMutations={create:()=>(new i.default).getCategory(String(100)),update:(e,t)=>{const{id:n}=t;return(new i.default).getCategory(n)},delete:()=>!0},t.ItemMutations={create:()=>(new i.default).getItem(String(1)),update:(e,t)=>{const{id:n}=t;return(new i.default).getItem(n)},delete:()=>!0}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(14));t.CatalogQueries={categories:(e,t,n)=>{const{logger:r}=n;return r.catalog.debug("Returns categories list"),(new i.default).getCategoriesList()},item:(e,t,n)=>{const{id:r}=t,{logger:o}=n;return o.catalog.debug("Returns Item"),(new i.default).getItemsList().find(e=>e.id===String(r))},items:(e,t,n)=>{const{logger:r}=n,o=new i.default;return r.catalog.debug("Returns Items list"),o.getItemsList()}},t.default=t.CatalogQueries},function(e,t){var n={kind:"Document",definitions:[{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"news"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CatalogQueries"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"news"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CatalogMutations"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"CatalogQueries"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"categories"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Category"}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"items"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Item"}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"item"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"Item"}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"CatalogMutations"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"category"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CategoryMutations"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"item"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ItemMutations"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"ItemMutations"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"create"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Item"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"update"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Item"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"delete"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"CategoryMutations"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"create"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Category"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"update"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Category"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"delete"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Category"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Item"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]}],loc:{start:0,end:599}};n.loc.source={body:"type Query {\n  news: CatalogQueries!\n}\n\ntype Mutation {\n  news: CatalogMutations!\n}\n\ntype CatalogQueries {\n  categories: [Category]!\n  items: [Item]!\n  item(id: ID!): Item\n}\n\ntype CatalogMutations {\n  category: CategoryMutations!\n  item: ItemMutations!\n}\n\ntype ItemMutations {\n  create(name: String!): Item!\n  update(id: ID!, name: String!): Item!\n  delete(id: ID!): Boolean!\n}\n\ntype CategoryMutations {\n  create(name: String!): Category!\n  update(id: ID!, name: String!): Category!\n  delete(id: ID!): Boolean!\n}\n\ntype Category {\n  id: ID!\n  name: String!\n}\n\ntype Item {\n  id: ID!\n  name: String!\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=new r.GraphQLObjectType({name:"Post",description:"Current Post data",fields:()=>({title:{type:new r.GraphQLNonNull(r.GraphQLString),description:"Post Title"},url:{type:new r.GraphQLNonNull(r.GraphQLString),description:"URL address"}})}),o=new r.GraphQLSchema({query:new r.GraphQLObjectType({name:"Query",fields:()=>({post:{type:new r.GraphQLNonNull(i),resolve:()=>({title:"Lorem ipsum",url:"hppts://google.com"})}})}),mutation:new r.GraphQLObjectType({name:"Mutation",fields:()=>({setAny:{description:"Set any value for test mutation",args:{name:{type:new r.GraphQLNonNull(r.GraphQLString),description:"Any value string"}},resolve:()=>!0,type:new r.GraphQLNonNull(r.GraphQLBoolean)}})})});t.default=o},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(12)),o=r(n(58)),a=n(4).configureLogger({logDir:"log"});o.default.config();const s={client:process.env.DB_CLIENT,connection:{database:process.env.DB_NAME,host:process.env.DB_HOST,password:process.env.DB_PASSWORD,user:process.env.DB_USER}},u={accessTokenExpiresIn:Number(process.env.JWT_ACCESSTOKENEXPIRESIN),algorithm:process.env.JWT_ALGORITHM,issuer:process.env.JWT_ISSUER,privateKey:i.default.resolve(process.cwd(),process.env.JWT_PRIVATEKEY),publicKey:i.default.resolve(process.cwd(),process.env.JWT_PUBLICKEY),refreshTokenExpiresIn:Number(process.env.JWT_REFRESHTOKENEXPIRESIN)},d={port:Number(process.env.PORT),endpoint:process.env.GQL_ENDPOINT,subscriptionsEndpoint:process.env.GQL_SUBSCRIPTIONSENDPOINT,database:s,jwt:u,logger:a,schemas:[]},c=e=>{const{schemas:t}=e;return Object.assign(Object.assign({},d),{schemas:t})};t.configureApp=c,t.default=c},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(15)),r(n(60))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(13)),r(n(61))},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(15),o=r(n(50)),a=r(n(56)),s=n(57),u=n(13);t.default=e=>{const t=Object.assign(Object.assign({},s.configureApp({schemas:[a.default,o.default]})),e),n=new i.App(t).createApp(),r=u.configureTokens([],n.context);return Object.assign(Object.assign(Object.assign({},n),r),{config:t})}}]);