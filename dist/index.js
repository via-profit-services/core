/*! For license information please see index.js.LICENSE.txt */
module.exports=function(e){var n={};function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(i,a,function(n){return e[n]}.bind(null,a));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=35)}([function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(21));n.BadRequestError=a.default;const r=i(t(22));n.customFormatErrorFn=r.default;const o=i(t(23));n.ForbiddenError=o.default;const s=i(t(24));n.NotFoundError=s.default;const d=i(t(25));n.ServerError=d.default;const u=i(t(26));n.UnauthorizedError=u.default},function(e,n){e.exports=require("graphql")},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(t(40));n.DataLoader=r.default,i(t(15)),i(t(20)),i(t(27)),i(t(3)),i(t(28)),i(t(13))},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TOKEN_BEARER_KEY="Authorization",n.TOKEN_BEARER="Bearer",n.REDIS_TOKENS_BLACKLIST="tokensBlackList",n.REDIS_IP_BLACKLIST="ipBlackList",n.DATABASE_CHARSET="UTF8",n.DATABASE_CLIENT="pg",n.DEFAULT_SERVER_PORT=4e3,n.DEFAULT_GRAPHQL_ENDPOINT="/graphql",n.DEFAULT_GRAPHQL_SUBSCRIPTION_ENDPOINT="/subscriptions",n.DEFAULT_SERVER_TIMEZONE="UTC",n.DEFAULT_ROUTE_PLAYGROUND="/playground",n.DEFAULT_ROUTE_GRAPHIQL="/graphiql",n.DEFAULT_ROUTE_VOYAGER="/voyager",n.MAXIMUM_REQUEST_BODY_SIZE="50mb",n.DEV_INFO_DEVELOPER_NAME="Via Profit",n.DEV_INFO_DEVELOPER_URL="https://via-profit.ru/",n.DEV_INFO_DEVELOPER_EMAIL="promo@via-profit.ru",n.LOG_FILENAME_AUTH="auth-%DATE%.log",n.LOG_FILENAME_HTTP="http-%DATE%.log",n.LOG_FILENAME_DEBUG="debug-%DATE%.log",n.LOG_FILENAME_ERRORS="errors-%DATE%.log",n.LOG_FILENAME_WARNINGS="warnings-%DATE%.log",n.LOG_FILENAME_SQL="sql-%DATE%.log",n.LOG_FILENAME_ACCESS="access-%DATE%.log",n.LOG_DATE_PATTERNT="YYYY-MM-DD",n.LOG_MAX_SIZE="20m",n.LOG_MAX_FILES="14d",n.LOG_MAZ_FILES="14d",n.LOG_MAZ_SIZE="20m"},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("winston-daily-rotate-file")},function(e,n){e.exports=require("winston")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(7);n.default=i.format.combine(i.format.metadata(),i.format.json(),i.format.timestamp({format:"YYYY-MM-DDTHH:mm:ssZZ"}),i.format.splat(),i.format.printf(e=>{const{timestamp:n,level:t,message:i,metadata:a}=e,r="{}"!==JSON.stringify(a)?a:null;return`${n} ${t}: ${i} ${r?JSON.stringify(r):""}`}))},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(t(17)),o=t(29),s=t(2),d=a(t(10));var u;!function(e){e.allowed="allowed",e.forbidden="forbidden"}(u=n.AccountStatus||(n.AccountStatus={}));n.default=class{constructor(e){this.props=e}getAccounts(e){const{context:n}=this.props,{knex:t}=n,{limit:i,offset:a,orderBy:r,where:o}=e;return t.select(["accounts.*",t.raw('count(*) over() as "totalCount"')]).from("accounts").orderBy(s.convertOrderByToKnex(r)).where(e=>s.convertWhereToKnex(e,o)).limit(i).offset(a).then(e=>({totalCount:e.length?Number(e[0].totalCount):0,limit:i,offset:a,nodes:e,where:o,orderBy:r}))}getAccountsByIds(e){return i(this,void 0,void 0,(function*(){const{nodes:n}=yield this.getAccounts({where:[["id",s.TWhereAction.IN,e]],offset:0,limit:e.length});return n}))}getAccount(e){return i(this,void 0,void 0,(function*(){const n=yield this.getAccountsByIds([e]);return!!n.length&&n[0]}))}getAccountByLogin(e){return i(this,void 0,void 0,(function*(){const{nodes:n}=yield this.getAccounts({limit:1,offset:0,where:[["login",s.TWhereAction.EQ,e]]});return!!n.length&&n[0]}))}updateAccount(e,n){return i(this,void 0,void 0,(function*(){const{knex:t,timezone:i}=this.props.context;yield t("accounts").update(Object.assign(Object.assign({},n),{updatedAt:r.default.tz(i).format()})).where("id",e)}))}createAccount(e){return i(this,void 0,void 0,(function*(){const{knex:n,timezone:t}=this.props.context,i=r.default.tz(t).format();return(yield n("accounts").insert(Object.assign(Object.assign({},e),{id:e.id?e.id:o.v4(),roles:s.convertJsonToKnex(n,e.roles),password:d.default.cryptUserPassword(e.password),createdAt:i,updatedAt:i})).returning("id"))[0]}))}deleteAccount(e){return i(this,void 0,void 0,(function*(){return this.updateAccount(e,{login:o.v4(),password:o.v4(),deleted:!0,status:u.forbidden})}))}}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(t(4)),o=a(t(42)),s=a(t(43)),d=a(t(17)),u=t(29),l=t(0),c=t(2),p=t(9);var f;!function(e){e.access="access",e.refresh="refresh"}(f=n.TokenType||(n.TokenType={}));n.default=class{constructor(e){this.props=e}static cryptUserPassword(e){const n=o.default.genSaltSync(10);return o.default.hashSync(e,n)}getAccountByCredentials(e,n){return i(this,void 0,void 0,(function*(){const{context:t}=this.props,{knex:i}=t,a=yield i.select(["id","password","status","roles"]).from("accounts").where({login:e}).first();if(!a||!o.default.compareSync(n,String(a.password)))throw new l.ServerError("Invalid login or password");if(a.status===p.AccountStatus.forbidden)throw new l.ServerError("Account locked");return a}))}registerTokens(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t,logger:i}=n,a=yield t.select(["id","roles"]).from("accounts").where({id:e.uuid}).first();if("string"!=typeof a.id)throw new l.ServerError(`Account with id[${a.id}] not found`);const r=this.generateTokens({uuid:a.id,roles:a.roles});try{yield t("tokens").insert({id:r.accessToken.payload.id,account:r.accessToken.payload.uuid,type:f.access,deviceInfo:e.deviceInfo,expiredAt:d.default(1e3*r.accessToken.payload.exp).format()})}catch(e){throw new l.ServerError("Failed to register access token",e)}try{yield t("tokens").insert({id:r.refreshToken.payload.id,account:r.refreshToken.payload.uuid,type:f.refresh,associated:r.accessToken.payload.id,deviceInfo:e.deviceInfo,expiredAt:d.default(1e3*r.refreshToken.payload.exp).format()})}catch(e){throw new l.ServerError("Failed to register refresh token",e)}return i.auth.info("New Access token was registered",r.accessToken.payload),r}))}generateTokens(e,n){var t,i;const{context:a}=this.props,o=(null===(t=n)||void 0===t?void 0:t.access)?n.access:a.jwt.accessTokenExpiresIn,d=(null===(i=n)||void 0===i?void 0:i.refresh)?n.refresh:a.jwt.refreshTokenExpiresIn;try{r.default.accessSync(a.jwt.privateKey)}catch(e){throw new l.ServerError("Failed to open JWT privateKey file",{err:e})}const c=r.default.readFileSync(a.jwt.privateKey),p=Object.assign(Object.assign({},e),{type:f.access,id:u.v4(),exp:Math.floor(Date.now()/1e3)+Number(o),iss:a.jwt.issuer}),m=Object.assign(Object.assign({},e),{type:f.refresh,id:u.v4(),associated:p.id,exp:Math.floor(Date.now()/1e3)+Number(d),iss:a.jwt.issuer}),v=s.default.sign(p,c,{algorithm:a.jwt.algorithm}),y=s.default.sign(m,c,{algorithm:a.jwt.algorithm});return{accessToken:{token:v,payload:Object.assign(Object.assign({},p),{type:f.access})},refreshToken:{token:y,payload:Object.assign(Object.assign({},m),{type:f.refresh})}}}revokeToken(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{logger:t,knex:i,redis:a}=n,r=Array.isArray(e)?e:[e];a.sadd(c.REDIS_TOKENS_BLACKLIST,r),(yield i("tokens").select(["tokens.account","tokens.id as access","refreshTokens.id as refresh"]).leftJoin("accounts","accounts.id","tokens.account").leftJoin("tokens as refreshTokens","refreshTokens.associated","tokens.id").whereIn("tokens.id",r)).forEach(e=>{t.auth.info(`Revoke Access Token ${e.access} for account ${e.account}`,{data:e}),t.auth.info(`Revoke Refresh Token ${e.refresh} for account ${e.account}`,{data:e})})}))}isTokenRevoked(e){return i(this,void 0,void 0,(function*(){const{redis:n}=this.props.context,t=yield n.sismember(c.REDIS_TOKENS_BLACKLIST,e);return Boolean(t)}))}revokeAccountTokens(e){return i(this,void 0,void 0,(function*(){const{knex:n}=this.props.context,t=(yield n("tokens").select(["id"]).where({account:e})).map(e=>e.id);return yield this.revokeToken(t),t}))}getTokensByIds(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t}=n;return yield t("tokens").select("*").whereIn("id",e)}))}clearExpiredTokens(){return i(this,void 0,void 0,(function*(){const{context:e}=this.props,{knex:n,redis:t}=e,i=(yield n("tokens").select("id").where("expiredAt","<",n.raw("now()"))).map(e=>e.id);i.length&&(yield t.srem(c.REDIS_TOKENS_BLACKLIST,i)),yield n("tokens").del().where("expiredAt","<",n.raw("now()"))}))}verifyToken(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{redis:t,logger:i}=n;try{const a=r.default.readFileSync(n.jwt.publicKey),o=s.default.verify(String(e),a);if(yield t.sismember(c.REDIS_TOKENS_BLACKLIST,o.id))throw i.auth.info("Tried to get data with revoked token",{payload:o}),new l.ServerError("Token was revoked",{payload:o});return o}catch(e){throw i.server.error("Failed to validate the token",{err:e}),new l.ServerError("Invalid token",e)}}))}checkTokenExist(e){return i(this,void 0,void 0,(function*(){const{context:n}=this.props,{knex:t}=n;return null!==(yield t.select(["id"]).from("tokens").where({id:e}).first())}))}static extractTokenFromSubscription(e){if("object"==typeof e&&c.TOKEN_BEARER_KEY in e){const[n,t]=String(e[c.TOKEN_BEARER_KEY]).split(" ");if(n===c.TOKEN_BEARER&&""!==t)return String(t)}return""}static extractToken(e,n){const{headers:t}=n;if(e===f.access&&c.TOKEN_BEARER_KEY.toLocaleLowerCase()in t){const[e,n]=String(t[c.TOKEN_BEARER_KEY.toLocaleLowerCase()]).split(" ");if(e===c.TOKEN_BEARER&&""!==n)return String(n)}return""}}},function(e,n){e.exports=require("chalk")},function(e,n){e.exports=require("graphql-shield")},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const a=t(12);var r;!function(e){e.ADMIN="admin",e.DEVELOPER="developer"}(r=n.Role||(n.Role={})),n.isAuthenticated=a.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){var e,n;return""!==String(null===(n=null===(e=t)||void 0===e?void 0:e.token)||void 0===n?void 0:n.uuid)}))),n.isAdmin=a.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){var e,n;return null===(n=null===(e=t)||void 0===e?void 0:e.token)||void 0===n?void 0:n.roles.includes(r.ADMIN)}))),n.isOwner=a.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){var n,i,a;return(null===(i=null===(n=t)||void 0===n?void 0:n.token)||void 0===i?void 0:i.uuid)===(null===(a=e)||void 0===a?void 0:a.uuid)}))),n.isDeveloper=a.rule()((e,n,t)=>i(void 0,void 0,void 0,(function*(){return t.token.roles.includes(r.DEVELOPER)})))},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(2),r=i(t(9)),o={accounts:null};n.default=function(e){if(null!==o.accounts)return o;const n=new r.default({context:e});return o.accounts=new a.DataLoader(e=>n.getAccountsByIds(e).then(n=>a.collateForDataloader(e,n))),o}},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(t(4)),o=a(t(5)),s=t(16);n.downloadSchema=e=>i(void 0,void 0,void 0,(function*(){const{endpoint:n,method:t,token:i,filename:a,headers:d}=e,u=yield fetch(n,{method:t||"POST",headers:Object.assign({"Content-Type":"application/json",Authorization:`Bearer ${i}`},d),body:JSON.stringify({query:s.getIntrospectionQuery()})});if(200!==u.status)throw new Error(`Failed to send introspection request with status code ${u.status}`);const l=yield u.json(),c=s.printSchema(s.buildClientSchema(l.data));return r.default.writeFileSync(o.default.resolve(a),c)}))},function(e,n){e.exports=require("graphql/utilities")},function(e,n){e.exports=require("moment-timezone")},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const o=a(t(47)),s=a(t(48)),d=(a(t(5)),t(30)),u=a(t(11)),l=a(t(49)),c=a(t(50)),p=a(t(51)),f=a(t(52)),m=a(t(53)),v=t(1),y=t(54),k=a(t(55)),N=t(56),h=t(57);n.withFilter=h.withFilter;const g=t(58),T=t(59),_=a(t(60)),b=t(61),w=t(31),D=t(0),E=a(t(65)),S=t(32),A=t(19),O=r(t(10)),I=a(t(75)),L=t(2),M=t(81),x=t(83),j=t(27),P=t(85),F=(t(28),t(86));class R{constructor(e){this.props=Object.assign({port:L.DEFAULT_SERVER_PORT,endpoint:L.DEFAULT_GRAPHQL_ENDPOINT,timezone:L.DEFAULT_SERVER_TIMEZONE,subscriptionEndpoint:L.DEFAULT_GRAPHQL_SUBSCRIPTION_ENDPOINT,usePlayground:!1,enableIntrospection:!1,useVoyager:!1,debug:!1,useCookie:!1},e),this.props.routes=Object.assign({playground:L.DEFAULT_ROUTE_PLAYGROUND,voyager:L.DEFAULT_ROUTE_VOYAGER},this.props.routes)}bootstrap(e){var n;const{port:t,usePlayground:i,useVoyager:a,endpoint:r,routes:d,serverOptions:u,subscriptionEndpoint:l}=this.props,{app:c,schema:p,context:f}=this.createApp(),{logger:m}=f,v=null===(n=u)||void 0===n?void 0:n.cert;process.on("warning",e=>m.server.warn(e.name,e));const y=v?s.default.createServer(u||{},c):o.default.createServer(u||{},c),k=`http${v?"s":""}://localhost`;y.listen(t,()=>{const n={graphql:`${k}:${t}${r}`,subscriptions:`ws${v?"s":""}://localhost:${t}${l}`};i&&(n.playground=`${k}:${t}${d.playground}`,n.graphiql=`${k}:${t}${r}${L.DEFAULT_ROUTE_GRAPHIQL}`),a&&(n.voyager=`${k}:${t}${d.voyager}`),m.server.debug(`App server started at «${n.graphql}»`),this.createSubscriptionServer({schema:p,server:y,context:f}),void 0!==e&&e({port:t,context:f,resolveUrl:n})})}createSubscriptionServer(e){const{subscriptionEndpoint:n,websocketOptions:t}=this.props,{server:a,schema:r,context:o}=e,s=new O.default({context:o});return new b.SubscriptionServer({execute:v.execute,schema:r,subscribe:v.subscribe,onConnect:e=>i(this,void 0,void 0,(function*(){const n=O.default.extractTokenFromSubscription(e),t=yield s.verifyToken(n);if(t.type!==O.TokenType.access)throw new D.UnauthorizedError("Is not an access token");return o.token=t,o})),onDisconnect:e=>{e.close(),e.terminate()}},Object.assign({server:a,path:n},t))}createApp(){const{typeDefs:e,resolvers:n,endpoint:t,timezone:a,port:r,jwt:o,permissions:s,middlewares:v,database:h,redis:b,logger:R,routes:V,subscriptionEndpoint:C,usePlayground:$,enableIntrospection:G,playgroundConfig:U,useVoyager:B,serverOptions:q,debug:Q}=this.props,{cookieSign:K}=q||{};R.server.debug("Create application proc was started");const z=f.default(),J=g.makeExecutableSchema({typeDefs:[A.scalar.typeDefs,A.common.typeDefs,A.info.typeDefs,A.accounts.typeDefs,A.auth.typeDefs,...e||[]],resolvers:[A.scalar.resolvers,A.info.resolvers,A.accounts.resolvers,A.auth.resolvers,...n||[]],resolverValidationOptions:{requireResolversForResolveType:!1}}),Z=w.knexProvider(Object.assign({localTimezone:a,logger:R},h));j.CronJobManager.configure({logger:R});const Y={endpoint:t,timezone:a,jwt:o,logger:R,redis:new _.default(b),pubsub:new N.RedisPubSub({publisher:new _.default(b),subscriber:new _.default(b),connection:b}),knex:Z,deviceInfo:{client:{type:"",name:"",version:"",engine:"",engineVersion:""},os:{name:"",version:"",platform:""},device:{type:"",brand:"",model:""},bot:null},startTime:0,token:{type:O.TokenType.access,id:"",uuid:"",roles:[],exp:0,iss:""}};if(z.use(c.default({credentials:!0,origin:(e,n)=>n(null,!0)})),z.use(f.default.json({limit:L.MAXIMUM_REQUEST_BODY_SIZE})),z.use(f.default.urlencoded({extended:!0,limit:L.MAXIMUM_REQUEST_BODY_SIZE})),z.use(l.default(K)),z.use(F.headersMiddleware()),z.use(M.accessMiddleware({context:Y})),z.use(S.requestHandlerMiddleware({context:Y})),z.use(E.default({context:Y})),$&&z.get(V.playground,k.default({endpoint:t,subscriptionEndpoint:C,config:U})),B){const{accessToken:e}=x.configureTokens([""],Y);R.server.debug("New AccessToken was created special for GraphQL voyager",{accessToken:e}),console.log(""),console.log(`${u.default.yellow.bold("Note: ")}${u.default.yellow("An access token was created specifically for GraphQL voyager")}`),console.log(`${u.default.yellow("This token was expire at")} ${u.default.yellowBright.bold(new Date(Date.now()+18e5))}`),console.log(u.default.yellow("After the token expires, you must restart the application")),z.use(V.voyager,T.express({endpointUrl:t,headersJS:JSON.stringify({Authorization:`Bearer ${e.token}`})}))}const X=e=>({queryTimeMs:d.performance.now()-e.context.startTime}),W=new O.default({context:Y});return z.use(t,I.default({maxFileSize:8e7,maxFiles:30}),m.default(e=>i(this,void 0,void 0,(function*(){var n;const t=null===(n=q)||void 0===n?void 0:n.cert,i=O.default.extractToken(O.TokenType.access,e);if(""!==i){const e=yield W.verifyToken(i);if(e.type!==O.TokenType.access)throw new D.UnauthorizedError("Is not an access token");Y.token=e}const a=new p.default;Y.deviceInfo=a.parse(e.headers["user-agent"]),Y.startTime=d.performance.now();const o=[...s||[],A.accounts.permissions,A.auth.permissions,...v||[]];return{context:Y,graphiql:$,extensions:Q?X:void 0,schema:y.applyMiddleware(J,...o),subscriptionEndpoint:`ws${t?"s":""}://localhost:${r}${C}`,customFormatErrorFn:e=>D.customFormatErrorFn({error:e,context:Y,debug:Q}),validationRules:G?[]:[P.DisableIntrospectionQueries]}})))),R.server.debug("Application was created"),j.CronJobManager.addJob("__clearExpiredTokens",{cronTime:"* 0 5 * * *",onTick:()=>i(this,void 0,void 0,(function*(){yield W.clearExpiredTokens()})),start:!0}),{app:z,context:Y,schema:J,routes:V}}}n.App=R,n.default=R},function(e,n,t){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=i(t(36));n.accounts=r;const o=i(t(88));n.auth=o;const s=a(t(93)),d=i(t(94));n.info=d;const u=i(t(102));n.scalar=u;const l={typeDefs:s.default};n.common=l},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(0);var a;!function(e){e.ASC="ASC",e.DESC="DESC"}(n.IDirectionRange||(n.IDirectionRange={})),function(e){e.EQ="=",e.NEQ="<>",e.GT=">",e.LT="<",e.GTE=">=",e.LTE="<=",e.IN="in",e.NOTIN="notIn",e.LIKE="like",e.ILIKE="ilike",e.NULL="IS NULL",e.NOTNULL="IS NOT NULL"}(a=n.TWhereAction||(n.TWhereAction={})),n.stringToCursor=e=>Buffer.from(String(e),"utf8").toString("base64"),n.cursorToString=e=>Buffer.from(e,"base64").toString("utf8"),n.makeNodeCursor=(e,t)=>n.stringToCursor([JSON.stringify(t),e].join("---")),n.getCursorPayload=e=>{try{const t=n.cursorToString(e).split("---")[0]||"";return JSON.parse(t)}catch(e){throw new i.ServerError("Failed to decode cursor payload",{err:e})}},n.nodeToEdge=(e,t,i)=>({node:e,cursor:n.makeNodeCursor(t,i)}),n.convertOrderByToKnex=e=>[...e||[]].map(({field:e,direction:n})=>({column:e,order:n})),n.convertJsonToKnex=(e,n)=>e.raw(`'${JSON.stringify(n)}'::jsonb`),n.convertWhereToKnex=(e,n)=>{if(void 0===n)return e;const t=[];return Array.isArray(n)&&n.forEach(([e,n,i])=>{t.push([e,n,i])}),Array.isArray(n)||Object.entries(n).forEach(([e,n])=>{t.push([e,a.EQ,n])}),t.forEach(([n,t,i])=>{switch(!0){case t===a.IN:e.whereIn(n,Array.isArray(i)?i:[i]);break;case t===a.NOTIN:e.whereNotIn(n,Array.isArray(i)?i:[i]);break;case t===a.NULL:e.whereNull(n);break;case t===a.NOTNULL:e.whereNotNull(n);break;default:e.where(n,t,i)}}),e},n.buildCursorConnection=(e,t)=>{const{nodes:i,totalCount:a,offset:r,limit:o,where:s,orderBy:d}=e,u=i.map((e,i)=>n.nodeToEdge(e,t,{offset:(r||0)+i+1,limit:o,where:s||[],orderBy:d||[]}));return{totalCount:a,edges:u,pageInfo:{startCursor:u.length?u[0].cursor:void 0,endCursor:u.length?u[u.length-1].cursor:void 0,hasPreviousPage:(r||0)>0,hasNextPage:(r||0)+o<a}}},n.buildQueryFilter=e=>{const{first:t,last:i,after:r,before:o,offset:s,orderBy:d,filter:u,search:l}=e,c={limit:Math.max(Number(t||i)||30,0),orderBy:d||[],revert:!!i,where:[],search:l||!1,offset:Math.max(Number(s)||0,0)};if(r||o){const e=n.getCursorPayload(r||o);return Object.assign(Object.assign({},c),e)}return void 0!==u&&(Array.isArray(u)&&(c.where=u),Array.isArray(u)||Object.entries(u).forEach(([e,n])=>{c.where.push([e,a.EQ,n])})),c},n.extractNodeField=(e,n)=>[...e].map(e=>e[n]),n.extractNodeIds=e=>n.extractNodeField(e,"id"),n.collateForDataloader=(e,n,t)=>e.map(e=>n.find(n=>n.id===e)||(t?void 0:null)),n.arrayOfIdsToArrayOfObjectIds=e=>e.length?e.map(e=>({id:e})):null},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="BadRequestError",this.message=e,this.metaData=n,this.status=400,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(11)),r=i(t(21)),o=i(t(23)),s=i(t(24)),d=i(t(25)),u=i(t(26));n.customFormatErrorFn=e=>{const{error:n,context:t,debug:i}=e,{logger:l,token:c}=t,{originalError:p}=n,f=n.stack.split("\n")||[];switch(!0){case p instanceof u.default:l.auth.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:c,stack:f}));break;case p instanceof o.default:l.auth.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:c,stack:f})),l.server.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:c,stack:f}));break;case p instanceof r.default:case p instanceof s.default:case p instanceof d.default:l.server.error(p.message,Object.assign(Object.assign({},n),{meta:p.metaData,token:c,stack:f}));break;default:l.server.error("Error",Object.assign(Object.assign({},n),{token:c,stack:f}))}return i?(console.log(""),console.log(a.default.red("============== Caught the Error ==============")),console.log(""),p&&(p.message&&console.log(a.default.red(p.message)),p.metaData&&console.log(a.default.yellow("Error metadata"),p.metaData)),console.log(a.default.magenta("Access token payload"),c),console.log(""),console.log(a.default.red(n.stack)),console.log(""),console.log(a.default.red("============== End of Error report ==============")),console.log(""),{message:n.message,locations:n.locations,stack:n.stack?n.stack.split("\n"):[],path:n.path}):{message:n.message,locations:n.locations,path:n.path}},n.default=n.customFormatErrorFn},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="ForbiddenError",this.message=e,this.metaData=n,this.status=403,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="NotFoundError",this.message=e,this.metaData=n,this.status=404,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="ServerError",this.message=e,this.metaData=n,this.status=500,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends Error{constructor(e,n){super(e),this.name="UnauthorizedError",this.message=e,this.metaData=n,this.status=401,Object.setPrototypeOf(this,i.prototype)}}n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(41),a=t(0),r={pool:new Map,logger:void 0};class o{static addJob(e,n){if(r.pool.get(e))throw new a.ServerError(`Cron job with name «${e}» already exists`,{jobName:e});const t=i.job(n);return r.logger&&(r.logger.server.debug(`New Cron job was added with name «${e}» at time ${n.cronTime}`,{jobConfig:n}),t.addCallback(()=>{r.logger.server.debug(`Called Cron job with name «${e}» at time ${n.cronTime}`,{jobConfig:n})})),r.pool.set(e,t),t}static getJob(e){return r.pool.get(e)}static getPool(){return r.pool}}n.CronJobManager=o,o.configure=e=>{const{logger:n}=e;r.logger=n},n.default=o},function(e,n,t){"use strict";(function(e){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(4)),r=i(t(5));n.replaceEnv=e=>e.replace(/\$\{([A-Z0-9_]+)\}/gi,(e,n)=>process.env[n]?String(process.env[n]):n),n.loadGraphQLConfig=t=>{if(!a.default.existsSync(t))throw new Error(`GraphQL config file ${t} not found`);const i=a.default.readFileSync(r.default.resolve(e,"../../.graphqlconfig"),"utf8");try{return JSON.parse(n.replaceEnv(i))}catch(e){throw console.error(e),new Error(`Failed to parse GraphQL config file ${t}`)}}}).call(this,"src/utils")},function(e,n){e.exports=require("uuid")},function(e,n){e.exports=require("perf_hooks")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(t(62))},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),i(t(66)),i(t(8)),i(t(73))},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=n=>{this.file=n,e(n)},this.reject=n}),this.promise.catch(()=>{})}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(18);var a;!function(e){e.TOKEN_REVOKED="token-revoked"}(a=n.SubscriptioTriggers||(n.SubscriptioTriggers={}));const r={tokenWasRevoked:{subscribe:i.withFilter((e,n,t)=>t.pubsub.asyncIterator(a.TOKEN_REVOKED),(e,n)=>e.tokenWasRevoked.includes(n.id))}};n.default=r},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const r=a(t(19));n.schemas=r,i(t(18)),i(t(2)),i(t(32)),i(t(31)),i(t(0))},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const r=i(t(37));n.permissions=r.default;const o=i(t(38));n.resolvers=o.default;const s=a(t(87));n.typeDefs=s;const d=i(t(9));n.service=d.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(12),a=t(13);n.permissions=i.shield({Subscription:a.isAuthenticated,Account:{login:i.or(a.isDeveloper,a.isOwner,a.isAdmin),password:i.or(a.isDeveloper,a.isOwner,a.isAdmin)},AccountsMutation:{deleteAccount:i.or(a.isDeveloper,a.isAdmin),createAccount:i.or(a.isDeveloper,a.isAdmin),updateAccount:i.or(a.isDeveloper,a.isAdmin)}}),n.default=n.permissions},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(39)),r=i(t(44)),o=i(t(45)),s={Query:{accounts:()=>({})},Mutation:{accounts:()=>({})},Subscription:i(t(46)).default,AccountsQuery:o.default,AccountsMutation:r.default,Account:a.default};n.default=s},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(t(14)),o={id:({id:e})=>i(void 0,void 0,void 0,(function*(){return e})),createdAt:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).createdAt})),updatedAt:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).updatedAt})),status:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).status})),name:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).name})),login:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).login})),password:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).password})),roles:({id:e},n,t)=>i(void 0,void 0,void 0,(function*(){const n=r.default(t);return(yield n.accounts.load(e)).roles}))};n.default=o},function(e,n){e.exports=require("dataloader")},function(e,n){e.exports=require("cron")},function(e,n){e.exports=require("bcryptjs")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__rest||function(e,n){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)n.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(t[i[a]]=e[i[a]])}return t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=t(0),s=r(t(14)),d=r(t(9)),u={updateAccount:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{id:e}=n,i=a(n,["id"]),r=s.default(t),u=new d.default({context:t});try{yield u.updateAccount(e,i.data)}catch(n){throw new o.ServerError("Failed to update account",{data:i,id:e})}return r.accounts.clear(e),{id:e}})),createAccount:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{data:e}=n,i=new d.default({context:t});if(!(yield i.getAccountByLogin(e.login)))throw new o.ServerError(`Account with login ${e.login} already exists`,{data:e});try{return{id:yield i.createAccount(e)}}catch(n){throw new o.ServerError("Failed to create account",{data:e})}})),deleteAccount:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{id:e}=n,i=new d.default({context:t}),a=s.default(t);try{const n=yield i.deleteAccount(e);return a.accounts.clear(e),Boolean(n)}catch(n){throw new o.ServerError(`Failed to delete account with id ${e}`,{id:e})}}))};n.default=u},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const o=t(0),s=t(20),d=a(t(14)),u=r(t(9));n.accountsQueryResolver={list:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const e=d.default(t),i=s.buildQueryFilter(n),a=new u.default({context:t});try{const n=yield a.getAccounts(i),t=s.buildCursorConnection(n,"accounts");return n.nodes.forEach(n=>{e.accounts.clear(n.id).prime(n.id,n)}),t}catch(e){throw new o.ServerError("Failed to get Accounts list",{err:e})}})),statusesList:()=>Object.values(u.AccountStatus),me:(e,n,t)=>({id:t.token.uuid}),token:(e,n,t)=>{const{token:i}=t;return i},account:(e,n)=>({id:n.id})},n.default=n.accountsQueryResolver},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(18);var a;!function(e){e.ACCOUNT_UPDATED="account-updated",e.ACCOUNT_DELETED="account-deleted",e.TOKEN_REVOKED="token-revoked"}(a=n.SubscriptioTriggers||(n.SubscriptioTriggers={}));const r={accountWasUpdated:{subscribe:i.withFilter((e,n,t)=>t.pubsub.asyncIterator(a.ACCOUNT_UPDATED),(e,n)=>e.accountWasUpdated.id===n.id)},accountWasDeleted:{subscribe:(e,n,t)=>t.pubsub.asyncIterator(a.ACCOUNT_DELETED)},tokenWasRevoked:{subscribe:i.withFilter((e,n,t)=>t.pubsub.asyncIterator(a.TOKEN_REVOKED),(e,n)=>e.tokenWasRevoked.includes(n.id))}};n.default=r},function(e,n){e.exports=require("http")},function(e,n){e.exports=require("https")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("device-detector-js")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("express-graphql")},function(e,n){e.exports=require("graphql-middleware")},function(e,n){e.exports=require("graphql-playground-middleware-express")},function(e,n){e.exports=require("graphql-redis-subscriptions")},function(e,n){e.exports=require("graphql-subscriptions")},function(e,n){e.exports=require("graphql-tools")},function(e,n){e.exports=require("graphql-voyager/middleware")},function(e,n){e.exports=require("ioredis")},function(e,n){e.exports=require("subscriptions-transport-ws")},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(30),r=i(t(63)),o=i(t(17)),s=t(64),d=t(0),u=t(2);n.knexProvider=e=>{const{connection:n,logger:t,timezone:i,localTimezone:l}=e,c={};s.types.setTypeParser(s.types.builtins.TIMESTAMP,"text",e=>o.default.tz(e,l).toDate()),s.types.setTypeParser(s.types.builtins.TIMESTAMPTZ,"text",e=>o.default.tz(e,l).toDate()),s.types.setTypeParser(s.types.builtins.NUMERIC,parseFloat),t.server.debug("pg-types configured"),t.server.debug("Try to Database server connect");const p=r.default({client:u.DATABASE_CLIENT,connection:n,pool:{afterCreate:(e,n)=>{e.query(`\n            SET TIMEZONE = '${i||"UTC"}';\n            SET CLIENT_ENCODING = ${u.DATABASE_CHARSET};\n          `,a=>{a?t.sql.debug("Connection error",{err:a}):(t.sql.debug(`The TIMEZONE was set to "${i||"UTC"}"`),t.sql.debug(`The charset was set to "${u.DATABASE_CHARSET}"`)),n(a,e)})}}});return p.on("query",e=>{const n=e.__knexQueryUid;c[n]={startTime:a.performance.now()}}).on("query-response",(e,n,i)=>{const r=n.__knexQueryUid,o=a.performance.now()-c[r].startTime;t.sql.debug(i.toString(),{queryTime:o})}).on("query-error",(e,n)=>{t.sql.error(n.sql,{err:e,bindings:n.bindings})}),t.server.debug("Knex provider configured"),p.raw("SELECT 1+1 AS result").then(()=>(t.server.debug("Test the connection by trying to authenticate is OK"),!0)).catch(e=>{throw t.server.error(e.name,e),new d.ServerError(e)}),p},n.default=n.knexProvider},function(e,n){e.exports=require("knex")},function(e,n){e.exports=require("pg")},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(22));n.default=e=>(n,t,i,r)=>{const{context:o}=e;a.default({context:o,error:n,debug:!1})}},function(e,n,t){"use strict";var i=this&&this.__rest||function(e,n){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)n.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(t[i[a]]=e[i[a]])}return t};Object.defineProperty(n,"__esModule",{value:!0}),t(6);const a=t(67);let r;n.logger=r;const o=e=>{const{loggers:t}=e,o=i(e,["loggers"]);return n.logger=r=Object.assign({access:a.accessLogger(o),auth:a.authLogger(o),http:a.httpLogger(o),server:a.serverLogger(o),sql:a.sqlLogger(o)},t),r};n.configureLogger=o,n.default=o},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(68));n.accessLogger=a.default;const r=i(t(69));n.authLogger=r.default;const o=i(t(70));n.httpLogger=o.default;const s=i(t(71));n.serverLogger=s.default;const d=i(t(72));n.sqlLogger=d.default},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(7);t(6);const r=t(3),o=i(t(8));n.default=e=>{const{logDir:n}=e;return a.createLogger({level:"info",format:o.default,transports:[new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_ACCESS}`,level:"warn",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES}),new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_ACCESS}`,level:"info",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(7);t(6);const r=t(3),o=i(t(8));n.default=e=>{const{logDir:n}=e;return a.createLogger({level:"info",format:o.default,transports:[new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_AUTH}`,level:"info",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES}),new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_DEBUG}`,level:"debug",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(7);t(6);const r=t(3),o=i(t(8));n.default=e=>{const{logDir:n}=e;return a.createLogger({level:"info",format:o.default,transports:[new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_HTTP}`,level:"info",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(7);t(6);const r=t(3),o=i(t(8));n.default=e=>{const{logDir:n}=e;return a.createLogger({level:"debug",format:o.default,transports:[new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_WARNINGS}`,level:"warn",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES}),new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_ERRORS}`,level:"error",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES}),new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_DEBUG}`,level:"debug",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(7);t(6);const r=t(3),o=i(t(8));n.default=e=>{const{logDir:n}=e;return a.createLogger({level:"debug",format:o.default,transports:[new a.transports.DailyRotateFile({filename:`${n}/${r.LOG_FILENAME_SQL}`,level:"debug",datePattern:r.LOG_DATE_PATTERNT,zippedArchive:!0,maxSize:r.LOG_MAX_SIZE,maxFiles:r.LOG_MAX_FILES}),new a.transports.Console({level:"error",format:a.format.combine(a.format.colorize({all:!0}),a.format.simple())})]})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(74));n.requestHandlerMiddleware=a.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=e=>{const{context:n}=e,{logger:t}=n;return(e,n,i)=>{const{method:a,originalUrl:r,headers:o}=e,s=String(e.headers["x-forwarded-for"]||"").replace(/:\d+$/,"")||e.connection.remoteAddress,d="127.0.0.1"===s||"::1"===s?"localhost":s;return t.http.info(`${d} ${a} "${r}"`,{headers:o}),i()}}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(76));n.default=e=>(n,t,i)=>{if(!n.is("multipart/form-data"))return i();const r=new Promise(e=>n.on("end",e)),{send:o}=t;return t.send=(...e)=>{r.then(()=>{t.send=o,t.send(...e)})},a.default(n,t,e).then(e=>{n.body=e,i()}).catch(e=>{e.status&&e.expose&&t.status(e.status),i(e)})}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(77)),r=t(78),o=i(t(79)),s=i(t(80)),d=i(t(33)),u="https://github.com/jaydenseric/graphql-multipart-request-spec",l=e=>null!=e&&"object"==typeof e&&!1===Array.isArray(e),c=e=>{e.on("error",()=>{}),e.resume()};n.defaultOptions={maxFieldSize:1e6,maxFileSize:1/0,maxFiles:1/0};n.default=(e,t,i)=>{const{maxFieldSize:p,maxFiles:f,maxFileSize:m}=Object.assign(Object.assign({},n.defaultOptions),i);return new Promise((n,i)=>{let v,y,k,N,h,g;const T=new a.default({headers:e.headers,limits:{fieldSize:p,fields:2,fileSize:m,files:f}}),_=n=>{if(!y){if(y=n,i(y),T.end(),k&&k.unpipe(y),g)for(const e of g.values())e.file||e.reject(y);e.unpipe(T),setImmediate(()=>{e.resume()})}},b=()=>{if(!v&&(v=!0,g))for(const e of g.values())e.file&&e.file.capacitor.release()},w=()=>{_(o.default(499,"Request disconnected during file upload stream parsing."))};T.on("field",(e,t,i,a)=>{if(!y)switch(a&&_(o.default(413,`The ‘${e}’ multipart field value exceeds the ${p} byte size limit.`)),e){case"operations":try{N=JSON.parse(t)}catch(e){_(o.default(400,`Invalid JSON in the ‘operations’ multipart field (${u}).`))}l(N)||Array.isArray(N)||_(o.default(400,`Invalid type for the ‘operations’ multipart field (${u}).`)),h=s.default(N);break;case"map":{let i;N||_(o.default(400,`Misordered multipart fields; ‘map’ should follow ‘operations’ (${u}).`));try{i=JSON.parse(t)}catch(e){_(o.default(400,`Invalid JSON in the ‘map’ multipart field (${u}).`))}l(i)||_(o.default(400,`Invalid type for the ‘map’ multipart field (${u}).`));const a=Object.entries(i);a.length>f&&_(o.default(413,`${f} max file uploads exceeded.`)),g=new Map;for(const[n,t]of a){Array.isArray(t)||_(o.default(400,`Invalid type for the ‘map’ multipart field entry key ‘${n}’ array (${u}).`)),g.set(n,new d.default);for(const[i,a]of t.entries()){"string"!=typeof a&&_(o.default(400,`Invalid type for the ‘map’ multipart field entry key ‘${n}’ array index ‘${i}’ value (${u}).`));try{h.set(a,g.get(n))}catch(n){_(o.default(400,`Invalid object path for the ‘map’ multipart field entry key ‘${e}’ array index ‘${i}’ value ‘${a}’ (${u}).`))}}}n(N)}}}),T.on("file",(e,n,t,i,a)=>{if(y)return void c(n);g||(c(n),_(o.default(400,`Misordered multipart fields; files should follow ‘map’ (${u}).`))),k=n,n.on("end",()=>{k=null});const s=g.get(e);if(!s)return void c(n);let d;const l=new r.WriteStream;l.on("error",()=>{n.unpipe(),n.resume()}),n.on("limit",()=>{d=o.default(413,`File truncated as it exceeds the ${m} byte size limit.`),n.unpipe(),l.destroy(d)}),n.on("error",e=>{d=e,n.unpipe(),l.destroy(y)});const p={filename:t,mimetype:a,encoding:i,createReadStream(e){const n=d||(v?y:null);if(n)throw n;return l.createReadStream(e)}};Object.defineProperty(p,"capacitor",{value:l}),n.pipe(l),s.resolve(p)}),T.once("filesLimit",()=>_(o.default(413,`${f} max file uploads exceeded.`))),T.once("finish",()=>{e.unpipe(T),e.resume(),N||_(o.default(400,`Missing multipart field ‘operations’ (${u}).`)),g||_(o.default(400,`Missing multipart field ‘map’ (${u}).`));for(const e of g.values())e.file||e.reject(o.default(400,"File missing in the request."))}),T.once("error",_),t.once("finish",b),t.once("close",b),e.once("close",w),e.once("end",()=>{e.removeListener("close",w)}),e.pipe(T)})}},function(e,n){e.exports=require("busboy")},function(e,n){e.exports=require("fs-capacitor")},function(e,n){e.exports=require("http-errors")},function(e,n){e.exports=require("object-path")},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(t(82));n.accessMiddleware=e=>(n,t,a)=>i(void 0,void 0,void 0,(function*(){const{context:i}=e,{logger:o}=i,s=new r.default({context:i}),d=String(n.headers["x-forwarded-for"]||"").replace(/:\d+$/,"")||n.connection.remoteAddress||"unknown ip";return(yield s.isInBlackList(d))?(o.access.warn(`The ip address [${d}] is blacklisted. The request was blocked`,{ipAddress:d}),t.json({response:{status:69}}).end()):(o.access.info(`Request from [${d}]`,{ipAddress:d}),a())})),n.default=n.accessMiddleware},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const a=t(2);n.default=class{constructor(e){this.props=e}getBlackList(){return i(this,void 0,void 0,(function*(){const{redis:e}=this.props.context;return yield e.smembers(a.REDIS_IP_BLACKLIST)}))}addToBlackList(e){return i(this,void 0,void 0,(function*(){const{redis:n}=this.props.context;yield n.sadd(a.REDIS_IP_BLACKLIST,e)}))}removeFromBlackList(e){return i(this,void 0,void 0,(function*(){const{redis:n}=this.props.context;yield n.srem(a.REDIS_IP_BLACKLIST,e)}))}clearBlackList(){return i(this,void 0,void 0,(function*(){const{redis:e}=this.props.context;yield e.del(a.REDIS_IP_BLACKLIST)}))}isInBlackList(e){return i(this,void 0,void 0,(function*(){const{redis:n}=this.props.context,t=yield n.sismember(a.REDIS_IP_BLACKLIST,e);return Boolean(t)}))}}},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(84)),r=i(t(10)),o=(e,n)=>new r.default({context:n}).generateTokens({uuid:a.default(),roles:e},{access:2592e3,refresh:2592e3});n.configureTokens=o,n.default=o},function(e,n){e.exports=require("uuid/v4")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1),a=["__Schema!","__Type!"];n.noIntrospectionAllowedMessage=(e,n)=>"Introspection has been disabled for this schema. The field "+`"${e}" of type "${String(n)}" is not allowed.`,n.DisableIntrospectionQueries=e=>({Field(t){const r=e.getType();r&&a.indexOf(String(r))>=0&&e.reportError(new i.GraphQLError(n.noIntrospectionAllowedMessage(t.name.value,r)))}})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.headersMiddleware=()=>(e,n,t)=>{n.removeHeader("X-Powered-By"),n.setHeader("X-Developer","Via Profit"),t()},n.default=n.headersMiddleware},function(e,n){var t={kind:"Document",definitions:[{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"accounts"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountsQuery"}}},directives:[]}]},{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"accounts"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountsMutation"}}},directives:[]}]},{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Subscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Called when the account with following id was updated",block:!0},name:{kind:"Name",value:"accountWasUpdated"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Called when the any account was deleted",block:!0},name:{kind:"Name",value:"accountWasDeleted"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Called when the token with following id was revoked",block:!0},name:{kind:"Name",value:"tokenWasRevoked"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}},directives:[]}]},{kind:"EnumTypeDefinition",description:{kind:"StringValue",value:"Account status",block:!0},name:{kind:"Name",value:"AccountStatus"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"allowed"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"forbidden"},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"AccountOrderField"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"name"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"login"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"createdAt"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"updatedAt"},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Account edge bundle",block:!0},name:{kind:"Name",value:"AccountsEdge"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Edge"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"node"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"cursor"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Accounts module queries",block:!0},name:{kind:"Name",value:"AccountsQuery"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Accounts list bundle",block:!0},name:{kind:"Name",value:"list"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"first"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"last"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"after"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"before"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"status"},type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"orderBy"},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountOrderBy"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountListConnection"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Account statuses list",block:!0},name:{kind:"Name",value:"statusesList"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}}}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Your account data",block:!0},name:{kind:"Name",value:"me"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Your Access Token payload",block:!0},name:{kind:"Name",value:"token"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccessTokenPayload"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns account by ID",block:!0},name:{kind:"Name",value:"account"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AccountsMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Update existings account",block:!0},name:{kind:"Name",value:"updateAccount"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"data"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InputAccountUpdateData"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Create new Account",block:!0},name:{kind:"Name",value:"createAccount"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"data"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InputAccountCreateData"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Account"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Delete account",block:!0},name:{kind:"Name",value:"deleteAccount"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Ordering options for accounts returned from the connection",block:!0},name:{kind:"Name",value:"AccountOrderBy"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"field"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountOrderField"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"direction"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"OrderDirection"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Account data",block:!0},name:{kind:"Name",value:"Account"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Node"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"login"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"password"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"status"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"roles"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Possible data to driver update",block:!0},name:{kind:"Name",value:"InputAccountUpdateData"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"login"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"password"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"status"},type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"roles"},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Possible data to create new account",block:!0},name:{kind:"Name",value:"InputAccountCreateData"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"login"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"password"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"status"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountStatus"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"roles"},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Accounts list bundle",block:!0},name:{kind:"Name",value:"AccountListConnection"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Connection"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"totalCount"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"pageInfo"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"edges"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"AccountsEdge"}}}},directives:[]}]}],loc:{start:0,end:2416}};t.loc.source={body:'extend type Query {\n  accounts: AccountsQuery!\n}\n\nextend type Mutation {\n  accounts: AccountsMutation!\n}\n\nextend type Subscription {\n\n  """\n  Called when the account with following id was updated\n  """\n  accountWasUpdated (id: ID!): Account!\n\n  """\n  Called when the any account was deleted\n  """\n  accountWasDeleted: [ID!]!\n  \n  """\n  Called when the token with following id was revoked\n  """\n  tokenWasRevoked (id: ID!): [ID!]!\n}\n\n\n"""\nAccount status\n"""\nenum AccountStatus {\n  allowed\n  forbidden\n}\n\nenum AccountOrderField {\n  name\n  login\n  createdAt\n  updatedAt\n}\n\n\n\n"""\nAccount edge bundle\n"""\ntype AccountsEdge implements Edge {\n  node: Account!\n  cursor: String!\n}\n\n"""\nAccounts module queries\n"""\ntype AccountsQuery {\n\n  """\n  Returns Accounts list bundle\n  """\n  list(\n    first: Int\n    last: Int\n    after: String\n    before: String\n    status: AccountStatus\n    orderBy: [AccountOrderBy]\n  ): AccountListConnection!\n\n  """\n  Returns Account statuses list\n  """\n  statusesList: [AccountStatus!]!\n\n  """\n  Returns Your account data\n  """\n  me: Account!\n\n  """\n  Returns Your Access Token payload\n  """\n  token: AccessTokenPayload!\n\n  """\n  Returns account by ID\n  """\n  account(id: ID!): Account!\n}\n\n\n\ntype AccountsMutation {\n  \n  """\n  Update existings account\n  """\n  updateAccount(\n    id: ID!\n    data: InputAccountUpdateData!\n  ): Account!\n\n  """\n  Create new Account\n  """\n  createAccount(\n    data: InputAccountCreateData!\n  ): Account!\n\n  """\n  Delete account\n  """\n  deleteAccount(\n    id: ID!\n  ): Boolean!\n\n\n}\n\n\n\n\n"""\nOrdering options for accounts returned from the connection\n"""\ninput AccountOrderBy {\n  field: AccountOrderField!\n  direction: OrderDirection!\n}\n\n\n"""\nAccount data\n"""\ntype Account implements Node {\n  id: ID!\n  name: String!\n  login: String!\n  password: String!\n  status: AccountStatus!\n  createdAt: DateTime!\n  updatedAt: DateTime!\n  roles: [String!]!\n}\n\n\n\n"""\nPossible data to driver update\n"""\ninput InputAccountUpdateData {\n  id: String\n  name: String\n  login: String\n  password: String\n  status: AccountStatus\n  roles: [String!]\n}\n\n"""\nPossible data to create new account\n"""\ninput InputAccountCreateData {\n  id: String\n  name: String!\n  login: String!\n  password: String!\n  status: AccountStatus!\n  roles: [String!]!\n}\n\n\n\n"""\nAccounts list bundle\n"""\ntype AccountListConnection implements Connection {\n  totalCount: Int!\n  pageInfo: PageInfo!\n  edges: [AccountsEdge]!\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const r=i(t(89));n.permissions=r.default;const o=i(t(90));n.resolvers=o.default;const s=a(t(92));n.typeDefs=s;const d=i(t(10));n.service=d.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(12),a=t(0),r=t(13);n.permissions=i.shield({Mutation:{auth:i.allow},AuthMutation:{getAccessToken:i.allow,refreshToken:i.allow,revokeToken:i.or(r.isOwner,r.isDeveloper,r.isAdmin)},TokensBag:i.allow,AccessTokenBag:i.allow,AccessTokenPayload:i.allow,RefreshTokenBag:i.allow,RefreshTokenPayload:i.allow,TokenType:i.allow},{fallbackRule:r.isAuthenticated,allowExternalErrors:!0,fallbackError:(e,n,t,i,r)=>new a.ForbiddenError("Permission denied. You don't have access to these field[s]",{fieldName:r.fieldName,fieldNodes:r.fieldNodes,returnType:r.returnType,parentType:r.parentType,path:r.path,fragments:r.fragments})}),n.default=n.permissions},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(91)),r={Mutation:{auth:()=>({})},Subscription:i(t(34)).default,AuthMutation:a.default};n.default=r},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(a,r){function o(e){try{d(i.next(e))}catch(e){r(e)}}function s(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((i=i.apply(e,n||[])).next())}))},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const r=t(0),o=a(t(10)),s=t(34),d={getAccessToken:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{login:e,password:i}=n,{deviceInfo:a}=t,r=new o.default({context:t}),s=yield r.getAccountByCredentials(e,i);return yield r.registerTokens({uuid:s.id,deviceInfo:a})})),refreshToken:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{token:e}=n,{logger:i,deviceInfo:a}=t,s=new o.default({context:t}),d=yield s.verifyToken(String(e));if(d.type!==o.TokenType.refresh)throw i.auth.info("Tried to refresh token by access token. Rejected",{payload:d}),new r.ServerError("Is not a refresh token",{payload:d});if(!(yield s.checkTokenExist(d.id)))throw i.auth.info("Tried to refresh token by revoked refresh token. Rejected",{payload:d}),new r.ServerError("This token was revoked",{payload:d});return yield s.revokeToken([d.associated,d.id]),yield s.registerTokens({uuid:d.uuid,deviceInfo:a})})),revokeToken:(e,n,t)=>i(void 0,void 0,void 0,(function*(){const{pubsub:e}=t,{id:i}=n;try{const n=new o.default({context:t});return yield n.revokeToken(i),e.publish(s.SubscriptioTriggers.TOKEN_REVOKED,{tokenWasRevoked:[i]}),!0}catch(e){throw new r.ServerError(`Failed to revoke token ${i}`,{id:i})}}))};n.default=d},function(e,n){var t={kind:"Document",definitions:[{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"auth"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthMutation"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AuthMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns Access and refresh tokens",block:!0},name:{kind:"Name",value:"getAccessToken"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"login"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"password"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokensBag"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Refresh and return new Access and refresh tokens",block:!0},name:{kind:"Name",value:"refreshToken"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"token"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokensBag"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Revoke some token",block:!0},name:{kind:"Name",value:"revokeToken"},arguments:[{kind:"InputValueDefinition",description:{kind:"StringValue",value:"Token ID",block:!0},name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Revoke All tokens",block:!0},name:{kind:"Name",value:"revokeAllTokens"},arguments:[{kind:"InputValueDefinition",description:{kind:"StringValue",value:'"\nAccount ID',block:!0},name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Response data when authentification is success",block:!0},name:{kind:"Name",value:"TokensBag"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"accessToken"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccessTokenBag"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"refreshToken"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RefreshTokenBag"}}},directives:[]}]},{kind:"EnumTypeDefinition",name:{kind:"Name",value:"TokenType"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"access"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"refresh"},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AccessTokenBag"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"token"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"payload"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AccessTokenPayload"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"RefreshTokenBag"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"token"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"payload"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RefreshTokenPayload"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"AccessTokenPayload"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"type"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokenType"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"uuid"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"roles"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"exp"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"iss"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"RefreshTokenPayload"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"type"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TokenType"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"associated"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"uuid"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"roles"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"exp"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"iss"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]}],loc:{start:0,end:1108}};t.loc.source={body:'extend type Mutation {\n  auth: AuthMutation!\n}\n\ntype AuthMutation {\n  """\n  Returns Access and refresh tokens\n  """\n  getAccessToken(\n    login: String!,\n    password: String!\n    ): TokensBag!\n\n  """\n  Refresh and return new Access and refresh tokens\n  """\n  refreshToken(token: String!): TokensBag!\n\n    """\n  Revoke some token\n  """\n  revokeToken(\n    """\n    Token ID\n    """\n    id: ID!\n  ): Boolean\n\n  """\n  Revoke All tokens\n  """\n  revokeAllTokens(\n    """"\n    Account ID\n    """\n    id: ID!\n  ): Boolean\n}\n\n"""\nResponse data when authentification is success\n"""\ntype TokensBag {\n  accessToken: AccessTokenBag!\n  refreshToken: RefreshTokenBag!\n}\n\nenum TokenType {\n  access\n  refresh\n}\n\ntype AccessTokenBag {\n  token: String!\n  payload: AccessTokenPayload!\n}\n\ntype RefreshTokenBag {\n  token: String!\n  payload: RefreshTokenPayload!\n}\n\ntype AccessTokenPayload {\n  type: TokenType!\n  id: ID!\n  uuid: String!\n  roles: [String!]!\n  exp: Int!\n  iss: String!\n}\n\ntype RefreshTokenPayload {\n  type: TokenType!\n  id: ID!\n  associated: String!\n  uuid: String!\n  roles: [String!]!\n  exp: Int!\n  iss: String!\n}\n\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n){var t={kind:"Document",definitions:[{kind:"EnumTypeDefinition",description:{kind:"StringValue",value:"Standart ordering options",block:!0},name:{kind:"Name",value:"OrderDirection"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"ASC"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"DESC"},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"Error handle interface",block:!0},name:{kind:"Name",value:"Error"},directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Error name. Can be short error message",block:!0},name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Error detail message string",block:!0},name:{kind:"Name",value:"msg"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Information about pagination in a connection.",block:!0},name:{kind:"Name",value:"PageInfo"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"hasPreviousPage"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"hasNextPage"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"startCursor"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"endCursor"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Node spec. interface",block:!0},name:{kind:"Name",value:"Node"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Edge spec. interface",block:!0},name:{kind:"Name",value:"Edge"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"node"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Node"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"cursor"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"InterfaceTypeDefinition",description:{kind:"StringValue",value:"GraphQL Connection spec. interface",block:!0},name:{kind:"Name",value:"Connection"},directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"totalCount"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"pageInfo"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"edges"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Edge"}}}},directives:[]}]}],loc:{start:0,end:746}};t.loc.source={body:'"""\nStandart ordering options\n"""\nenum OrderDirection {\n  ASC\n  DESC\n}\n\n"""\nError handle interface\n"""\ninterface Error {\n  """\n  Error name. Can be short error message\n  """\n  name: String!\n\n  """\n  Error detail message string\n  """\n  msg: String\n}\n\n\n"""\nInformation about pagination in a connection.\n"""\ntype PageInfo {\n  hasPreviousPage: Boolean!\n  hasNextPage: Boolean!\n  startCursor: String\n  endCursor: String\n}\n\n"""\nGraphQL Node spec. interface\n"""\ninterface Node {\n  id: ID!\n  createdAt: DateTime!\n  updatedAt: DateTime!\n}\n\n"""\nGraphQL Edge spec. interface\n"""\ninterface Edge {\n  node: Node!\n  cursor: String!\n}\n\n"""\nGraphQL Connection spec. interface\n"""\ninterface Connection {\n  totalCount: Int!\n  pageInfo: PageInfo!\n  edges: [Edge]!\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const r=i(t(95));n.resolvers=r.default;const o=a(t(101));n.typeDefs=o},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(96)),r=i(t(98)),o=i(t(99)),s={Query:{info:()=>({})},Mutation:{info:()=>({})},Subscription:i(t(100)).default,InfoQuery:o.default,InfoMutation:r.default,Developer:a.default};n.default=s},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(97),a={name:()=>i.Developer.name,url:()=>i.Developer.url,email:()=>i.Developer.email};n.default=a},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(3);n.Developer={name:i.DEV_INFO_DEVELOPER_NAME,url:i.DEV_INFO_DEVELOPER_URL,email:i.DEV_INFO_DEVELOPER_EMAIL}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default={echo:(e,n,t)=>{const{str:i}=n,{pubsub:a}=t;return a.publish("info",{info:i}),i}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default={developer:()=>({})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default={info:{subscribe:(e,n,t)=>t.pubsub.asyncIterator("info")}}},function(e,n){var t={kind:"Document",definitions:[{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InfoQuery"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InfoMutation"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"Subscription"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"info"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Info module queries",block:!0},name:{kind:"Name",value:"InfoQuery"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer info",block:!0},name:{kind:"Name",value:"developer"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Developer"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"InfoMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"echo"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"str"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Developer info",block:!0},name:{kind:"Name",value:"Developer"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer company name",block:!0},name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer url",block:!0},name:{kind:"Name",value:"url"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"URL"}}},directives:[]},{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns developer email address",block:!0},name:{kind:"Name",value:"email"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EmailAddress"}}},directives:[]}]}],loc:{start:0,end:506}};t.loc.source={body:'type Query {\n  info: InfoQuery!\n}\n\ntype Mutation {\n  info: InfoMutation!\n}\n\ntype Subscription {\n  info: String!\n}\n\n\n"""\nInfo module queries\n"""\ntype InfoQuery {\n\n  """\n  Returns developer info\n  """\n  developer: Developer!\n \n}\n\ntype InfoMutation {\n  echo(str: String!): String!\n}\n\n"""\nDeveloper info\n"""\ntype Developer {\n\n  """\n  Returns developer company name\n  """\n  name: String!\n\n  """\n  Returns developer url\n  """\n  url: URL!\n\n  """\n  Returns developer email address\n  """\n  email: EmailAddress!\n}\n\n\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},function(e,n,t){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(103));n.resolvers=a;const r=i(t(113));n.typeDefs=r},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(104));n.Date=a.default;const r=i(t(105));n.DateTime=r.default;const o=i(t(106));n.EmailAddress=o.default;const s=i(t(107));n.FileUpload=s.default;const d=t(109);n.JSON=d.JSON,n.JSONObject=d.JSONObject;const u=i(t(110));n.Money=u.default;const l=i(t(111));n.Time=l.default;const c=i(t(112));n.URL=c.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1),a=new RegExp(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/);n.default=new i.GraphQLScalarType({name:"Date",description:"Analogue of Date object",serialize(e){let n=e;if(!(n instanceof Date)&&"string"!=typeof n)throw new TypeError(`Value is not an instance of Date, Date string: ${JSON.stringify(n)}`);if("string"==typeof n&&(n=new Date,n.setTime(Date.parse(e))),Number.isNaN(n.getTime()))throw new TypeError(`Value is not a valid Date: ${JSON.stringify(n)}`);return[n.getFullYear(),`0${n.getMonth()+1}`.slice(-2),`0${n.getDate()}`.slice(-2)].join("-")},parseValue(e){const n=new Date(e);if(!a.test(e))throw new TypeError(`Value is not a valid date only: ${e}`);if(Number.isNaN(n.getTime()))throw new TypeError(`Value is not a valid Date: ${e}`);return n},parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only parse strings to dates but got a: ${e.kind}`);if(!a.test(e.value))throw new TypeError(`Value is not a valid date only: ${e.value}`);const n=new Date(e.value);if(Number.isNaN(n.getTime()))throw new i.GraphQLError(`Value is not a valid Date: ${e.value}`);return n}})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1);n.default=new i.GraphQLScalarType({name:"DateTime",description:"Analogue of Date object",serialize(e){let n=e;if(!(n instanceof Date)&&"string"!=typeof n&&"number"!=typeof n)throw new TypeError(`Value is not an instance of Date, Date string or number: ${JSON.stringify(n)}`);if("string"==typeof n?(n=new Date,n.setTime(Date.parse(e))):"number"==typeof n&&(n=new Date(n)),Number.isNaN(n.getTime()))throw new TypeError(`Value is not a valid Date: ${JSON.stringify(n)}`);return n.toJSON()},parseValue(e){const n=new Date(e);if(Number.isNaN(n.getTime()))throw new TypeError(`Value is not a valid Date: ${e}`);return n},parseLiteral(e){if(e.kind!==i.Kind.STRING&&e.kind!==i.Kind.INT)throw new i.GraphQLError(`Can only parse strings & integers to dates but got a: ${e.kind}`);const n=new Date(e.kind===i.Kind.INT?Number(e.value):e.value);if(Number.isNaN(n.getTime()))throw new i.GraphQLError(`Value is not a valid Date: ${e.value}`);return n}})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1),a=new RegExp(/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/);n.default=new i.GraphQLScalarType({name:"EmailAddress",description:"A field whose value conforms to the standard internet email address format as specified in RFC822: https://www.w3.org/Protocols/rfc822/.",serialize(e){if("string"!=typeof e)throw new TypeError(`Value is not string: ${e}`);if(!a.test(e))throw new TypeError(`Value is not a valid email address: ${e}`);return e},parseValue(e){if("string"!=typeof e)throw new TypeError("Value is not string");if(!a.test(e))throw new TypeError(`Value is not a valid email address: ${e}`);return e},parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only validate strings as email addresses but got a: ${e.kind}`);if(!a.test(e.value))throw new TypeError(`Value is not a valid email address: ${e.value}`);return e.value}})},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(t(108));n.default=a.default},function(e,n,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(1),r=i(t(33)),o=new a.GraphQLScalarType({name:"FileUpload",description:"The `Upload` scalar type represents a file upload.",parseValue(e){if(e instanceof r.default)return e.promise;throw new a.GraphQLError("Upload value invalid")},parseLiteral(e){throw new a.GraphQLError("Upload literal unsupported",e)},serialize(){throw new a.GraphQLError("Upload serialization unsupported")}});n.default=o},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1);function a(e){return e}function r(e){if("object"!=typeof e||null===e||Array.isArray(e))throw new TypeError(`JSONObject cannot represent non-object value: ${e}`);return e}function o(e,n){const t=Object.create(null);return e.fields.forEach(e=>{t[e.name.value]=s(e.value,n)}),t}function s(e,n){switch(e.kind){case i.Kind.STRING:case i.Kind.BOOLEAN:return e.value;case i.Kind.INT:case i.Kind.FLOAT:return parseFloat(e.value);case i.Kind.OBJECT:return o(e,n);case i.Kind.LIST:return e.values.map(e=>s(e,n));case i.Kind.NULL:return null;case i.Kind.VARIABLE:{const t=e.name.value;return n?n[t]:void 0}default:return e.value}}n.JSON=new i.GraphQLScalarType({name:"JSON",description:"The `JSON` scalar type represents JSON values as specified by [ECMA-404](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).",serialize:a,parseValue:a,parseLiteral:s}),n.JSONObject=new i.GraphQLScalarType({name:"JSONObject",description:"The `JSONObject` scalar type represents JSON objects as specified by [ECMA-404](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).",serialize:r,parseValue:r,parseLiteral:o})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1);n.default=new i.GraphQLScalarType({name:"Money",description:"The value is stored in the smallest monetary unit.",serialize(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError(`Value is not an instance of string or number: ${JSON.stringify(e)}`);return Number(e)},parseValue(e){if("string"==typeof e)throw new TypeError(`Value is not a valid Integer: ${e}`);return BigInt(e)},parseLiteral(e){if(e.kind!==i.Kind.STRING&&e.kind!==i.Kind.INT)throw new i.GraphQLError(`Can only parse strings & integers to money but got a: ${e.kind}`);try{return BigInt(e.value)}catch(n){throw new i.GraphQLError(`Value is not a valid Money: ${e.value}`)}}})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1),a=new RegExp(/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/);n.default=new i.GraphQLScalarType({name:"Time",description:"Time string",serialize(e){if("string"!=typeof e)throw new TypeError(`Value is not string: ${e}`);if(!a.test(e))throw new TypeError(`Value is not a valid time: ${e}`);return 5===e.length?`${e}:00`:e},parseValue(e){if("string"!=typeof e)throw new TypeError("Value is not string");if(!a.test(e))throw new TypeError(`Value is not a valid time: ${e}`);return 5===e.length?`${e}:00`:e},parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only validate strings as time but got a: ${e.kind}`);if(!a.test(e.value))throw new TypeError(`Value is not a valid time: ${e.value}`);return 5===e.value.length?`${e.value}:00`:e.value}})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=t(1);n.default=new i.GraphQLScalarType({name:"URL",description:"A field whose value conforms to the standard URL format as specified in RFC3986: https://www.ietf.org/rfc/rfc3986.txt.",serialize:e=>new URL(e.toString()).toString(),parseValue:e=>new URL(e.toString()),parseLiteral(e){if(e.kind!==i.Kind.STRING)throw new i.GraphQLError(`Can only validate strings as URLs but got a: ${e.kind}`);return new URL(e.value.toString())}})},function(e,n){var t={kind:"Document",definitions:[{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"Money type.\nThe value is stored in the smallest monetary unit (kopecks, cents, etc.)\nReal type - Int\ne.g. For 250 USD this record returns value as 250000 (250$ * 100¢) ",block:!0},name:{kind:"Name",value:"Money"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"DateTime type.\nUse JavaScript Date object for date/time fields\nReal type - String",block:!0},name:{kind:"Name",value:"DateTime"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"DateTime type.\nUse JavaScript Date object for date fields\nReal type - String",block:!0},name:{kind:"Name",value:"Date"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"Time type.\nReal type - String",block:!0},name:{kind:"Name",value:"Time"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"URL type.\nA field whose value conforms to the standard URL format as specified in RFC3986: https://www.ietf.org/rfc/rfc3986.txt.\nReal type - String",block:!0},name:{kind:"Name",value:"URL"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"Email address type.\nA field whose value conforms to the standard internet email address format as specified in RFC822: https://www.w3.org/Protocols/rfc822/.\nReal type - String",block:!0},name:{kind:"Name",value:"EmailAddress"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"The JSON scalar type represents JSON values as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.",block:!0},name:{kind:"Name",value:"JSON"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"The JSONObject scalar type represents JSON objects as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.",block:!0},name:{kind:"Name",value:"JSONObject"},directives:[]},{kind:"ScalarTypeDefinition",description:{kind:"StringValue",value:"A GraphQL `FileUpload` scalar that can be used in a\n[`GraphQLSchema`](https://graphql.org/graphql-js/type/#graphqlschema).\nIt’s value in resolvers is a promise that resolves\nFileUpload for processing and storage.",block:!0},name:{kind:"Name",value:"FileUpload"},directives:[]}],loc:{start:0,end:1404}};t.loc.source={body:'"""\nMoney type.\nThe value is stored in the smallest monetary unit (kopecks, cents, etc.)\nReal type - Int\ne.g. For 250 USD this record returns value as 250000 (250$ * 100¢) \n"""\nscalar Money\n\n"""\nDateTime type.\nUse JavaScript Date object for date/time fields\nReal type - String\n"""\nscalar DateTime\n\n"""\nDateTime type.\nUse JavaScript Date object for date fields\nReal type - String\n"""\nscalar Date\n\n"""\nTime type.\nReal type - String\n"""\nscalar Time\n\n"""\nURL type.\nA field whose value conforms to the standard URL format as specified in RFC3986: https://www.ietf.org/rfc/rfc3986.txt.\nReal type - String\n"""\nscalar URL\n\n"""\nEmail address type.\nA field whose value conforms to the standard internet email address format as specified in RFC822: https://www.w3.org/Protocols/rfc822/.\nReal type - String\n"""\nscalar EmailAddress\n\n"""\nThe JSON scalar type represents JSON values as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.\n"""\nscalar JSON\n\n"""\nThe JSONObject scalar type represents JSON objects as specified by ECMA-404: http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf.\n"""\nscalar JSONObject\n\n"""\nA GraphQL `FileUpload` scalar that can be used in a\n[`GraphQLSchema`](https://graphql.org/graphql-js/type/#graphqlschema).\nIt’s value in resolvers is a promise that resolves\nFileUpload for processing and storage.\n"""\nscalar FileUpload\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t}]);